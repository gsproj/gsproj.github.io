<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>国产化POC测试工具使用指南 | Haris的小站</title><meta name="author" content="Haris"><meta name="copyright" content="Haris"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="POC测试工具使用指南1 SPEC OMP 2012测试SPEC OMP 2012是基于SPEC测试套件的OpenMP评测工具，其中包含15个基于OpenMP的并行程序。 1、安装工具 获取源包：omp2012-1.1.zip 解压后使用install.sh安装 12# 安装./install.sh -d /home/xx  2、测试步骤 1234source shrculimit -s unli">
<meta property="og:type" content="article">
<meta property="og:title" content="国产化POC测试工具使用指南">
<meta property="og:url" content="http://gsproj.github.io/2022/07/06/02_%E6%B5%8B%E8%AF%95/01_POC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="Haris的小站">
<meta property="og:description" content="POC测试工具使用指南1 SPEC OMP 2012测试SPEC OMP 2012是基于SPEC测试套件的OpenMP评测工具，其中包含15个基于OpenMP的并行程序。 1、安装工具 获取源包：omp2012-1.1.zip 解压后使用install.sh安装 12# 安装./install.sh -d /home/xx  2、测试步骤 1234source shrculimit -s unli">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://gsproj.github.io/img/%E5%A4%B4%E5%83%8F.png">
<meta property="article:published_time" content="2022-07-06T03:19:52.000Z">
<meta property="article:modified_time" content="2024-08-02T01:48:34.331Z">
<meta property="article:author" content="Haris">
<meta property="article:tag" content="工作">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://gsproj.github.io/img/%E5%A4%B4%E5%83%8F.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "国产化POC测试工具使用指南",
  "url": "http://gsproj.github.io/2022/07/06/02_%E6%B5%8B%E8%AF%95/01_POC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/",
  "image": "http://gsproj.github.io/img/%E5%A4%B4%E5%83%8F.png",
  "datePublished": "2022-07-06T03:19:52.000Z",
  "dateModified": "2024-08-02T01:48:34.331Z",
  "author": [
    {
      "@type": "Person",
      "name": "Haris",
      "url": "http://gsproj.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://gsproj.github.io/2022/07/06/02_%E6%B5%8B%E8%AF%95/01_POC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '国产化POC测试工具使用指南',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/modify.css"><style>#article-container.post-content h1:before, h2:before, h3:before, h4:before, h5:before, h6:before { -webkit-animation: avatar_turn_around 1s linear infinite; -moz-animation: avatar_turn_around 1s linear infinite; -o-animation: avatar_turn_around 1s linear infinite; -ms-animation: avatar_turn_around 1s linear infinite; animation: avatar_turn_around 1s linear infinite; }</style><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/css/loading-bar.css"><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/img/猫.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">211</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/car2.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Haris的小站</span></a><a class="nav-page-title" href="/"><span class="site-name">国产化POC测试工具使用指南</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">国产化POC测试工具使用指南</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-07-06T03:19:52.000Z" title="发表于 2022-07-06 11:19:52">2022-07-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-02T01:48:34.331Z" title="更新于 2024-08-02 09:48:34">2024-08-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B5%8B%E8%AF%95/%E4%BF%A1%E5%88%9BPOC%E6%B5%8B%E8%AF%95/">信创POC测试</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="top-img" style="background-image: url(/img/car2.png);"></div><article class="container post-content" id="article-container"><h1 id="POC测试工具使用指南"><a href="#POC测试工具使用指南" class="headerlink" title="POC测试工具使用指南"></a>POC测试工具使用指南</h1><h2 id="1-SPEC-OMP-2012测试"><a href="#1-SPEC-OMP-2012测试" class="headerlink" title="1 SPEC OMP 2012测试"></a>1 SPEC OMP 2012测试</h2><p>SPEC OMP 2012是基于SPEC测试套件的OpenMP评测工具，其中包含15个基于OpenMP的并行程序。</p>
<p>1、安装工具</p>
<p>获取源包：omp2012-1.1.zip</p>
<p>解压后使用install.sh安装</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">./install.sh -d /home/xx</span><br></pre></td></tr></tbody></table></figure>

<p>2、测试步骤</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">source shrc</span><br><span class="line">ulimit -s unlimited</span><br><span class="line">export OMP_NUM_THREADS=48</span><br><span class="line">runspec --config=gcc.cfg --threads 48 -n 3 -i ref -I all</span><br></pre></td></tr></tbody></table></figure>

<p>3、补充参数说明</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">仅编译</span></span><br><span class="line">runspec --action=build --config=gcc.cfg -i ref -I all</span><br></pre></td></tr></tbody></table></figure>

<h2 id="2-CPU性能测试（整型-浮点型）"><a href="#2-CPU性能测试（整型-浮点型）" class="headerlink" title="2 CPU性能测试（整型/浮点型）"></a>2 CPU性能测试（整型/浮点型）</h2><blockquote>
<p>测试CPU整型计算性能，包括单线程基准值、满线程基准值</p>
<p>测试CPU浮点计算性能，包括单线程基准值、满线程基准值</p>
</blockquote>
<h3 id="2-1-使用CPU2006"><a href="#2-1-使用CPU2006" class="headerlink" title="2.1 使用CPU2006"></a>2.1 使用CPU2006</h3><blockquote>
<p>测试环境:</p>
<p>​	CPU：飞腾D2000</p>
<p>​	内存：16G</p>
<p>​	系统：麒麟V10-SP1-2107 桌面操作系统</p>
</blockquote>
<p>1、准备</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">测试工具包：</span><br><span class="line">d2000-spec2006test.tar.gz</span><br></pre></td></tr></tbody></table></figure>

<p>系统优化：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改操作系统/boot/efi/EFI/kylin/grub.cfg</span></span><br><span class="line">sed -i ‘s/video=VGA-1:640x480-32@60me/&amp; mitigations=off /’ /boot/efi/EFI/kylin/grub.cfg</span><br><span class="line">sed -i ‘s/video=VGA-1:640x480-32@60me/&amp; selinux=0 audit=0 /’ /boot/efi/EFI/kylin/grub.cfg    （注：与上面是同一行，注意空格）</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置透明页</span></span><br><span class="line">echo always &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">操作系统打开性能模式，关闭服务</span></span><br><span class="line">tuned-adm profile throughput-performance</span><br><span class="line">for srv in firewalld auditd irqbalance tuned; do for act in stop disable; do systemctl $act ${srv}.service</span><br><span class="line">输入done</span><br><span class="line">输入done </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭SELINUX</span></span><br><span class="line">sed -i ‘/^SELINUX=/s/=.*$/=disabled/g’ /etc/selinux/config </span><br></pre></td></tr></tbody></table></figure>

<p>2、测试步骤</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1、把下载好的d2000-spec2006test.tar.gz测试包放到根目录下（建议整机内存≥16GB，否则会影响测试跑分）</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果不知道如何放到根目录下，可以先把d2000-spec2006test.tar.gz这个包放到桌面，然后点击鼠标右键打开终端，<span class="built_in">sudo</span> su ，然后输入密码进入root权限，然后输入<span class="built_in">cp</span> -r d2000-spec2006test.tar.gz /  ，这样就复制到了根目录下。</span> </span><br><span class="line">2、cd / ，进入根目录，sudo su ，然后输入密码，进入root权限。</span><br><span class="line">3、解压，tar -xvf d2000-spec2006test.tar.gz</span><br><span class="line">4、更改权限，chmod -R 777 cpu2006-1.2</span><br><span class="line">5、进入spec2006目录，cd cpu2006-1.2</span><br><span class="line">6、执行脚本，bash run.sh   #配置依赖环境，！！需要联网，会自动下载部分依赖！！</span><br><span class="line">7、source /etc/profile  #更新profile文件,此处一定要更新</span><br><span class="line">8、source ./shrc    #配置环境变量	</span><br><span class="line">9、ulimit -s unlimited #内存分配无限制，大于或者等于16G内存的机器可以加此命令，如果是8G内存的机器不要运行此命令，会因内存不够用影响整型测试的429测试项</span><br><span class="line">10、echo 3 &gt; /proc/sys/vm/drop_caches   #执行测试前，建议清一下缓存</span><br><span class="line">11、gcc -v   #测试前查看一下gcc的版本是否为GCC931,若不是GCC931，输入source /etc/profile， 再gcc -v查看版本，是GCC931即可执行第12步启动测试</span><br><span class="line">12、bash d2000-test.sh  #执行8核、单核的整形和浮点测试</span><br></pre></td></tr></tbody></table></figure>

<p>3、结果查看</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PDF测试结果存放在results文件夹</span><br></pre></td></tr></tbody></table></figure>

<p>4、编译问题处理（如遇到编译问题，可参考）</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">450报错：</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mpsinput.cc: In member <span class="keyword">function</span> <span class="string">'bool soplex::MPSInput::readLine()'</span>: mpsinput.cc:75:52: error: no match <span class="keyword">for</span> <span class="string">'operator=='</span> (operand types are <span class="string">'std::basic_istream&lt;char&gt;::__istream_type'</span> {aka <span class="string">'std::basic_istream&lt;char&gt;'</span>} and <span class="string">'int'</span>)</span></span><br><span class="line">g++ -std=c++03</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lto1 fatal error bytecode stream generated with lto version</span> </span><br><span class="line">编译选项添加: fno-lto</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解决zfnlm问题:</span></span><br><span class="line">actual argument contains too few elements for dummy argument 'zfnlm'</span><br><span class="line">cfg文件编译选项设置： -std=legacy</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">undefined reference to <span class="string">'__gcov_exit'</span></span></span><br><span class="line">-lgcov --coverage</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">glob.c:(.text+0x53c): undefined reference to `__alloca<span class="string">'</span></span></span><br><span class="line">编辑glob.c文件</span><br><span class="line">修改第54行"=="改为"&gt;="</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">if _GNU_GLOB_INTERFACE_VERSION &gt;= GLOB_INTERFACE_VERSION</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">2006的题483在v10-sp1-2107跑起来，我干了什么？ 否则老是报错483.xalancbmk  non-zero return code (rc=254, signal=0) XML等</span></span></span><br><span class="line">1、安装统信UOS的GCC8.3.0</span><br><span class="line">2、SPEC2006的工具集重新编译，再安装</span><br><span class="line">3、清除题下面的run/build/exe</span><br><span class="line">4、执行了一次apt-get install gcc?? 不知道有没有影响</span><br><span class="line">5、放到没有中文的路径/home/gretwall/cpu2006</span><br><span class="line">6、使用普通用户greatwall执行</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">416报错</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Note: The following floating-point exceptions are signalling: IEEE_UNDERFLOW_FLAG IEEE_DENORMAL</span></span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>4、测试项说明</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">source shrc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">多核测试（8）</span></span><br><span class="line">runspec -c greatwall.cfg -r 8 -n 1 -i ref -T base -I all</span><br><span class="line">选项解析：</span><br><span class="line">	-c # 指定config/中的配置文件</span><br><span class="line">	-r # --rate的缩写，跑rate测试，指定测试的副本数（Copies）</span><br><span class="line">	--speed # 指定跑speed测试，和测试副本数（Copies）（默认跑speed测试）</span><br><span class="line">	-n # 指定测试的次数	</span><br><span class="line">	-i（-size） # 指定测试的规模，由小到大为test/train/ref,其中test最快，适合用来验证CPU的完整性，跑分要用ref</span><br><span class="line">	--reportable / --noreportable # 表示检测/不检测生成的二进制文件是否修改过</span><br><span class="line">	--action=build	# 只编译，不测试</span><br><span class="line">	--rebuild	# 重新编译选题的二进制文件</span><br><span class="line">	--tune（-T） # 可选peak / base / all，默认跑all</span><br><span class="line">	最后的参数	# int-(int选题) / fp-(fp选题) / all-(所有选题) / 单个选题-（如483） </span><br></pre></td></tr></tbody></table></figure>

<p>5、去除PDF报告的Invalid标记</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp CINT2006.559.ref.rsf CINT2006.559.ref.rsf.retry</span><br><span class="line">rawformat --flagsurl myfixedflags.xml --output_format pdf,raw CINT2006.559.ref.rsf.retry</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-2-使用CPU2017"><a href="#2-2-使用CPU2017" class="headerlink" title="2.2 使用CPU2017"></a>2.2 使用CPU2017</h3><p>1、安装工具</p>
<p>获取镜像包：cpu2017-1_0_5.iso</p>
<p>挂载iso文件</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o loop -t iso9660 cpu2017-1_0_5.iso /xxx/cpu2017CD</span><br></pre></td></tr></tbody></table></figure>

<p>安装工具</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /xxx/cpu2017CD</span><br><span class="line">./install.sh</span><br></pre></td></tr></tbody></table></figure>

<p>2、测试步骤</p>
<p>spec2017主要分为四项测试：</p>
<ul>
<li>​	intrate</li>
<li>​	fprate</li>
<li>​	intspeed</li>
<li>​	fpspeed</li>
</ul>
<p>​	根据需要测试的cpu型号，可以到官网下载相应的cfg文件，修改icc、Jemalloc库、qkmalloc库的路径，放入config文件夹中。</p>
<p>测试命令如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">source shrc</span><br><span class="line">ulimit -s unlimited</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">speed 测试</span></span><br><span class="line">runcpu --config=icc-speed-official.cfg --threads=48 --define cores=48 -n 3 -i ref fpspeed intspeed</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rate 测试</span></span><br><span class="line">runcpu --config=icc-rate-official.cfg -copies=48 -n 3 -i ref intrate fprate</span><br></pre></td></tr></tbody></table></figure>

<p>补充参数说明</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">仅编译不跑测试</span></span><br><span class="line">--action=build</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新编译</span></span><br><span class="line">--rebuild</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">绑核跑</span></span><br><span class="line">taskset -c </span><br></pre></td></tr></tbody></table></figure>

<p>对于Intel CPU的测试优化手段</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、Bios设置：</span><br><span class="line">	开启超线程</span><br><span class="line">	尝试开启LLC-PREFETCH</span><br><span class="line">2、cfg文件中的submit可以设置绑核选项</span><br></pre></td></tr></tbody></table></figure>

<h2 id="3-SPEC-JVM-2008"><a href="#3-SPEC-JVM-2008" class="headerlink" title="3 SPEC JVM 2008"></a>3 SPEC JVM 2008</h2><p>1、安装步骤</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">确定java安装好后，将specjvm2008放到/home路径下，并安装</span></span><br><span class="line">java -jar SPECjvm2008_1_01_setup.jar -i console</span><br><span class="line">根据提示安装，全部选择默认即可，也可自行定义安装路径，默认路径为/SPECjvm2008。</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装jdk</span></span><br><span class="line">yum install -y java-1.8.0-openjdk-devel </span><br></pre></td></tr></tbody></table></figure>

<p>2、配置JAVA_HOME</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line">在文件最后添加如下几行内容</span><br><span class="line">JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-arm64</span><br><span class="line">CLASSPATH=.:$JAVA_HOME/lib/tools.jar:/lib.dt.jar</span><br><span class="line">PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">export JAVA_HOME CLASSPATH PATH</span><br><span class="line">source /etc/profile执行 source 命令使/etc/profile 文件中变量生效</span><br></pre></td></tr></tbody></table></figure>

<p>3、优化操作</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS="-Xms8192M -Xmx131072M -XX:PermSize=512M -XX:MaxPermSize=1g -Dspecjvm.benchmark.threads.scimark.fft.large=1"</span><br><span class="line"></span><br><span class="line">export JAVA_OPTS</span><br></pre></td></tr></tbody></table></figure>

<p>4、测试</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /SPECjvm2008</span><br><span class="line">sudo java -jar SPECjvm2008.jar --base -ikv</span><br><span class="line">sudo java -Xms1024m -Xmx349525m -jar SPECjvm2008.jar --peak -ikv</span><br></pre></td></tr></tbody></table></figure>

<h2 id="4-LTP测试"><a href="#4-LTP测试" class="headerlink" title="4 LTP测试"></a>4 LTP测试</h2><p>测试步骤</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/ltp-20180510</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">cd /opt/ltp</span><br><span class="line">./testscripts/ltpstress.sh -n -t 168</span><br></pre></td></tr></tbody></table></figure>

<h2 id="5-lmbench测试（用时3小时）"><a href="#5-lmbench测试（用时3小时）" class="headerlink" title="5 lmbench测试（用时3小时）"></a>5 lmbench测试（用时3小时）</h2><blockquote>
<p>测试简单的系统调用时间、shell命令启动时间、系统信号处理时间、统计2p/16K的上下文切换性能、16p/64K的上下文切换性能、0K/10K文件创建时间、0K/10K文件删除时间</p>
</blockquote>
<p>1、源码包准备：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.bitmover.com/lmbench/lmbench3.tar.gz</span><br></pre></td></tr></tbody></table></figure>

<p>2、编译前的准备：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar xvf lmbench3.tar.gz</span><br><span class="line">cd lmbench3</span><br><span class="line">mkdir SCCS</span><br><span class="line">touch  SCCS/s.ChangeSet</span><br></pre></td></tr></tbody></table></figure>

<p>3、优化操作：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">修改 Makefile 文件第 114、115 和 139 行，将 O 修改成 O2，使用 O2 编译可使性能优化。  </span><br><span class="line">cd lmbench-3.0-a9/src/ </span><br><span class="line">vim Makefile</span><br><span class="line"></span><br><span class="line">CFLAGS=-O 改为 CFLAGS=-O2</span><br></pre></td></tr></tbody></table></figure>

<p>4、编译并测试</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd lmbench3</span><br><span class="line">make results LDFLAGS=-ltirpc</span><br><span class="line">（1）MULTIPLE COPIES,选择默认</span><br><span class="line">（2）Job placement selection 选1</span><br><span class="line">（3）MB:建议不超过1G</span><br><span class="line">（4）其余选项选择默认</span><br><span class="line">（5）Mail results ，选择no</span><br><span class="line">注：服务器内存大小指定为16384，桌面采用默认大小即可。</span><br></pre></td></tr></tbody></table></figure>

<p>5、读取测试结果</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make see查看结果，results目录下。</span><br><span class="line">make rerun再次运行，不需要重新配置。（注：测试多次时执行）</span><br></pre></td></tr></tbody></table></figure>

<p>6、错误处理</p>
<p>错误一：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">报错: undefined reference to 'llseek'</span><br><span class="line">解决方法:</span><br><span class="line">修改src/disk.c文件</span><br><span class="line">将llseek改为lseek64</span><br></pre></td></tr></tbody></table></figure>

<p>错误二：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gmake[1]: Entering directory `/home/testcpu/test652/tools/lmbench3/src'</span><br><span class="line">gmake[1]: *** No rule to make target `../SCCS/s.ChangeSet', needed by `bk.ver'.  Stop.</span><br><span class="line">gmake[1]: Leaving directory `/home/testcpu/test652/tools/lmbench3/src'</span><br><span class="line"></span><br><span class="line">解决方法：</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">修改Makefile</span></span><br><span class="line">	vim Makefile</span><br><span class="line">	231行修改：</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">O/lmbench : ../scripts/lmbench bk.ver</span></span><br><span class="line">	改为</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">O/lmbench : ../scripts/lmbench</span></span><br></pre></td></tr></tbody></table></figure>

<p>错误三：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install libtirpc libtirpc-devel</span><br><span class="line">cp -rf /usr/include/tirpc/rpc/* /usr/include/rpc/，解决了丢失rpc.h的问题</span><br><span class="line">ln -s /usr/include/tirpc/netconfig.h /usr/include,解决netconfig.h的问题</span><br></pre></td></tr></tbody></table></figure>

<h2 id="6-文件读写测试"><a href="#6-文件读写测试" class="headerlink" title="6 文件读写测试"></a>6 文件读写测试</h2><blockquote>
<p>测试硬盘内文件（10G）拷贝性能，记录时间</p>
</blockquote>
<p>测试步骤</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建10G的大文件</span></span><br><span class="line">dd if=/dev/zero of=big_file count=10 bs=1G</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试拷贝时间</span></span><br><span class="line">time cp big_file  big_file_bak</span><br></pre></td></tr></tbody></table></figure>

<h2 id="7-USB存储设备读写性能"><a href="#7-USB存储设备读写性能" class="headerlink" title="7 USB存储设备读写性能"></a>7 USB存储设备读写性能</h2><blockquote>
<p>测试USB存储设备读写性能（Mb/s），平均读写速度等</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可选准备</span></span><br><span class="line">1.将U盘（USB3.0）插入被测试机器,假定识别设备为sdc</span><br><span class="line">2.创建vfat文件系统分区</span><br><span class="line">/dev/sdb1分区容量大于30GB</span><br><span class="line">umount /dev/sdc1</span><br><span class="line">mkfs -t vfat /dev/sdc1</span><br><span class="line">mkdir /upan</span><br><span class="line">mount -t vfat /dev/sdc1 /upan</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试写性能</span></span><br><span class="line">cd /upan</span><br><span class="line">dd if=/dev/zero of=./largefile bs=64k count=10000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试读性能</span></span><br><span class="line">sync &amp;&amp; echo 3 &gt; /proc/sys/vm/drop_caches</span><br><span class="line">dd if=./largefile of=/dev/null bs=64k</span><br></pre></td></tr></tbody></table></figure>



<h2 id="8-硬盘读写测试-IOZONE"><a href="#8-硬盘读写测试-IOZONE" class="headerlink" title="8 硬盘读写测试-IOZONE"></a>8 硬盘读写测试-IOZONE</h2><p>1、准备源码：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载源码包</span></span><br><span class="line">wget http://www.iozone.org/src/current/iozone3_487.tar</span><br></pre></td></tr></tbody></table></figure>

<p>2、参数说明：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">iozone</span><br><span class="line">    -a 全面测试，比如块大小它会自动加</span><br><span class="line">    -i N 用来选择测试项, 比如Read/Write/Random 比较常用的是0 1 2,可以指定成-i 0 -i 1 -i2.这些别的详细内容请查man</span><br><span class="line">        0=write/rewrite</span><br><span class="line">        1=read/re-read</span><br><span class="line">        2=random-read/write</span><br><span class="line">        3=Read-backwards</span><br><span class="line">        4=Re-write-record</span><br><span class="line">        5=stride-read</span><br><span class="line">        6=fwrite/re-fwrite</span><br><span class="line">        7=fread/Re-fread</span><br><span class="line">        8=random mix</span><br><span class="line">        9=pwrite/Re-pwrite</span><br><span class="line">        10=pread/Re-pread</span><br><span class="line">        11=pwritev/Re-pwritev</span><br><span class="line">    	12=preadv/Re-preadv</span><br><span class="line">    -r block size 指定一次写入/读出的块大小</span><br><span class="line">    -s file size 指定测试文件的大小</span><br><span class="line">    -f filename 指定测试文件的名字,完成后会自动删除(这个文件必须指定你要测试的那个硬盘中)</span><br><span class="line">    -F file1 file2… 指定多线程下测试的文件名</span><br><span class="line">    </span><br><span class="line">    批量测试项:</span><br><span class="line">    -g -n 指定测试文件大小范围,最大测试文件为4G,可以这样写 -g 4G</span><br><span class="line">    -y -q 指定测试块的大小范围</span><br><span class="line">    </span><br><span class="line">    输出:</span><br><span class="line">    下面是几个日志记录的参数.好像要输出成图象进行分析，需要指定-a的测试才能输出</span><br><span class="line">    -R 产生Excel到标准输出</span><br><span class="line">    -b 指定输出到指定文件上. 比如 -Rb ttt.xls</span><br></pre></td></tr></tbody></table></figure>

<p>3、执行：df -h，查看可用空间需大于2倍内存大小的路径。</p>
<p>4、优化操作</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HDD优化：</span><br><span class="line">echo deadline &gt; /sys/block/sdb/queue/scheduler </span><br><span class="line">echo 65536 &gt; /sys/block/sdb/queue/nr_requests</span><br><span class="line">echo 65536 &gt; /sys/block/sdb/queue/read_ahead_kb</span><br><span class="line">echo 1 &gt; /proc/sys/vm/drop_caches </span><br><span class="line">echo 40 &gt; /proc/sys/vm/dirty_background_ratio</span><br><span class="line">echo 80 &gt; /proc/sys/vm/dirty_ratio </span><br><span class="line">将磁盘格式化为 xfs 格式</span><br><span class="line">mkfs.xfs -f -d agcount=256 -l size=128m,lazy-count=1,version=2 /dev/sdb（按实际盘符）</span><br></pre></td></tr></tbody></table></figure>

<p>5、编译</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd iozone3_482/src/current </span><br><span class="line">make linux-arm</span><br><span class="line">./iozone -i 0 -i 1 -i 2 -s 16g -r 16m -f /date/tmpfile</span><br><span class="line">注：iozone 在测试过程中测试规模要大于或等于物理内存的两倍，且保证测试硬盘 </span><br><span class="line">空闲空间大于测试规模，如果测试规模偏小导致内存压力不够大会使分数不准确。X为内存大小的1/2倍、1倍、2倍，-f指定测试文件，测试完自动删除。</span><br></pre></td></tr></tbody></table></figure>

<p>6、测试</p>
<blockquote>
<p>1、测试硬盘读写性能（Mb/s），包括随机和顺序读写平均读写速度（IOzone设置块大小16M，文件大小为物理内存2倍、1倍、1/2倍三组数据）</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">需要root权限</span></span><br><span class="line">sudo su</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">块大小16M，文件大小为物理内存2倍（测试机器内存为8G的情况下）</span></span><br><span class="line">./iozone -i 0 -i 1 -i 2 -s 16g -r 16m -f /iozone.tmpfile -Rb ./report/iotest_16G_0.xls</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">块大小16M，文件大小为物理内存1倍（测试机器内存为8G的情况下）</span></span><br><span class="line">./iozone -i 0 -i 1 -i 2 -s 8g -r 16m -f /iozone.tmpfile -Rb ./report/iotest_8G_0.xls</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">块大小16M，文件大小为物理内存0.5倍（测试机器内存为8G的情况下）</span></span><br><span class="line">./iozone -i 0 -i 1 -i 2 -s 4g -r 16m -f /iozone.tmpfile -Rb ./report/iotest_4G_0.xls</span><br></pre></td></tr></tbody></table></figure>

<h2 id="9-硬盘测试-FIO"><a href="#9-硬盘测试-FIO" class="headerlink" title="9 硬盘测试-FIO"></a>9 硬盘测试-FIO</h2><p>1、配置优化</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、组raid，使用3块硬盘组成raid5，划分分区，不做文件系统，不挂载，并设置如下：</span></span><br><span class="line">write policy：alway write back</span><br><span class="line">BGI：yes</span><br><span class="line">I/O：cache</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、修改磁盘策略</span></span><br><span class="line">echo mq-deadline &gt; /sys/block/sdb/queue/scheduler</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、关闭IO merge</span></span><br><span class="line">echo 2 &gt; /sys/block/sdb/queue/nomerges</span><br></pre></td></tr></tbody></table></figure>

<p>2、安装编译</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/fio-3.2</span><br><span class="line">./configure</span><br><span class="line">make </span><br><span class="line">make install</span><br></pre></td></tr></tbody></table></figure>

<p>3、开始测试</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">顺序读性能测试</span></span><br><span class="line">fio -filename=/dev/XXXX -ioengine=psync -time_based=1 -rw=read -direct=1 -buffered＝0 -thread -size=110g -bs=XXK -numjobs=16 -iodepth=1 -runtime=300 -lockmem=1G -group_reporting -name=“cepreiTest-IOread”</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">顺序写性能测试</span></span><br><span class="line">fio -filename=/dev/XXXX -ioengine=psync -time_based=1 -rw=write -direct=1 -buffered＝0 -thread -size=110g -bs=XXK -numjobs=16 -iodepth=1 -runtime=300 -lockmem=1G -group_reporting -name=“cepreiTest-IOwrite”</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试时，-filename后指定硬盘裸读写的分区，不可使用系统盘，会使系统崩溃；-bs指定块大小，分别指定512B、1M，各测试3次；部分硬盘不支持512B,改用4K，报告中注明</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="10-内存读写性能测试-Stream"><a href="#10-内存读写性能测试-Stream" class="headerlink" title="10 内存读写性能测试-Stream"></a>10 内存读写性能测试-Stream</h2><blockquote>
<p>STREAM是一套综合性能测试程序集，通过fortran和C两种高级且高效的语言编写完成，由于这两种语言在数学计算方面的高效率， 使得 STREAM 测试例程可以充分发挥出内存的能力。Stream测试是内存测试中业界公认的内存带宽性能测试基准工具。</p>
<p>用户测试内存单线程和并发读写性能（Mb/s）</p>
</blockquote>
<p>1、编译安装</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装gfortran</span></span><br><span class="line">sudo apt-get install gfortran</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改源码中的ArraySize</span></span><br><span class="line">{最高级缓存X MB}×1024×1024×4.1×CPU路数/8，结果取整数</span><br><span class="line">解释：由于stream.c源码推荐设置至少4倍最高级缓存，且STREAM_ARRAY_SIZE为double类型=8 Byte。所以公式为：最高级缓存(单位：Byte)×4.1倍×CPU路数/8</span><br><span class="line">例如：测试机器是双路CPU，最高级缓存32MB，则计算值为32×1024×1024×4.1×2/8≈34393292</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">单线程编译</span></span><br><span class="line">gcc -O3 stream.c -o stream</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">多线程编译</span></span><br><span class="line">gcc -O3 -fopenmp stream.c -o stream_omp</span><br></pre></td></tr></tbody></table></figure>

<p>2、系统优化</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、修改操作系统/boot/efi/EFI/kylin/grub.cfg</span></span><br><span class="line">sed -i ‘s/video=VGA-1:640x480-32@60me/&amp; mitigations=off /’ /boot/efi/EFI/kylin/grub.cfg</span><br><span class="line">sed -i ‘s/video=VGA-1:640x480-32@60me/&amp; selinux=0 audit=0 /’ /boot/efi/EFI/kylin/grub.cfg    </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、配置透明页</span></span><br><span class="line">echo always &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、操作系统打开性能模式，关闭服务</span></span><br><span class="line">tuned-adm profile throughput-performance</span><br><span class="line">for srv in firewalld auditd irqbalance tuned; do for act in stop disable; do systemctl $act ${srv}.service</span><br><span class="line">输入done</span><br><span class="line">输入done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4 、关闭SELINUX</span></span><br><span class="line">sed -i ‘/^SELINUX=/s/=.*$/=disabled/g’ /etc/selinux/config </span><br></pre></td></tr></tbody></table></figure>

<p>3、单线程测试</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/stream</span><br><span class="line">vim stream.c或者双击打开stream.c</span><br><span class="line">修改define N 80000000</span><br><span class="line"></span><br><span class="line">gcc -O3 -mtune=native -march=native -mcmodel=large -DNTIME=50 stream.c -o stream</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line">nice -n -20 ./stream（多执行几次，数值会越好，取最大值）</span><br></pre></td></tr></tbody></table></figure>

<p>4、多线程测试（双路128核CPU）</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/stream</span><br><span class="line">vim stream.c或者双击打开stream.c</span><br><span class="line">修改define N 800000000（按照256内存计算）</span><br><span class="line"></span><br><span class="line">gcc -O3 -fopenmp -mtune=native -march=native -mcmodel=large -DNTIME=50 stream.c -o stream</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">绑核</span></span><br><span class="line">export OMP_NUM_THREADS=128</span><br><span class="line">export GOMP_CPU_AFFINITY=0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line">nice -n -20 ./stream（多执行几次，数值会越好，取最大值）</span><br></pre></td></tr></tbody></table></figure>

<h2 id="11-操作系统综合性能测试-unixbench（用时1小时）"><a href="#11-操作系统综合性能测试-unixbench（用时1小时）" class="headerlink" title="11 操作系统综合性能测试-unixbench（用时1小时）"></a>11 操作系统综合性能测试-unixbench（用时1小时）</h2><p>系统优化：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">分别率修改：修改操作系统/boot/efi/EFI/kylin/grub.cfg</span></span><br><span class="line">sed -i ‘s/video=VGA-1:640x480-32@60me/&amp; mitigations=off /’ /boot/efi/EFI/kylin/grub.cfg</span><br><span class="line">sed -i ‘s/video=VGA-1:640x480-32@60me/&amp; selinux=0 audit=0 /’ /boot/efi/EFI/kylin/grub.cfg    </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置透明页</span></span><br><span class="line">echo always &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">操作系统打开性能模式，关闭服务</span></span><br><span class="line">tuned-adm profile throughput-performance</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭服务</span></span><br><span class="line">for srv in firewalld auditd irqbalance tuned; do for act in stop disable; do systemctl $act ${srv}.service</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="keyword">done</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="keyword">done</span></span></span><br><span class="line">Removed /etc/systemd/system/multi-user.target.wants/firewalld.service.</span><br><span class="line">Removed /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</span><br><span class="line">Removed /etc/systemd/system/multi-user.target.wants/auditd.service.</span><br><span class="line">Removed /etc/systemd/system/multi-user.target.wants/irqbalance.service.</span><br><span class="line">Removed /etc/systemd/system/multi-user.target.wants/tuned.service.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭selinux</span> </span><br><span class="line">sed -i '/^SELINUX=/s/=.*$/=disabled/g' /etc/selinux/config</span><br></pre></td></tr></tbody></table></figure>

<p>开始测试：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压UnixBench工具包：</span></span><br><span class="line">unzip Unixbench-Kylin.zip</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入Unixbench解压后的目录下</span></span><br><span class="line">cd UnixBench</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改Makefile文件74行</span></span><br><span class="line">OPTON = -O3 -fomit-frame-pointer -fforce-addr -ffast-math -Wall -static -flto</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译：</span></span><br><span class="line">sudo make clean &amp;&amp; make</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清除缓存：</span></span><br><span class="line">sudo su</span><br><span class="line">sync</span><br><span class="line">echo 3 &gt; /proc/sys/vm/drop_caches</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试单线程和多线程性能，执行命令：</span></span><br><span class="line">sudo ./Run -c 1 -c N</span><br><span class="line">// 其中N代表cpu核数</span><br></pre></td></tr></tbody></table></figure>

<h2 id="12-显卡性能测试-unixbench（用时约半小时）"><a href="#12-显卡性能测试-unixbench（用时约半小时）" class="headerlink" title="12 显卡性能测试-unixbench（用时约半小时）"></a>12 显卡性能测试-unixbench（用时约半小时）</h2><blockquote>
<p>1、测试2D显示处理性能，主要包括画点、画线、画三角形、画平行四边形、画正方形、画多边形等性能测试</p>
<p>2、测试3D显示处理性能，主要包括3D的显示、色彩填充、渲染、旋转等性能测试</p>
</blockquote>
<p>编译Unibench</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装依赖</span></span><br><span class="line">apt-get install libgl1-mesa-dev</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改Makefile文件,防止编译报错</span></span><br><span class="line">vim UnixBench/Makefile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第47行取消注释</span></span><br><span class="line">GRAPHIC_TESTS = defined</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第50行加上-lm</span></span><br><span class="line">GL_LIBS = -lGL -lXext -lX11 -lm</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第74行修改</span></span><br><span class="line">OPTON = -O2 -fomit-frame-pointer -fforce-addr -ffast-math -Wall</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改Run文件</span></span><br><span class="line">vim UnixBench/Run</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第109-112行，修改可支持的最大核数，当前是8</span></span><br><span class="line">'system'    =&gt; { 'name' =&gt; "System Benchmarks", 'maxCopies' =&gt; 8 },</span><br><span class="line">'2d'        =&gt; { 'name' =&gt; "2D Graphics Benchmarks", 'maxCopies' =&gt; 8 },</span><br><span class="line">'3d'        =&gt; { 'name' =&gt; "3D Graphics Benchmarks", 'maxCopies' =&gt; 8 },</span><br><span class="line">'misc'      =&gt; { 'name' =&gt; "Non-Index Benchmarks", 'maxCopies' =&gt; 8 },</span><br></pre></td></tr></tbody></table></figure>

<p>编译运行</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clean &amp;&amp; make -j 8</span><br><span class="line">./Run graphics</span><br></pre></td></tr></tbody></table></figure>

<p>3D测试优化</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建文件10-vsync.conf</span></span><br><span class="line">&lt;driconf&gt;</span><br><span class="line">    &lt;option name="vblank_mode" value="0" /&gt;</span><br><span class="line">&lt;/driconf&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝文件到指定路径</span></span><br><span class="line">sudo cp 10-vsync.conf  ~/.drirc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行测试</span></span><br><span class="line">vblank_mode=0 ./Run ubgears</span><br></pre></td></tr></tbody></table></figure>

<h2 id="13-显卡测试-Glmark2"><a href="#13-显卡测试-Glmark2" class="headerlink" title="13 显卡测试-Glmark2"></a>13 显卡测试-Glmark2</h2><p>安装</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ./waf configure --with-flavors=x11-gl</span><br><span class="line">sudo ./waf build -j 4</span><br><span class="line">sudo ./waf install</span><br></pre></td></tr></tbody></table></figure>

<p>测试</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glmark2</span><br></pre></td></tr></tbody></table></figure>

<h2 id="14-显卡测试-Glxgears"><a href="#14-显卡测试-Glxgears" class="headerlink" title="14 显卡测试-Glxgears"></a>14 显卡测试-Glxgears</h2><p>安装</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mesa-utils</span><br></pre></td></tr></tbody></table></figure>

<p>测试</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">终端执行</span></span><br><span class="line">vblank_mode=0 glxgears</span><br></pre></td></tr></tbody></table></figure>

<h2 id="15-网络性能测试-iperf3"><a href="#15-网络性能测试-iperf3" class="headerlink" title="15 网络性能测试-iperf3"></a>15 网络性能测试-iperf3</h2><blockquote>
<p>测试网络传输速率、重传等</p>
</blockquote>
<p>可以用源安装或者编译安装</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install iperf3</span><br></pre></td></tr></tbody></table></figure>

<p>常用参数：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-u：发送 UDP 包，仅客户端可用，服务端默认 tcp udp 都可以接收</span><br><span class="line">-b：指定发送速率（比如 100M），发送端不受限速影响，如果有限速，也只是接收端有影响</span><br><span class="line">-p：后接服务端监听的端口</span><br><span class="line">-i：设置带宽报告的时间间隔，单位为秒</span><br><span class="line">-t：设置测试的时长，单位为秒</span><br><span class="line">-w：设置tcp窗口大小，一般可以不用设置，默认即可</span><br><span class="line">-B：绑定客户端的ip地址</span><br><span class="line">-4：指定 ipv4</span><br><span class="line">-n：指定传输的字节数</span><br><span class="line">-f：格式化带宽数输出，后接单位，比如 K，M</span><br><span class="line">--get-server-output：在客户端直接获取服务端输出的结果</span><br></pre></td></tr></tbody></table></figure>

<p>使用方法：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、服务端10.47.74.25开启server服务</span></span><br><span class="line">iperf3 -s</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、客户端10.47.76.198发起连接</span></span><br><span class="line">iperf3 -c 10.47.74.25 -i 5 -t 30</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、如服务端拒绝连接请求，需考虑firewall或者selinux</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="16-网络性能-Netperf"><a href="#16-网络性能-Netperf" class="headerlink" title="16 网络性能-Netperf"></a>16 网络性能-Netperf</h2><p>1、安装编译</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd netperf-2.7.0/ </span><br><span class="line">./configure --build=arm </span><br><span class="line">make&amp;&amp;make install</span><br></pre></td></tr></tbody></table></figure>

<p>2、优化操作</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">客户端与服务端相同优化方法</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注释配置参数</span></span><br><span class="line">vim /usr/lib/sysctl.d/kylin.conf 注释掉 kylin.conf 中所有参数 </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭 swap 交换分区和自动化 NUMA 平衡</span> </span><br><span class="line">vim /etc/sysctl.conf </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">增加 vm.swappiness=0</span> </span><br><span class="line">Kernel.numa_balancing=0 </span><br><span class="line">sysctl -p </span><br><span class="line">reboot 重启操作系统</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置高性能</span> </span><br><span class="line">tuned-adm profile throughput-performance </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭服务</span> </span><br><span class="line">systemctl stop firewalld.service </span><br><span class="line">systemctl stop auditd.service </span><br><span class="line">systemctl stop irqbalance.service </span><br><span class="line">systemctl stop tuned.service </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清理缓存</span> </span><br><span class="line">echo 3 &gt; /proc/sys/vm/drop_caches </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置 MTU</span> </span><br><span class="line">ifconfig 网口名称 mtu 9000 </span><br></pre></td></tr></tbody></table></figure>

<p>3、开始测试</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">服务端和客户端关闭防火墙systemctl stop firewalld.service</span><br><span class="line">服务端运行 </span><br><span class="line">cd src/ </span><br><span class="line">./nerserver </span><br><span class="line">客户端运行 </span><br><span class="line">cd src/ </span><br><span class="line">./netperf -H serverip -l 60 -t TCP_STREAM </span><br><span class="line">./netperf -H serverip -l 60 -t UDP_STREAM </span><br><span class="line">./netperf -H serverip -l 120 -t TCP_RR </span><br><span class="line">./netperf -H serverip -l 120 -t UDP_RR</span><br></pre></td></tr></tbody></table></figure>

<h2 id="17-CPU、内存压测-stress"><a href="#17-CPU、内存压测-stress" class="headerlink" title="17 CPU、内存压测-stress"></a>17 CPU、内存压测-stress</h2><blockquote>
<p>stress是一款压力测试工具，可以用它来对系统CPU，内存，以及磁盘IO生成负载。</p>
</blockquote>
<p>安装stress</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install stress</span><br></pre></td></tr></tbody></table></figure>

<p>使用stress</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">stress [option]</span><br><span class="line"></span><br><span class="line">-? 显示帮助信息</span><br><span class="line">-v 显示版本号</span><br><span class="line">-q 不显示运行信息</span><br><span class="line">-n，--dry-run 显示已经完成的指令执行情况</span><br><span class="line">-t --timeout N 指定运行N秒后停止</span><br><span class="line">   --backoff N 等待N微妙后开始运行</span><br><span class="line">-c --cpu 产生n个进程 每个进程都反复不停的计算随机数的平方根</span><br><span class="line">-i --io  产生n个进程 每个进程反复调用sync()，sync()用于将内存上的内容写到硬盘上</span><br><span class="line">-m --vm n 产生n个进程,每个进程不断调用内存分配malloc和内存释放free函数</span><br><span class="line">   --vm-bytes B 指定malloc时内存的字节数 (默认256MB)</span><br><span class="line">   --vm-hang N 指示每个消耗内存的进程在分配到内存后转入休眠状态，与正常的无限分配和释放内存的处理相反，这有利于模拟只有少量内存的机器</span><br><span class="line">-d --hadd n 产生n个执行write和unlink函数的进程</span><br><span class="line">   --hadd-bytes B 指定写的字节数，默认是1GB</span><br><span class="line">   --hadd-noclean 不要将写入随机ASCII数据的文件Unlink</span><br><span class="line">    </span><br><span class="line">时间单位可以为秒s，分m，小时h，天d，年y，文件大小单位可以为K，M，G</span><br></pre></td></tr></tbody></table></figure>

<p>使用stress进行CPU压测</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">128进程压测</span></span><br><span class="line">stress -c 128</span><br></pre></td></tr></tbody></table></figure>

<p>使用stress进行内存压测</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建三个进程，每个进程使用300M内存</span></span><br><span class="line">stress -m 3 --vm-bytes 300M</span><br></pre></td></tr></tbody></table></figure>

<p>使用stress进行磁盘压测</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">stress -i N 会产生N个进程，每个进程反复调用<span class="built_in">sync</span>()将内存上的内容写到硬盘上.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">stress -d N 会产生N个进程，每个进程往当前目录中写入固定大小的临时文件，然后执行<span class="built_in">unlink</span>操作删除该临时文件。 临时文件的大小默认为1G，但可以通过 --hdd-bytes 设置临时文件的大小。比如</span></span><br><span class="line">stress -i 2 -d 4 </span><br></pre></td></tr></tbody></table></figure>

<p>同时对多个指标进行压力测试，只需要把上面的参数组合起来就行</p>
<h2 id="18-NPB测试"><a href="#18-NPB测试" class="headerlink" title="18 NPB测试"></a>18 NPB测试</h2><p>NAS并行基准测试程序（NPB），是由美国航空航天局开发的一套代表流体动力学计算的应用程序集，它已经成为公认的用于测评大规模并行机和超级计算机的标准测试程序。NPB可用于常用的编程模型，如MPI和OpenMP。</p>
<p>1、工具安装</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">源包获取：</span><br><span class="line">	NPB3.4.tar.gz         OpenMP || MPICH</span><br><span class="line">	NPB3.4-MZ.tar.gz  OpenMP &amp;&amp; MPICH</span><br><span class="line">解压即可。</span><br></pre></td></tr></tbody></table></figure>

<p>2、测试步骤</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make suite</span><br><span class="line">cd bin</span><br><span class="line">mpirun -np 4 ./xxx</span><br></pre></td></tr></tbody></table></figure>

<h2 id="19-Linpack测试"><a href="#19-Linpack测试" class="headerlink" title="19 Linpack测试"></a>19 Linpack测试</h2><blockquote>
<p>Linpack是国际上使用最广泛的测试高性能计算机系统浮点性能的基准测试。通过对高性能计算机采用高斯消元法求解一元 N次稠密线性代数方程组的测试，评价高性能计算机的浮点计算性能。Linpack的结果按每秒浮点运算次数（flops）表示。</p>
<p> N ^ 2 * 8 = 总内存</p>
</blockquote>
<p>1、工具安装</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">源包获取：linpack.tgz</span><br><span class="line">解压即可。</span><br></pre></td></tr></tbody></table></figure>

<p>2、测试步骤</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1进48线100G内存</span></span><br><span class="line">./xhpl -n 1 -b 384 -p 1 -q 1 -m 100000</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1进48线200G内存</span></span><br><span class="line">./xhpl -n 1 -b 384 -p 1 -q 1 -m 200000</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2进24线共100G内存</span></span><br><span class="line">mpirun -n 2 ./xhpl -b 384 -p 1 -q 2 -m 50000</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2进24线共200G内存</span></span><br><span class="line">mpirun -n 2 ./xhpl -b 384 -p 1 -q 2 -m 100000</span><br></pre></td></tr></tbody></table></figure>

<p>用mpirun提交xhplrun.sh效果更好</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PRO_SIZE=${PMI_SIZE}</span><br><span class="line">threads=`echo ${Cores}/${PMI_SIZE} | bc`</span><br><span class="line">PMI_RANK_my=${PMI_RANK}</span><br></pre></td></tr></tbody></table></figure>

<p>3、测试优化</p>
<blockquote>
<p>一、计算理论内存总带宽</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">计算方法：</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">查看内存带宽：</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">dmidecode | grep -A 16 <span class="string">"Memory Device"</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">例如内存信息为：</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">三星 DDR4</span> </span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">16G 每根</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">2666 MT/s（Mhz）</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">查看cpu支持的通道数，例如intel 6252N支持6通道，两个CPU支持12通道</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">理论带宽计算DDR4：</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">单条内存带宽 = 内存核心频率 x 内存总线位数 x 倍增系数</span></span><br><span class="line"> = 2666 * 64 / 8 = 21328 MB/s = 21.3G/s</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">12通道总内存带宽 = 21328 * 12 = 255936 = 250G/s</span></span><br></pre></td></tr></tbody></table></figure>

<p>二、使用stream测试实际内存总带宽</p>
<p>​	如果可以达到90%或以上，说明内存带宽正常, 继续Linpack测试</p>
<p>三、计算CPU理论峰值</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">计算方法：</span></span><br><span class="line">Mhz * 每个时钟周期执行浮点运算的次数 * CPU数目</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">=</span></span><br><span class="line">2.3 x ( 8 x 2 x 2 ) x 48 = 3532.8 Gflops</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">说明：</span></span><br><span class="line">峰值计算分为单精度和双精度浮点运算</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">单精度：</span></span><br><span class="line">32bit的指令长度的运算，对应32位操作系统</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">双精度：</span></span><br><span class="line">64bit的指令长度的运算，对应64位操作系统</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">查找CPU可以处理什么样的指令集：</span></span><br><span class="line">例如Intel官网查到Intel Xeon 6252N</span><br><span class="line">支持AVX-512，</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">of AVX-512 FMA Units = 2</span></span><br><span class="line">(Fused Multiply Add instructions) 融合了 乘法 和 加法</span><br><span class="line">即可以单个周期同时执行2条512bit的加法和2条512bit的乘法</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">理解上述两个概念，可以开始计算（CPU单周期浮点计算能力）</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">Intel 6252N (支持avx512，有512位)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">单精度：</span></span><br><span class="line">2.3 x 512/32 x 2 x 2 = 147.2Gflops </span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">双精度</span></span><br><span class="line">2.3 x 512/64 x 2 x 2 = 73.6Gflops</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">双精度共48核</span></span><br><span class="line">74.6 x 48 = 3580</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">FT2000+ 和 FT1500A (只有128位)，FT3000加入sve指令集(128-256位)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">单精度：</span> </span><br><span class="line">2.2 x 128/32 * 2 = 4.4</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">双精度:</span></span><br><span class="line">2.2 x 128/64 * 2 = 8.8</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">双精度共64核</span></span><br><span class="line">8.8 x 64 = 563.2</span><br></pre></td></tr></tbody></table></figure>

<p>四、使用Linapack测试CPU实际峰值</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">如果性能达到理论峰值的70%说明正常，如果未达到尝试以下优化</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">1、使用mpirun运行xhpl, 按`lscpu` 中的NUMA分组绑定,`比如48核，分为两个Numa Node`, 则用mpirun`跑两个xhpl进程`，每个进程使用 OMP_NUM_THREADS=24, 跑24线程，这样可以将核用满。</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">在`Intel`平台，两个进程分别使用 HPL_HOST_CORE=<span class="string">'0-23'</span> 以及 HPL_HOST_CORE=<span class="string">'24-47'</span> 绑定核</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">在`Arm64`平台，则使用 GOMP_CPU_AFFINITY=<span class="string">'0-23'</span> 以及 GOMP_CPU_AFFINITY=<span class="string">'24-47'</span> 绑定</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">2、内存不用分配太大，根据stream测试结果分配，从小开始测</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">3、Intel平台编译器使用ICC，测试linpack使用icc自带的linpack，mpi使用icc自带的</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">4、Bios中关闭超线程，开启超频(turbo/P-state)</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong><font color="blue">先测stream,判断带宽是否正常，再测linpack，然后再测Spec Cpu</font></strong></p>
</blockquote>
<p>4、Intel平台</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Intel平台可以使用的控制频率的命令</span></span><br><span class="line">cpupower -c all frequency-set -g performance</span><br><span class="line">cpupower -c 0-95 frequency-set -g userspace</span><br><span class="line">cpupower -c 0-95 frequency-set -f 2700000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前频率控制是否为perfomance？</span></span><br><span class="line">cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">跑xhpl之前设置指令集，或许有用</span></span><br><span class="line">export MKL_ENABLE_INSTRUCTIONS=AVX512</span><br></pre></td></tr></tbody></table></figure>

<p>5、HPL.dat修改</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第1-2行，注释说明行</span></span><br><span class="line">HPLinpack benchmark input file   </span><br><span class="line">Innovative Computing Laboratory, University of Tennessee  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第 3-4 行，输出结果文件的形式</span></span><br><span class="line">HPL.out      output file name (if any)  </span><br><span class="line">6            device out (6=stdout,7=stderr,file) </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5-6行，求解矩阵的大小</span></span><br><span class="line">1            # of problems sizes (N)  </span><br><span class="line">1000         Ns   </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">7-8行 求解矩阵分块的大小</span></span><br><span class="line">1            # of NBs</span><br><span class="line">192 256      NBs</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">9行 处理器阵列的排列方式，行还是列</span></span><br><span class="line">0：适用于节点较少，单个节点CPU较多的胖系统</span><br><span class="line">1：适用于节点较多，单个节点CPU较少的瘦系统（机群上远好于按行排列）</span><br><span class="line">1            PMAP process mapping (0=Row-,1=Column-major) </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">10-12行 定义二维处理网格P/Q</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">P X Q = 进程数，P尽量小于Q</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">P=2^n,P最好选择2的幂</span></span><br><span class="line">1            # of process grids (P x Q) </span><br><span class="line">1 2          Ps</span><br><span class="line">1 2          Qs</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">13行 设置阀值，不用修改</span></span><br><span class="line">16.0         threshold</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">14-21行 设置L的分解方式</span></span><br><span class="line">1            # of panel fact</span><br><span class="line">2 1 0        PFACTs (0=left, 1=Crout, 2=Right) # 对性能影响不大</span><br><span class="line">1            # of recursive stopping criterium</span><br><span class="line">4 8          NBMINs (&gt;= 1)   # 4或8都不错</span><br><span class="line">1            # of panels in recursion</span><br><span class="line">2            NDIVs  # 选2比较理想</span><br><span class="line">1            # of recursive panel fact.</span><br><span class="line">1 0 2        RFACTs (0=left, 1=Crout, 2=Right) # 对性能影响不大</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">22-23行 设置L的横向广播方式</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">前四种，适用于快速网络，后两种适用于速度较慢的网络</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">小规模系统，选择0/1，大规模系统选择3</span></span><br><span class="line">1            # of broadcast</span><br><span class="line">0            BCASTs (0=1rg,1=1rM,2=2rg,3=2rM,4=Lng,5=LnM)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">24-25行 设置横向通信的通信深度</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">小规模系统选择1/2，大规模系统2-5之间</span></span><br><span class="line">1            # of lookahead depth</span><br><span class="line">1            DEPTHs (&gt;=0)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">26-27 设置U的广播算法</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">小规模系统，使用缺省值即可</span></span><br><span class="line">0            SWAP (0=bin-exch,1=long,2=mix)</span><br><span class="line">1            swapping threshold</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">28-29行 L和U的数据存放格式</span></span><br><span class="line">0：按列存放</span><br><span class="line">1：按行存放</span><br><span class="line">0            L1 in (0=transposed,1=no-transposed) form</span><br><span class="line">0            U  in (0=transposed,1=no-transposed) form</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">30-31 缺省值即可</span></span><br><span class="line">0            Equilibration (0=no,1=yes)</span><br><span class="line">8            memory alignment in double (&gt; 0)</span><br></pre></td></tr></tbody></table></figure>

<p>6、测试脚本编写</p>
<p>本地mpirun测试脚本（Intel版本）</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">本地单节点测试，需要根据`lscpu`中numa分区情况(node)的使用mpirun测试xhpl</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">eg:在未开超线程的情况下，分为两个node，每个node中有12个核，则最佳测试方法为mpirun -np 2 ./myrun.sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以下为myrun.sh的具体实现</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">ulimit -s unlimited</span><br><span class="line">Cores=48</span><br><span class="line">ThreadsNum=`echo "${Cores}/${PMI_SIZE}" | bc` # 计算每个进程跑的线程数</span><br><span class="line">case ${PMI_SIZE} in</span><br><span class="line">2)</span><br><span class="line">        case ${PMI_RANK} in</span><br><span class="line">        0)</span><br><span class="line">        export OMP_NUM_THREADS=${ThreadsNum}</span><br><span class="line">        export HPL_HOST_CORE='0-23'</span><br><span class="line">        ./xhpl -n 1 -b 384 -p ${1} -q ${2} -m ${3}</span><br><span class="line">        ;;</span><br><span class="line">        1)</span><br><span class="line">        export OMP_NUM_THREADS=${ThreadsNum}</span><br><span class="line">        export HPL_HOST_CORE='24-47'</span><br><span class="line">        ./xhpl -n 1 -b 384 -p ${1} -q ${2} -m ${3}</span><br><span class="line">        ;;</span><br><span class="line">        esac</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></tbody></table></figure>

<p>Slurm srun测试脚本(FT版本)</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xhplrun.sh</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">ulimit -s unlimited</span><br><span class="line">Cores=48</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">==================================================================</span><br><span class="line">PMI_SIZE=$SLURM_NPROCS</span><br><span class="line">PMI_RANK=$SLURM_PROCID</span><br><span class="line">MPI_NUM_NODE=$SLURM_NNODES</span><br><span class="line">MPI_PER_NODE=$((PMI_SIZE / MPI_NUM_NODES))</span><br><span class="line">MPI_RANK_FOR_NODE=$((PMI_RANK % MPI_PER_NODE))</span><br><span class="line"></span><br><span class="line">PRO_SIZE=${MPI_PER_NODE}</span><br><span class="line">PMI_RANK_my=${MPI_RANK_FOR_NODE}</span><br><span class="line">==================================================================</span><br><span class="line"></span><br><span class="line">echo ${PRO_SIZE} ${PMI_RANK_my} ${threads} ${PMI_SIZE} ${PMI_RANK} ${MPI_NUM_NODES} ${MPI_PER_NODE} ${MPI_RANK_FOR_NODE}</span><br><span class="line"></span><br><span class="line">export HPL_CMDLINE=1</span><br><span class="line">case ${PRO_SIZE} in</span><br><span class="line">1)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 0-1 -N 0-1 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 0,4 -N 0-7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 0-7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='0-63'</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">case ${PMI_RANK_my} in</span><br><span class="line">0)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 0-3 -N 0-3 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -m 3 -N 0-3 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='0-31'</span><br><span class="line">numactl -i 4-7 -N 0-3 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 4-7 -N 4-7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -m 7 -N 4-7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='32-63'</span><br><span class="line">numactl -i 0-3 -N 4-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mpirun -n 1 numactl -i 0-3 -N 0-3 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span> : -n 1 numactl -i 4-7 -N 4-7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></tbody></table></figure>

<p>yhrun 提交作业 runpro.sh</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">duqi</span></span><br><span class="line"></span><br><span class="line">if [ $# -ne 5 ]</span><br><span class="line">then</span><br><span class="line">        echo Usage: ./runpro.sh nodes_list nodes_num proc_per_node mem_per_proc logdir</span><br><span class="line">        exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">export HPL_CMDLINE=1</span><br><span class="line"></span><br><span class="line">export LD_LIBRARY_PATH=/usr/local/mpi3/lib:$LD_LIBRARY_PATH</span><br><span class="line"></span><br><span class="line">nodes=${1}</span><br><span class="line">nnodes=${2}</span><br><span class="line">nprocs=${3}</span><br><span class="line">nmem=${4}</span><br><span class="line">logdir=${5}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir -p ${logdir}</span><br><span class="line"></span><br><span class="line">tnprocs=$((${nnodes}*${nprocs}))</span><br><span class="line">P=1</span><br><span class="line">Q=1</span><br><span class="line">for i in `seq 1 ${tnprocs}`</span><br><span class="line">do</span><br><span class="line">        for j in `seq 1 ${tnprocs}`</span><br><span class="line">        do</span><br><span class="line">                PQ=$((${i}*${j}))</span><br><span class="line">                if [ ${PQ} -eq ${tnprocs} ] &amp;&amp; [ ${i} -le ${j} ]</span><br><span class="line">                then</span><br><span class="line">                        P=${i}</span><br><span class="line">                        Q=${j}</span><br><span class="line">                fi</span><br><span class="line">        done</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">for i in `yhcontrol show hostname ${nodes}`</span><br><span class="line">do</span><br><span class="line">        scp HPL.dat $i:/root/linpack &amp;</span><br><span class="line">done</span><br><span class="line">wait</span><br><span class="line">sleep 1</span><br><span class="line"></span><br><span class="line">j=0</span><br><span class="line">runnodes=''</span><br><span class="line"></span><br><span class="line">for i in `yhcontrol show hostname ${nodes}`</span><br><span class="line">do</span><br><span class="line">        runnodes+=${i},</span><br><span class="line">        let j++</span><br><span class="line">        if [ ${j} -eq ${nnodes} ]</span><br><span class="line">        then</span><br><span class="line">                echo "yhrun -p all -N ${nnodes} -n ${tnprocs} -w ${runnodes} -D /root/linpack /root/linpack/xhplrun.sh ${P} ${Q} ${nmem} &amp;&gt;&gt; ${logdir}/${i}.log &amp;"</span><br><span class="line">                echo ${runnodes} &amp;&gt;&gt; ${logdir}/${i}.log</span><br><span class="line">                yhrun -p all -N ${nnodes} -n ${tnprocs} -w ${runnodes} -D /root/linpack /root/linpack/xhplrun.sh ${P} ${Q} ${nmem} &amp;&gt;&gt; ${logdir}/${i}.log &amp;</span><br><span class="line">                j=0</span><br><span class="line">                runnodes=''</span><br><span class="line">        fi</span><br><span class="line">done</span><br></pre></td></tr></tbody></table></figure>

<p>bios设置</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">琦哥的：</span><br><span class="line">    UPI Configuration</span><br><span class="line">        Link Lop -&gt; disable</span><br><span class="line">        Link L1  -&gt; disable </span><br><span class="line">        IO Directory Cache -&gt; enable</span><br><span class="line">        Isoc Mode -&gt; enable</span><br><span class="line"></span><br><span class="line">    Memory Configuration</span><br><span class="line">        Eufsrce POR -&gt; enable</span><br><span class="line">        PPR Type -&gt; Soft PPR</span><br><span class="line">        Memory Frequency -&gt; 2666</span><br><span class="line">        Data Scrambling for NVMDIMM -&gt; enable</span><br><span class="line">        Data Scrambling for DDR4 -&gt; enable</span><br><span class="line">        Enable AOR -&gt; enable</span><br><span class="line">        Refresh Option -&gt; enable</span><br><span class="line">        Memory RAS</span><br><span class="line">            Memory Rank Sparing -&gt; enable</span><br><span class="line"></span><br><span class="line">    IIO Configuration</span><br><span class="line">        PCI-E Port Max Payload Size -&gt; 256B</span><br><span class="line"></span><br><span class="line">    CPU P-State</span><br><span class="line">        SpeedStep -&gt; disable/enable?</span><br><span class="line">        PBF </span><br><span class="line">        Hardware P-State -&gt; enable</span><br><span class="line">        Package c state -&gt; No limit </span><br><span class="line">	</span><br><span class="line">网上找的系统Bios设置优化</span><br><span class="line">    关闭超线程</span><br><span class="line">    打开EIST</span><br><span class="line">    打开Turbo Mode</span><br><span class="line">    Boot Performance mode设置为max performance</span><br><span class="line">    Energy Performance BIAS设置为Performance</span><br><span class="line">    打开Monitor/Mwait</span><br><span class="line">    Package C stat limit设置为C0/C1 state</span><br><span class="line">    关闭CPU C3 report</span><br><span class="line">    关闭CPU C6 report</span><br><span class="line">    关闭Enhanced Halt State</span><br><span class="line">    关闭Intel VT for Directed I/O</span><br><span class="line">    Linux OS下CPU Power Management设置为max performance</span><br><span class="line">    QPI及Memory Frequency保持为Max Frequency</span><br><span class="line">    关闭NUMA功能 </span><br></pre></td></tr></tbody></table></figure>

<p>7、结果反馈</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1、grep FAILED 关键字,查看是否有节点计算错误</span><br><span class="line">2、grep WR 查看节点性能是否正常</span><br><span class="line">3、统计跑死的点</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如何反馈？</span></span><br><span class="line">一轮Linpack40分钟测试完成</span><br><span class="line">	一、6个点本是drain*状态</span><br><span class="line">	二、3个点跑死，cn[1,2,3]</span><br><span class="line">	三、5个点Linpack计算FAILED</span><br><span class="line">	四、其他点linpakc性能正常</span><br><span class="line">可以考虑更换下一批</span><br></pre></td></tr></tbody></table></figure>

<h2 id="20-风冷系统linpack测试全过程记录"><a href="#20-风冷系统linpack测试全过程记录" class="headerlink" title="20 风冷系统linpack测试全过程记录"></a>20 风冷系统linpack测试全过程记录</h2><blockquote>
<h5 id="1、了解风冷系统的架构"><a href="#1、了解风冷系统的架构" class="headerlink" title="1、了解风冷系统的架构"></a>1、了解风冷系统的架构</h5><p>按批次测试，测完一批换下一批</p>
<p>一批为192个节点，每个框32个节点，共6个框</p>
<p>每个节点128G内存，芯片为FT2000+, 通过mhz获取频率为2000（降频），64物理核</p>
<p>系统版本： 4.19.46-cn+</p>
<h5 id="2、计算每个节点的理论峰值"><a href="#2、计算每个节点的理论峰值" class="headerlink" title="2、计算每个节点的理论峰值"></a>2、计算每个节点的理论峰值</h5><p>2000 * 128 / 64 * 2 * 64= 512000</p>
<h5 id="3、开始测试"><a href="#3、开始测试" class="headerlink" title="3、开始测试"></a>3、开始测试</h5><p>runpro.sh脚本参数说明:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">./runpro.sh NodeList NodeBind ProcessesPerNode MemSize</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">NodeList 节点列表,例如cn[0-8]</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">NodeBind 几个节点绑定运行，例如2，则计算效率时，需要将结果得到的效率/2/512</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">ProcessesPerNode 每给节点运行几个xhpl进程，根据numa node来，FT一般是8</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">MemSize 每个节点中，每个进程分配的内存，一般使用到约总内存的80%，例如单节点128G，填写12000（单位为Mb），则总使用96G内存</span></span><br></pre></td></tr></tbody></table></figure>

<p>单节点测试：</p>
<p>​	不需要互联测试网络联通性，仅对单节点进行压力测试</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">./runpro.sh cn0 1 8 12000 logdir</span></span><br></pre></td></tr></tbody></table></figure>

<p>多节点测试：</p>
<p>​	需要互联测试网络联通性， 2，4， 8， 16， 32， 64， 128，如果要求测多节点稳定性，测试的8点8进8线，结果按<a href="#jump">章节6.8</a>反馈</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">./runpro.sh cn0 1 8 12000 logdir</span></span><br></pre></td></tr></tbody></table></figure>

<p>问题解决一：</p>
<p>​	测试到128节点，性能异常，效率仅有43%</p>
<p>互联那边回应：</p>
<p>​	节点数超过64，通信就跨框</p>
<p>琦哥建议的做法：</p>
<p>​	把128个节点分到4个框，测试一下，看是不是带宽的原因</p>
<p>最后的解决方法：</p>
<p>​	网络拓扑更换，矩阵值不能相等，使用原本32 x 32，改为16 x 64，但是换成160节点后还是有问题</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">./runpro.sh cn[xx-xx] 128 8 12000 <span class="built_in">dir</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">其中执行的xhplrun.sh的参数为</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">xhplrun.sh 32 32 12000</span></span><br></pre></td></tr></tbody></table></figure>

</blockquote>
<h2 id="21-附录"><a href="#21-附录" class="headerlink" title="21 附录"></a>21 附录</h2><h3 id="19-1-Linpack脚本"><a href="#19-1-Linpack脚本" class="headerlink" title="19.1 Linpack脚本"></a>19.1 Linpack脚本</h3><blockquote>
<p>runpro.sh</p>
<p>./runpro.sh nodes_list nodes_num proc_per_node mem_per_proc logdir</p>
<p>node_list 节点列表</p>
<p>nodes_num 几个点连在一起跑，单点 双点 多点</p>
<p>proc_per_node 每个节点跑几个进程，看node分为几个，FT一般是8</p>
<p>mem 12000 每个进程分配的内存，*8 大概= 总内存的80%</p>
<p>logdir 日志文件</p>
<p>单点8进程，一轮≈35分钟</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">duqi</span></span><br><span class="line"></span><br><span class="line">if [ $# -ne 5 ]</span><br><span class="line">then</span><br><span class="line">        echo Usage: ./runpro.sh nodes_list nodes_num proc_per_node mem_per_proc logdir</span><br><span class="line">        exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">export HPL_CMDLINE=1</span><br><span class="line">export LD_LIBRARY_PATH=/usr/local/mpi3/lib:LD_LIBRARY_PATH</span><br><span class="line"></span><br><span class="line">nodes=${1}</span><br><span class="line">nnodes=${2}</span><br><span class="line">nprocs=${3}</span><br><span class="line">nmem=${4}</span><br><span class="line">logdir=${5}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir -p ${logdir}</span><br><span class="line"></span><br><span class="line">tnprocs=$((${nnodes}*${nprocs}))</span><br><span class="line">P=1</span><br><span class="line">Q=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">num_max=1</span><br><span class="line">for i in `seq 1 ${tnprocs}`</span><br><span class="line">do</span><br><span class="line">        j=$((${i}*${i}))</span><br><span class="line">        if [ ${tnprocs} -le ${j} ]; then</span><br><span class="line">                num_max=${i}</span><br><span class="line">                break</span><br><span class="line">        fi</span><br><span class="line">done</span><br><span class="line">for i in `seq 1 ${num_max}`</span><br><span class="line">do</span><br><span class="line">        for j in `seq ${num_max} ${tnprocs}`</span><br><span class="line">        do</span><br><span class="line">                PQ=$((${i}*${j}))</span><br><span class="line">                if [ ${PQ} -eq ${tnprocs} ]</span><br><span class="line">                then</span><br><span class="line">                        P=${i}</span><br><span class="line">                        Q=${j}</span><br><span class="line">                fi</span><br><span class="line">        done</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in `yhcontrol show hostname ${nodes}`</span><br><span class="line">do</span><br><span class="line">        scp HPL.dat $i:/root/linpack &amp;</span><br><span class="line">done</span><br><span class="line">sleep 1</span><br><span class="line"></span><br><span class="line">j=0</span><br><span class="line">runnodes=''</span><br><span class="line"></span><br><span class="line">for i in `yhcontrol show hostname ${nodes}`</span><br><span class="line">do</span><br><span class="line">        runnodes+=${i},</span><br><span class="line">        let j++</span><br><span class="line">        if [ ${j} -eq ${nnodes} ]</span><br><span class="line">        then</span><br><span class="line">                echo "yhrun -p All -N ${nnodes} -n ${tnprocs} -w ${runnodes} -D /root/linpack /root/linpack/xhplrun.sh ${P} ${Q} ${nmem} &amp;&gt;&gt; ${logdir}/${i}.log &amp;"</span><br><span class="line">                echo ${runnodes} &amp;&gt;&gt; ${logdir}/${i}.log &amp;</span><br><span class="line">                echo "yhrun -p All -N ${nnodes} -n ${tnprocs} -w ${runnodes} -D /root/linpack /root/linpack/xhplrun.sh ${P} ${Q} ${nmem}" &amp;&gt;&gt; ${logdir}/list.log</span><br><span class="line">                yhrun -p All -N ${nnodes} -n ${tnprocs} -w ${runnodes} -D /root/linpack /root/linpack/xhplrun.sh ${P} ${Q} ${nmem} &amp;&gt;&gt; ${logdir}/${i}.log &amp;</span><br><span class="line">                j=0</span><br><span class="line">                runnodes=''</span><br><span class="line">        fi</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>xhplrun.sh</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">duqi</span></span><br><span class="line"></span><br><span class="line">ulimit -s unlimited</span><br><span class="line"></span><br><span class="line">Cores=64</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">==========================================================</span></span><br><span class="line">PMI_SIZE=$SLURM_NPROCS</span><br><span class="line"></span><br><span class="line">PMI_RANK=$SLURM_PROCID</span><br><span class="line"></span><br><span class="line">MPI_NUM_NODES=$SLURM_NNODES</span><br><span class="line"></span><br><span class="line">MPI_PER_NODE=$((PMI_SIZE / MPI_NUM_NODES))</span><br><span class="line"></span><br><span class="line">MPI_RANK_FOR_NODE=$((PMI_RANK % MPI_PER_NODE))</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">==========================================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">threads=`echo ${Cores}*${SLURM_NNODES}/${PMI_SIZE} | bc`</span><br><span class="line"></span><br><span class="line">PRO_SIZE=${MPI_PER_NODE}</span><br><span class="line">PMI_RANK_my=${MPI_RANK_FOR_NODE}</span><br><span class="line"></span><br><span class="line">echo ${PRO_SIZE} ${PMI_RANK_my} ${threads} ${PMI_SIZE} ${PMI_RANK} ${MPI_NUM_NODES} ${MPI_PER_NODE} ${MPI_RANK_FOR_NODE}</span><br><span class="line"></span><br><span class="line">export HPL_CMDLINE=1</span><br><span class="line">case ${PRO_SIZE} in</span><br><span class="line">1)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 0-1 -N 0-1 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 0,4 -N 0-7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 0-7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='0-63'</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">case ${PMI_RANK_my} in</span><br><span class="line">0)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 0-3 -N 0-3 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -m 3 -N 0-3 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='0-31'</span><br><span class="line">numactl -i 4-7 -N 0-3 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 4-7 -N 4-7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -m 7 -N 4-7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='32-63'</span><br><span class="line">numactl -i 0-3 -N 4-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mpirun -n 1 numactl -i 0-3 -N 0-3 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span> : -n 1 numactl -i 4-7 -N 4-7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">4)</span><br><span class="line">case ${PMI_RANK_my} in</span><br><span class="line">0)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='0-15'</span><br><span class="line">numactl -i 0-7 -N 0-1 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 2-3 -N 0-1 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='16-31'</span><br><span class="line">numactl -i 0-7 -N 2-3 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 4-5 -N 2-3 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='32-47'</span><br><span class="line">numactl -i 0-7 -N 4-5 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 6-7 -N 4-5 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='48-63'</span><br><span class="line">numactl -i 0-7 -N 6-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 0-1 -N 6-7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line">;;</span><br><span class="line">8)</span><br><span class="line">case ${PMI_RANK_my} in</span><br><span class="line">0)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='0-7'</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 4 -N 0 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='8-15'</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 2 -N 1 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='16-23'</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 6 -N 2 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='24-31'</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 1 -N 3 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">4)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='32-39'</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 0 -N 4 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">5)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='40-47'</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 7 -N 5 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">6)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='48-55'</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 5 -N 6 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">7)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='56-63'</span><br><span class="line">numactl -i 0-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 3 -N 7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line">;;</span><br><span class="line">16)</span><br><span class="line">case ${PMI_RANK_my} in</span><br><span class="line">0)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='0-3'</span><br><span class="line">numactl -i 0-7 -C 0-3 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='4-7'</span><br><span class="line">numactl -i 0-7 -C 4-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='8-11'</span><br><span class="line">numactl -i 0-7 -C 8-11 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='12-15'</span><br><span class="line">numactl -i 0-7 -C 12-15 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">4)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='16-19'</span><br><span class="line">numactl -i 0-7 -C 16-19 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">5)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='20-23'</span><br><span class="line">numactl -i 0-7 -C 20-23 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">6)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='24-27'</span><br><span class="line">numactl -i 0-7 -C 24-27 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">7)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='28-31'</span><br><span class="line">numactl -i 0-7 -C 28-31 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">8)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='32-35'</span><br><span class="line">numactl -i 0-7 -C 32-35 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">9)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='36-39'</span><br><span class="line">numactl -i 0-7 -C 36-39 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">10)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='40-43'</span><br><span class="line">numactl -i 0-7 -C 40-43 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">11)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='44-47'</span><br><span class="line">numactl -i 0-7 -C 44-47 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">12)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='48-51'</span><br><span class="line">numactl -i 0-7 -C 48-51 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">13)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='52-55'</span><br><span class="line">numactl -i 0-7 -C 52-55 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">14)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='56-59'</span><br><span class="line">numactl -i 0-7 -C 56-59 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">15)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='60-63'</span><br><span class="line">numactl -i 0-7 -C 60-63 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line">;;</span><br><span class="line">32)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">export</span> OMP_NUM_THREADS=<span class="variable">${threads}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 0-7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">;;</span></span><br><span class="line">case ${PMI_RANK_my} in</span><br><span class="line">0)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='0-1'</span><br><span class="line">numactl -i 0-7 -C 0-1 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='2-3'</span><br><span class="line">numactl -i 0-7 -C 2-3 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='4-5'</span><br><span class="line">numactl -i 0-7 -C 4-5 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='6-7'</span><br><span class="line">numactl -i 0-7 -C 6-7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">4)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='8-9'</span><br><span class="line">numactl -i 0-7 -C 8-9 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">5)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='10-11'</span><br><span class="line">numactl -i 0-7 -C 10-11 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">6)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='12-13'</span><br><span class="line">numactl -i 0-7 -C 12-13 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">7)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='14-15'</span><br><span class="line">numactl -i 0-7 -C 14-15 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">8)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='16-17'</span><br><span class="line">numactl -i 0-7 -C 16-17 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">9)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='18-19'</span><br><span class="line">numactl -i 0-7 -C 18-19 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">10)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='20-21'</span><br><span class="line">numactl -i 0-7 -C 20-21 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">11)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='22-23'</span><br><span class="line">numactl -i 0-7 -C 22-23 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">12)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='24-25'</span><br><span class="line">numactl -i 0-7 -C 24-25 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">13)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='26-27'</span><br><span class="line">numactl -i 0-7 -C 26-27 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">14)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='28-29'</span><br><span class="line">numactl -i 0-7 -C 28-29 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">15)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='30-31'</span><br><span class="line">numactl -i 0-7 -C 30-31 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">16)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='32-33'</span><br><span class="line">numactl -i 0-7 -C 32-33 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">17)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='34-35'</span><br><span class="line">numactl -i 0-7 -C 34-35 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">18)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='36-37'</span><br><span class="line">numactl -i 0-7 -C 36-37 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">19)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='38-39'</span><br><span class="line">numactl -i 0-7 -C 38-39 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">20)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='40-41'</span><br><span class="line">numactl -i 0-7 -C 40-41 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">21)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='42-43'</span><br><span class="line">numactl -i 0-7 -C 42-43 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">22)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='44-45'</span><br><span class="line">numactl -i 0-7 -C 44-45 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">23)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='46-47'</span><br><span class="line">numactl -i 0-7 -C 46-47 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">24)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='48-49'</span><br><span class="line">numactl -i 0-7 -C 48-49 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">25)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='50-51'</span><br><span class="line">numactl -i 0-7 -C 50-51 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">26)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='52-53'</span><br><span class="line">numactl -i 0-7 -C 52-53 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">27)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='54-55'</span><br><span class="line">numactl -i 0-7 -C 54-55 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">28)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='56-57'</span><br><span class="line">numactl -i 0-7 -C 56-57 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">29)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='58-59'</span><br><span class="line">numactl -i 0-7 -C 58-59 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">30)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='60-61'</span><br><span class="line">numactl -i 0-7 -C 60-61 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">31)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='62-63'</span><br><span class="line">numactl -i 0-7 -C 62-63 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line">;;</span><br><span class="line">64)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">export</span> GOMP_CPU_AFFINITY=<span class="string">'0-63'</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">numactl -i 0-7 ./xhpl -n 1 -b 192 -p <span class="variable">${1}</span> -q <span class="variable">${2}</span> -m <span class="variable">${3}</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">;;</span></span><br><span class="line">case ${PMI_RANK_my} in</span><br><span class="line">0)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='0'</span><br><span class="line">numactl -i 0-7 -C 0 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">1)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='1'</span><br><span class="line">numactl -i 0-7 -C 1 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='2'</span><br><span class="line">numactl -i 0-7 -C 2 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='3'</span><br><span class="line">numactl -i 0-7 -C 3 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">4)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='4'</span><br><span class="line">numactl -i 0-7 -C 4 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">5)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='5'</span><br><span class="line">numactl -i 0-7 -C 5 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">6)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='6'</span><br><span class="line">numactl -i 0-7 -C 6 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">7)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='7'</span><br><span class="line">numactl -i 0-7 -C 7 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">8)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='8'</span><br><span class="line">numactl -i 0-7 -C 8 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">9)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='9'</span><br><span class="line">numactl -i 0-7 -C 9 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">10)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='10'</span><br><span class="line">numactl -i 0-7 -C 10 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">11)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='11'</span><br><span class="line">numactl -i 0-7 -C 11 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">12)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='12'</span><br><span class="line">numactl -i 0-7 -C 12 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">13)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='13'</span><br><span class="line">numactl -i 0-7 -C 13 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">14)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='14'</span><br><span class="line">numactl -i 0-7 -C 14 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">15)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='15'</span><br><span class="line">numactl -i 0-7 -C 15 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">16)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='16'</span><br><span class="line">numactl -i 0-7 -C 16 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">17)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='17'</span><br><span class="line">numactl -i 0-7 -C 17 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">18)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='18'</span><br><span class="line">numactl -i 0-7 -C 18 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">19)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='19'</span><br><span class="line">numactl -i 0-7 -C 19 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">20)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='20'</span><br><span class="line">numactl -i 0-7 -C 20 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">21)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='21'</span><br><span class="line">numactl -i 0-7 -C 21 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">22)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='22'</span><br><span class="line">numactl -i 0-7 -C 22 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">23)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='23'</span><br><span class="line">numactl -i 0-7 -C 23 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">24)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='24'</span><br><span class="line">numactl -i 0-7 -C 24 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">25)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='25'</span><br><span class="line">numactl -i 0-7 -C 25 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">26)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='26'</span><br><span class="line">numactl -i 0-7 -C 26 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">27)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='27'</span><br><span class="line">numactl -i 0-7 -C 27 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">28)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='28'</span><br><span class="line">numactl -i 0-7 -C 28 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">29)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='29'</span><br><span class="line">numactl -i 0-7 -C 29 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">30)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='30'</span><br><span class="line">numactl -i 0-7 -C 30 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">31)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='31'</span><br><span class="line">numactl -i 0-7 -C 31 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">32)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='32'</span><br><span class="line">numactl -i 0-7 -C 32 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">33)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='33'</span><br><span class="line">numactl -i 0-7 -C 33 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">34)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='34'</span><br><span class="line">numactl -i 0-7 -C 34 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">35)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='35'</span><br><span class="line">numactl -i 0-7 -C 35 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">36)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='36'</span><br><span class="line">numactl -i 0-7 -C 36 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">37)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='37'</span><br><span class="line">numactl -i 0-7 -C 37 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">38)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='38'</span><br><span class="line">numactl -i 0-7 -C 38 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">39)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='39'</span><br><span class="line">numactl -i 0-7 -C 39 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">40)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='40'</span><br><span class="line">numactl -i 0-7 -C 40 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">41)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='41'</span><br><span class="line">numactl -i 0-7 -C 41 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">42)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='42'</span><br><span class="line">numactl -i 0-7 -C 42 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">43)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='43'</span><br><span class="line">numactl -i 0-7 -C 43 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">44)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='44'</span><br><span class="line">numactl -i 0-7 -C 44 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">45)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='45'</span><br><span class="line">numactl -i 0-7 -C 45 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">46)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='46'</span><br><span class="line">numactl -i 0-7 -C 46 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">47)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='47'</span><br><span class="line">numactl -i 0-7 -C 47 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">48)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='48'</span><br><span class="line">numactl -i 0-7 -C 48 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">49)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='49'</span><br><span class="line">numactl -i 0-7 -C 49 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">50)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='50'</span><br><span class="line">numactl -i 0-7 -C 50 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">51)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='51'</span><br><span class="line">numactl -i 0-7 -C 51 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">52)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='52'</span><br><span class="line">numactl -i 0-7 -C 52 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">53)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='53'</span><br><span class="line">numactl -i 0-7 -C 53 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">54)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='54'</span><br><span class="line">numactl -i 0-7 -C 54 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">55)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='55'</span><br><span class="line">numactl -i 0-7 -C 55 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">56)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='56'</span><br><span class="line">numactl -i 0-7 -C 56 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">57)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='57'</span><br><span class="line">numactl -i 0-7 -C 57 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">58)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='58'</span><br><span class="line">numactl -i 0-7 -C 58 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">59)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='59'</span><br><span class="line">numactl -i 0-7 -C 59 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">60)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='60'</span><br><span class="line">numactl -i 0-7 -C 60 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">61)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='61'</span><br><span class="line">numactl -i 0-7 -C 61 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">62)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='62'</span><br><span class="line">numactl -i 0-7 -C 62 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">63)</span><br><span class="line">export OMP_NUM_THREADS=${threads}</span><br><span class="line">export GOMP_CPU_AFFINITY='63'</span><br><span class="line">numactl -i 0-7 -C 63 ./xhpl -n 1 -b 192 -p ${1} -q ${2} -m ${3}</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></tbody></table></figure>

<h3 id="19-2-编译问题"><a href="#19-2-编译问题" class="headerlink" title="19.2 编译问题"></a>19.2 编译问题</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-lc </span><br><span class="line">	解决找不到memcpy问题 </span><br><span class="line">-lstdc++</span><br><span class="line">	解决vtable for xxxx 问题</span><br><span class="line">-lgcc_s</span><br><span class="line">	undefined reference to `_Unwind_Resume'</span><br><span class="line">	undefined reference to `__popcountdi2'</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;sys/types.h&gt;</span></span><br><span class="line">	 implicit declaration of function ‘fstat’</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;sys/sysmacros.h&gt;</span></span><br><span class="line">	implicit declaration of function ‘major’</span><br></pre></td></tr></tbody></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://gsproj.github.io">Haris</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://gsproj.github.io/2022/07/06/02_%E6%B5%8B%E8%AF%95/01_POC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">http://gsproj.github.io/2022/07/06/02_%E6%B5%8B%E8%AF%95/01_POC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://gsproj.github.io" target="_blank">Haris的小站</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%B7%A5%E4%BD%9C/">工作</a></div><div class="post-share"><div class="social-share" data-image="/img/%E5%A4%B4%E5%83%8F.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2022/07/06/02_%E6%B5%8B%E8%AF%95/04_%E9%95%BF%E5%9F%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E6%96%B9%E6%B3%95/" title="服务器日志收集与分析"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">服务器日志收集与分析</div></div><div class="info-2"><div class="info-item-1">23952000000040761600 服务器日志收集与分析一、日志收集1.1 基本信息收集1.1.1 服务器状态确认服务器故障的6个状态，根据不同的状态来收集日志    序 机器状态 收集信息 主要部件    1 无供电输入 机器外观检查（开关面板、主板灯、PSU灯、供电线、PDU） PSU、主板、PDU   2 有供电输入，无法启动 BMC日志 主板、CPU、DIMM000内存、BMC   3 可以启动但无法完成POST自检 BMC日志、串口输出 主板、内存、CPU、BIOS   4 POST自检完成，但没有开始加载操作系统 BMC日志、串口输出、RAID卡日志 PCIE设备、硬盘、操作系统、主板   5 操作系统开始加载，但加载失败 BMC日志、串口输出 操作系统、主板、CPU、BIOS、CPLD   6 操作系统加载完成，但运行中意外中断 BMC日志、串口输出、操作系统日志 内存、CPU、主板、操作系统、软件   1.1.2...</div></div></div></a><a class="pagination-related" href="/2022/07/06/06_%E6%9D%82%E8%AE%B0/MI%E5%8D%8F%E8%AE%AE/" title="MI协议"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">MI协议</div></div><div class="info-2"><div class="info-item-1">Mi协议使用1 使用mi启动调试12345678910111213141516gs@ft-svr:~/matrix$ gdb --interpreter mi test=thread-group-added,id="i1"~"GNU gdb (Ubuntu 8.2.91.20190405-0ubuntu3) 8.2.91.20190405-git\n"~"Copyright (C) 2019 Free Software Foundation, Inc.\n"~"License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law."~"\nType...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info-name">Haris</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">211</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#POC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97"><span class="toc-text">POC测试工具使用指南</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-SPEC-OMP-2012%E6%B5%8B%E8%AF%95"><span class="toc-text">1 SPEC OMP 2012测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-CPU%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%EF%BC%88%E6%95%B4%E5%9E%8B-%E6%B5%AE%E7%82%B9%E5%9E%8B%EF%BC%89"><span class="toc-text">2 CPU性能测试（整型/浮点型）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E4%BD%BF%E7%94%A8CPU2006"><span class="toc-text">2.1 使用CPU2006</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E4%BD%BF%E7%94%A8CPU2017"><span class="toc-text">2.2 使用CPU2017</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-SPEC-JVM-2008"><span class="toc-text">3 SPEC JVM 2008</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-LTP%E6%B5%8B%E8%AF%95"><span class="toc-text">4 LTP测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-lmbench%E6%B5%8B%E8%AF%95%EF%BC%88%E7%94%A8%E6%97%B63%E5%B0%8F%E6%97%B6%EF%BC%89"><span class="toc-text">5 lmbench测试（用时3小时）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E6%B5%8B%E8%AF%95"><span class="toc-text">6 文件读写测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-USB%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87%E8%AF%BB%E5%86%99%E6%80%A7%E8%83%BD"><span class="toc-text">7 USB存储设备读写性能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E7%A1%AC%E7%9B%98%E8%AF%BB%E5%86%99%E6%B5%8B%E8%AF%95-IOZONE"><span class="toc-text">8 硬盘读写测试-IOZONE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E7%A1%AC%E7%9B%98%E6%B5%8B%E8%AF%95-FIO"><span class="toc-text">9 硬盘测试-FIO</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E5%86%85%E5%AD%98%E8%AF%BB%E5%86%99%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95-Stream"><span class="toc-text">10 内存读写性能测试-Stream</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BB%BC%E5%90%88%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95-unixbench%EF%BC%88%E7%94%A8%E6%97%B61%E5%B0%8F%E6%97%B6%EF%BC%89"><span class="toc-text">11 操作系统综合性能测试-unixbench（用时1小时）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E6%98%BE%E5%8D%A1%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95-unixbench%EF%BC%88%E7%94%A8%E6%97%B6%E7%BA%A6%E5%8D%8A%E5%B0%8F%E6%97%B6%EF%BC%89"><span class="toc-text">12 显卡性能测试-unixbench（用时约半小时）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E6%98%BE%E5%8D%A1%E6%B5%8B%E8%AF%95-Glmark2"><span class="toc-text">13 显卡测试-Glmark2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E6%98%BE%E5%8D%A1%E6%B5%8B%E8%AF%95-Glxgears"><span class="toc-text">14 显卡测试-Glxgears</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E7%BD%91%E7%BB%9C%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95-iperf3"><span class="toc-text">15 网络性能测试-iperf3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E7%BD%91%E7%BB%9C%E6%80%A7%E8%83%BD-Netperf"><span class="toc-text">16 网络性能-Netperf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-CPU%E3%80%81%E5%86%85%E5%AD%98%E5%8E%8B%E6%B5%8B-stress"><span class="toc-text">17 CPU、内存压测-stress</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-NPB%E6%B5%8B%E8%AF%95"><span class="toc-text">18 NPB测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-Linpack%E6%B5%8B%E8%AF%95"><span class="toc-text">19 Linpack测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-%E9%A3%8E%E5%86%B7%E7%B3%BB%E7%BB%9Flinpack%E6%B5%8B%E8%AF%95%E5%85%A8%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95"><span class="toc-text">20 风冷系统linpack测试全过程记录</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E4%BA%86%E8%A7%A3%E9%A3%8E%E5%86%B7%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%9E%B6%E6%9E%84"><span class="toc-text">1、了解风冷系统的架构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E8%AE%A1%E7%AE%97%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E7%90%86%E8%AE%BA%E5%B3%B0%E5%80%BC"><span class="toc-text">2、计算每个节点的理论峰值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81%E5%BC%80%E5%A7%8B%E6%B5%8B%E8%AF%95"><span class="toc-text">3、开始测试</span></a></li></ol></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E9%99%84%E5%BD%95"><span class="toc-text">21 附录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#19-1-Linpack%E8%84%9A%E6%9C%AC"><span class="toc-text">19.1 Linpack脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-2-%E7%BC%96%E8%AF%91%E9%97%AE%E9%A2%98"><span class="toc-text">19.2 编译问题</span></a></li></ol></li></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/21/06_%E6%9D%82%E8%AE%B0/ollama%E8%BF%90%E8%A1%8Cdeepseek%E5%A4%A7%E6%A8%A1%E5%9E%8B/" title="8卡A800运行DeepseekR1-671B大模型">8卡A800运行DeepseekR1-671B大模型</a><time datetime="2025-04-21T06:29:52.000Z" title="发表于 2025-04-21 14:29:52">2025-04-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/26/09_%E9%9F%A9%E5%85%88%E8%B6%85K8S/01-Docker%E5%9F%BA%E7%A1%80/06-Docker%E8%B5%84%E6%BA%90%E9%85%8D%E9%A2%9D/" title="06-Docker资源配额">06-Docker资源配额</a><time datetime="2025-03-26T07:12:52.000Z" title="发表于 2025-03-26 15:12:52">2025-03-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/20/09_%E9%9F%A9%E5%85%88%E8%B6%85K8S/01-Docker%E5%9F%BA%E7%A1%80/05-Docker%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/" title="05-Docker容器数据持久化">05-Docker容器数据持久化</a><time datetime="2025-03-20T07:12:52.000Z" title="发表于 2025-03-20 15:12:52">2025-03-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/12/09_%E9%9F%A9%E5%85%88%E8%B6%85K8S/01-Docker%E5%9F%BA%E7%A1%80/04-Dockerfile%E5%AE%9E%E6%88%98%E7%AF%87-%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F/" title="04-Dockerfile实战篇-构建镜像">04-Dockerfile实战篇-构建镜像</a><time datetime="2025-03-12T07:12:52.000Z" title="发表于 2025-03-12 15:12:52">2025-03-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/04/09_%E9%9F%A9%E5%85%88%E8%B6%85K8S/01-Docker%E5%9F%BA%E7%A1%80/03-Dockerfile%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/" title="03-Dockerfile基础篇-基本语法">03-Dockerfile基础篇-基本语法</a><time datetime="2025-03-04T07:12:52.000Z" title="发表于 2025-03-04 15:12:52">2025-03-04</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">©2019 - 2025 By Haris</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"></div><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>