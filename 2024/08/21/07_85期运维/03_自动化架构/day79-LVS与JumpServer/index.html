<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>day79-LVS与JumpServer | Haris的小站</title><meta name="author" content="Haris"><meta name="copyright" content="Haris"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="今日内容：  LVS负载均衡 OpenVPN加密通信隧道 JumpServer跳板机  一、负载均衡介绍1.1 常见负载均衡对比   常见负载均衡对比 优势 缺点    硬件：如F5负载均衡 性能好、购买有技术支持 价格昂贵，且一次需要购买2台凑成1对。   LVS 工作在4层，效率极其高 需要部署维护(运维成本较高)   Nginx/Tengine/Openresty(lua">
<meta property="og:type" content="article">
<meta property="og:title" content="day79-LVS与JumpServer">
<meta property="og:url" content="http://gsproj.github.io/2024/08/21/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day79-LVS%E4%B8%8EJumpServer/index.html">
<meta property="og:site_name" content="Haris的小站">
<meta property="og:description" content="今日内容：  LVS负载均衡 OpenVPN加密通信隧道 JumpServer跳板机  一、负载均衡介绍1.1 常见负载均衡对比   常见负载均衡对比 优势 缺点    硬件：如F5负载均衡 性能好、购买有技术支持 价格昂贵，且一次需要购买2台凑成1对。   LVS 工作在4层，效率极其高 需要部署维护(运维成本较高)   Nginx/Tengine/Openresty(lua">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://gsproj.github.io/img/%E5%A4%B4%E5%83%8F.png">
<meta property="article:published_time" content="2024-08-21T03:08:52.000Z">
<meta property="article:modified_time" content="2024-10-12T03:34:55.992Z">
<meta property="article:author" content="Haris">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://gsproj.github.io/img/%E5%A4%B4%E5%83%8F.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "day79-LVS与JumpServer",
  "url": "http://gsproj.github.io/2024/08/21/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day79-LVS%E4%B8%8EJumpServer/",
  "image": "http://gsproj.github.io/img/%E5%A4%B4%E5%83%8F.png",
  "datePublished": "2024-08-21T03:08:52.000Z",
  "dateModified": "2024-10-12T03:34:55.992Z",
  "author": [
    {
      "@type": "Person",
      "name": "Haris",
      "url": "http://gsproj.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://gsproj.github.io/2024/08/21/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day79-LVS%E4%B8%8EJumpServer/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'day79-LVS与JumpServer',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/modify.css"><style>#article-container.post-content h1:before, h2:before, h3:before, h4:before, h5:before, h6:before { -webkit-animation: avatar_turn_around 1s linear infinite; -moz-animation: avatar_turn_around 1s linear infinite; -o-animation: avatar_turn_around 1s linear infinite; -ms-animation: avatar_turn_around 1s linear infinite; animation: avatar_turn_around 1s linear infinite; }</style><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/css/loading-bar.css"><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/img/猫.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">215</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">32</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/car2.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Haris的小站</span></a><a class="nav-page-title" href="/"><span class="site-name">day79-LVS与JumpServer</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">day79-LVS与JumpServer</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-21T03:08:52.000Z" title="发表于 2024-08-21 11:08:52">2024-08-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-12T03:34:55.992Z" title="更新于 2024-10-12 11:34:55">2024-10-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%BA%8C%EF%BC%89%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/">（二）综合架构</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="top-img" style="background-image: url(/img/car2.png);"></div><article class="container post-content" id="article-container"><p>今日内容：</p>
<ul>
<li>LVS负载均衡</li>
<li>OpenVPN加密通信隧道</li>
<li>JumpServer跳板机</li>
</ul>
<h1 id="一、负载均衡介绍"><a href="#一、负载均衡介绍" class="headerlink" title="一、负载均衡介绍"></a>一、负载均衡介绍</h1><h2 id="1-1-常见负载均衡对比"><a href="#1-1-常见负载均衡对比" class="headerlink" title="1.1 常见负载均衡对比"></a>1.1 常见负载均衡对比</h2><table>
<thead>
<tr>
<th>常见负载均衡对比</th>
<th>优势</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>硬件：如F5负载均衡</td>
<td>性能好、购买有技术支持</td>
<td>价格昂贵，且一次需要购买2台凑成1对。</td>
</tr>
<tr>
<td>LVS</td>
<td>工作在4层，效率极其高</td>
<td>需要部署维护(运维成本较高)</td>
</tr>
<tr>
<td>Nginx/Tengine/Openresty(lua)</td>
<td>使用简单，支持4层(1.9版本后支持)和7层负载均衡、反向代理、缓存、流量镜像(mirror)</td>
<td>处理数据为 “代理模式”，即替用户去查找，找到后发送给用户。在并发较大(1w以 上)时会卡</td>
</tr>
<tr>
<td>Haproxy</td>
<td>相对复杂 支持4层和7层 反向代理 动态加载配置文件.</td>
<td>处理数据为“代理模式”，并发较大(1w以上，但比nginx多) 时会卡</td>
</tr>
<tr>
<td>云服务：如clb(slb)</td>
<td>支持4层和7层</td>
<td>只能支持url或者域名的转发</td>
</tr>
<tr>
<td>ALB</td>
<td>支持更多的7层的转发功能 ，如基于用户请求头 http_user_agent、用户语言、 镜像流量(申请,深圳)</td>
<td>只支持7层负载均衡</td>
</tr>
</tbody></table>
<p>四层负载均衡和七层负载均衡的对比：</p>
<ul>
<li>四层负载均衡：在传输层，负载均衡最多到端口级别</li>
<li>七层负载均衡，在应用层，URL、URI 转发、HTTP HTTPS</li>
</ul>
<h2 id="1-2-反向代理和负载均衡的区别"><a href="#1-2-反向代理和负载均衡的区别" class="headerlink" title="1.2 反向代理和负载均衡的区别"></a>1.2 反向代理和负载均衡的区别</h2><p>反向代理：Nginx / Haproxy做<strong>代理</strong>，代替用户找，找到后发给用户</p>
<p>负载均衡：VS对数据进行<strong>转发</strong></p>
<p><img src="/../../../img/image-20240816142138132.png" alt="image-20240816142138132"></p>
<h2 id="1-3-ARP地址解析"><a href="#1-3-ARP地址解析" class="headerlink" title="1.3 ARP地址解析"></a>1.3 ARP地址解析</h2><p>DNS域名解析：域名 解析成 IP</p>
<p>ARP地址解析：IP 解析成  Mac地址</p>
<p><img src="/../../../img/image-20240816144825521.png" alt="image-20240816144825521"></p>
<h3 id="1-3-1-ARP欺骗"><a href="#1-3-1-ARP欺骗" class="headerlink" title="1.3.1 ARP欺骗"></a>1.3.1 ARP欺骗</h3><p><img src="/../../../img/image-20240816145003736.png" alt="image-20240816145003736"></p>
<h1 id="二、LVS快速上手"><a href="#二、LVS快速上手" class="headerlink" title="二、LVS快速上手"></a>二、LVS快速上手</h1><h2 id="2-1-LVS概述"><a href="#2-1-LVS概述" class="headerlink" title="2.1 LVS概述"></a>2.1 LVS概述</h2><p>LVS的工作模式：</p>
<ul>
<li>DR 模式</li>
<li>NAT 模式</li>
<li>TUN隧道模式</li>
<li>FLL NAT 完全NAT模式</li>
</ul>
<p>关键词：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>单词</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>CIP</td>
<td>client ip</td>
<td>客户端ip地址</td>
</tr>
<tr>
<td>VIP</td>
<td>Virtual ip</td>
<td>虚拟ip</td>
</tr>
<tr>
<td>DIP</td>
<td>director ip</td>
<td>负载均衡本身的ip</td>
</tr>
<tr>
<td>RS服务器</td>
<td>real server</td>
<td>真实服务器 处理用户请求.</td>
</tr>
<tr>
<td>RIP</td>
<td>Real erver IP</td>
<td>real server ip 真实服务器的ip地址</td>
</tr>
</tbody></table>
<p><img src="/../../../img/image-20240816151056982.png" alt="image-20240816151056982"></p>
<h2 id="2-2-LVS-DR模式上手"><a href="#2-2-LVS-DR模式上手" class="headerlink" title="2.2 LVS-DR模式上手"></a>2.2 LVS-DR模式上手</h2><h3 id="2-2-1-环境准备"><a href="#2-2-1-环境准备" class="headerlink" title="2.2.1 环境准备"></a>2.2.1 环境准备</h3><table>
<thead>
<tr>
<th>主机</th>
<th>作用</th>
<th>真实ip</th>
<th>虚拟IP（vip）</th>
</tr>
</thead>
<tbody><tr>
<td>lb01</td>
<td>LVS主服务器</td>
<td>10.0.0.5</td>
<td>10.0.0.3</td>
</tr>
<tr>
<td>web01</td>
<td>nginx-01</td>
<td>10.0.0.7</td>
<td>数据转向10.0.0.3</td>
</tr>
<tr>
<td>web02</td>
<td>nginx-02</td>
<td>10.0.0.8</td>
<td>数据转向10.0.0.3</td>
</tr>
</tbody></table>
<h3 id="2-2-2-前提处理"><a href="#2-2-2-前提处理" class="headerlink" title="2.2.2 前提处理"></a>2.2.2 前提处理</h3><p>1、web01和web02准备站点</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">站点文件</span> </span><br><span class="line">[root@web01 /server/code/lvs]#cat index.html </span><br><span class="line">lvs web01</span><br><span class="line">[root@web02 ~]#cat /server/code/lvs/index.html </span><br><span class="line">lvs web02</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Nginx虚拟主机，web01/02相同</span></span><br><span class="line">[root@web02 ~]#cat /etc/nginx/conf.d/lvs.test.cn.conf </span><br><span class="line">server {</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name lvs.test.cn;</span><br><span class="line">  root /server/code/lvs;</span><br><span class="line">  location / {</span><br><span class="line">    index index.html;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启服务,设置HOSTS，并测试</span></span><br><span class="line">[root@web01 /etc/nginx/conf.d]#curl -H Host:lvs.test.cn 10.0.0.7</span><br><span class="line">lvs web01</span><br><span class="line">[root@web02 ~]#curl -H Host:lvs.test.cn 10.0.0.8</span><br><span class="line">lvs web02</span><br></pre></td></tr></tbody></table></figure>

<p>2、lb01和lb02关闭不需要的服务，安装LVS</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭keepalived和nginx，防止影响负载均衡</span></span><br><span class="line">[root@lb01 ~]#systemctl stop keepalived nginx</span><br><span class="line">[root@lb01 ~]#systemctl disable keepalived nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装LVS</span></span><br><span class="line">[root@lb01 ~]#yum install -y ipvsadm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查模块是否已加载</span></span><br><span class="line">[root@lb01 ~]#lsmod | grep ip_vs</span><br><span class="line">ip_vs                 145458  0 </span><br><span class="line">nf_conntrack          139264  1 ip_vs</span><br><span class="line">libcrc32c              12644  3 xfs,ip_vs,nf_conntrack</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-2-3-DR模式配置流程"><a href="#2-2-3-DR模式配置流程" class="headerlink" title="2.2.3 DR模式配置流程"></a>2.2.3 DR模式配置流程</h3><h4 id="2-2-3-1-LVS服务器配置"><a href="#2-2-3-1-LVS服务器配置" class="headerlink" title="2.2.3.1 LVS服务器配置"></a>2.2.3.1 LVS服务器配置</h4><p>1、手动添加VIP，后面是由Keepalived生成（需先把网卡名改成eth0）</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@lb01 ~]#ifconfig eth0:0 10.0.0.3 netmask 255.255.255.0</span><br></pre></td></tr></tbody></table></figure>

<p>永久保存</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@lb01 /etc/sysconfig/network-scripts]#cat ifcfg-eth0:0</span><br><span class="line">DEVICE=eth0:0</span><br><span class="line">IPADDR=10.0.0.3</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">ONBOOT=yes</span><br><span class="line">NAME=eth0:0</span><br></pre></td></tr></tbody></table></figure>

<p>2、添加规则 (类似于nginx的upstream)</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -A -t 10.0.0.3:80 -s wrr</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-A --add-service 创建池塘</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-t --tcp-service tcp协议</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">10.0.0.3:80 组名称</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-s scheduler 轮询算法 wrr weight 加权轮询 rrlc wlc</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p persistent 会话保持时间（时间别设置太长，不然测试xiao<span class="string">'guo）</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>3、添加规则（类似于向upstream中添加server）</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -a -t 10.0.0.3:80 -r 10.0.0.7:80 -g -w 1</span><br><span class="line">ipvsadm -a -t 10.0.0.3:80 -r 10.0.0.8:80 -g -w 2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-a 添加 rs服务器</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-t tcp协议</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-r 指定rs服务器ip</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-g --gatewaying dr模式 默认的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-w 权重</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>类似于使用Nginx配置负载均衡</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">upstream web_pools {</span></span><br><span class="line">server 10.0.0.7:80;</span><br><span class="line">server 10.0.0.8:80;</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">}</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">server {</span></span><br><span class="line">location / {</span><br><span class="line">	proxy_pass http://web_pools;</span><br><span class="line">} </span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">}</span></span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>4、查看LVS规则</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@lb01 ~]#ipvsadm</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span></span><br><span class="line">[root@lb01 ~]#ipvsadm -ln</span><br></pre></td></tr></tbody></table></figure>



<h4 id="2-2-3-2-后端web服务器配置"><a href="#2-2-3-2-后端web服务器配置" class="headerlink" title="2.2.3.2 后端web服务器配置"></a>2.2.3.2 后端web服务器配置</h4><p>1、lo网卡绑定</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 /etc/nginx/conf.d]#ifconfig lo:1 10.0.0.3 netmask 255.255.255.255  </span><br></pre></td></tr></tbody></table></figure>

<p>永久保存</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 /etc/nginx/conf.d]#cat /etc/sysconfig/network-scripts/ifcfg-lo:1</span><br><span class="line">DEVICE=lo:1</span><br><span class="line">IPADDR=10.0.0.3</span><br><span class="line">NETMASK=255.255.255.255</span><br><span class="line">ONBOOT=yes</span><br><span class="line">NAME=loopback</span><br></pre></td></tr></tbody></table></figure>

<p>重启网络并查看</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 /etc/nginx/conf.d]#systemctl restart network</span><br><span class="line">[root@web01 /etc/nginx/conf.d]#ip a s lo</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 10.0.0.3/32 brd 10.0.0.3 scope global lo:1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></tbody></table></figure>

<p>2、抑制ARP解析</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt;/etc/sysctl.conf&lt;&lt;EOF</span><br><span class="line">net.ipv4.conf.all.arp_ignore = 1</span><br><span class="line">net.ipv4.conf.all.arp_announce = 2</span><br><span class="line">net.ipv4.conf.lo.arp_ignore = 1</span><br><span class="line">net.ipv4.conf.lo.arp_announce = 2</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看</span></span><br><span class="line">[root@web01 /etc/nginx/conf.d]#sysctl -p</span><br><span class="line">net.ipv4.conf.all.arp_ignore = 1</span><br><span class="line">net.ipv4.conf.all.arp_announce = 2</span><br><span class="line">net.ipv4.conf.lo.arp_ignore = 1</span><br><span class="line">net.ipv4.conf.lo.arp_announce = 2</span><br></pre></td></tr></tbody></table></figure>



<h4 id="2-2-3-3-测试"><a href="#2-2-3-3-测试" class="headerlink" title="2.2.3.3 测试"></a>2.2.3.3 测试</h4><p>多次访问<a href="http://10.0.0.3:80，应该指向不同的web服务端">http://10.0.0.3:80，应该指向不同的web服务端</a></p>
<p><img src="/../../../img/image-20240820151554150.png" alt="image-20240820151554150"></p>
<h3 id="2-2-4-LVS规则的备份和恢复"><a href="#2-2-4-LVS规则的备份和恢复" class="headerlink" title="2.2.4 LVS规则的备份和恢复"></a>2.2.4 LVS规则的备份和恢复</h3><p>1、保存配置和还原</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">导出配置</span></span><br><span class="line">ipvsadm-save -n &gt;/root/ipvs.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">还原配置</span></span><br><span class="line">ipvsadm-restore &lt;/root/ipvs.txt</span><br></pre></td></tr></tbody></table></figure>

<p>2、清空LVS规则，记得清空前备份</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@lb01 ~]#ipvsadm -C</span><br></pre></td></tr></tbody></table></figure>



<h2 id="2-3-LVS与keepalived结合"><a href="#2-3-LVS与keepalived结合" class="headerlink" title="2.3 LVS与keepalived结合"></a>2.3 LVS与keepalived结合</h2><h3 id="2-3-1-环境准备"><a href="#2-3-1-环境准备" class="headerlink" title="2.3.1 环境准备"></a>2.3.1 环境准备</h3><table>
<thead>
<tr>
<th>主机</th>
<th>作用</th>
<th>真实ip</th>
<th>虚拟IP（vip）</th>
</tr>
</thead>
<tbody><tr>
<td>lb01</td>
<td>LVS主服务器</td>
<td>10.0.0.5</td>
<td>10.0.0.3</td>
</tr>
<tr>
<td>lb01</td>
<td>LVS备服务器</td>
<td>10.0.0.6</td>
<td>10.0.0.3</td>
</tr>
<tr>
<td>web01</td>
<td>nginx-01</td>
<td>10.0.0.7</td>
<td>数据转向10.0.0.3</td>
</tr>
<tr>
<td>web02</td>
<td>nginx-02</td>
<td>10.0.0.8</td>
<td>数据转向10.0.0.3</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">                              |</span><br><span class="line">             +----------------+-----------------+</span><br><span class="line">             |                                  |</span><br><span class="line">10.0.0.5     |----       VIP:10.0.0.3       ----|     10.0.0.6</span><br><span class="line">     +-------+--------+                +--------+-------+</span><br><span class="line">     | 	    DS1       |                |       DS2      |</span><br><span class="line">     | LVS+Keepalived |                | LVS+Keepalived |</span><br><span class="line">     +-------+--------+                +--------+-------+</span><br><span class="line">             |			                |</span><br><span class="line">             +----------------+-----------------+</span><br><span class="line">                              |</span><br><span class="line">  +------------+              |               +------------+</span><br><span class="line">  |     RS1    |10.0.0.7      |       10.0.0.8|     RS2    |</span><br><span class="line">  | Web Server +--------------+---------------+ Web Server |</span><br><span class="line">  +------------+                              +------------+</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-3-2-DS服务器配置"><a href="#2-3-2-DS服务器配置" class="headerlink" title="2.3.2 DS服务器配置"></a>2.3.2 DS服务器配置</h3><h4 id="1）DS1配置LVS-Keepalived"><a href="#1）DS1配置LVS-Keepalived" class="headerlink" title="1）DS1配置LVS+Keepalived"></a>1）DS1配置LVS+Keepalived</h4><blockquote>
<p>配置前，先清空LVS的规则和eth0:0接口，因为keepalived会自动创建</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs {</span><br><span class="line">  router_id LVS_DEVEL</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 {</span><br><span class="line">    state MASTER            # 两个 DS，一个为 MASTER 一个为 BACKUP</span><br><span class="line">    interface eth0        # 当前 IP 对应的网络接口，通过 ifconfig 查询</span><br><span class="line">    virtual_router_id 62    # 虚拟路由 ID(0-255)，在一个 VRRP 实例中主备服务器 ID 必须一样</span><br><span class="line">    priority 200            # 优先级值设定：MASTER 要比 BACKUP 的值大</span><br><span class="line">    advert_int 1            # 通告时间间隔：单位秒，主备要一致</span><br><span class="line">    authentication {        # 认证机制，主从节点保持一致即可</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    }</span><br><span class="line">    virtual_ipaddress {</span><br><span class="line">        10.0.0.3       # VIP，可配置多个</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">LB 配置</span></span><br><span class="line">virtual_server 10.0.0.3 80  {</span><br><span class="line">    delay_loop 3                    # 设置健康状态检查时间</span><br><span class="line">    lb_algo rr                      # 调度算法，这里用了 rr 轮询算法</span><br><span class="line">    lb_kind DR                      # 这里测试用了 Direct Route 模式</span><br><span class="line">    persistence_timeout 50          # 持久连接超时时间</span><br><span class="line">    protocol TCP</span><br><span class="line">    real_server 10.0.0.7 80 {</span><br><span class="line">        weight 1</span><br><span class="line">        TCP_CHECK {</span><br><span class="line">            connect_timeout 10　　　</span><br><span class="line">            retry 3　　　　　　      # 旧版本为 nb_get_retry </span><br><span class="line">            delay_before_retry 3　　　</span><br><span class="line">            connect_port 80</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    real_server 10.0.0.8 80 {</span><br><span class="line">        weight 1</span><br><span class="line">        TCP_CHECK {</span><br><span class="line">            connect_timeout 10</span><br><span class="line">            retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h4 id="2）DS2配置LVS-Keepalived"><a href="#2）DS2配置LVS-Keepalived" class="headerlink" title="2）DS2配置LVS+Keepalived"></a>2）DS2配置LVS+Keepalived</h4><p>把配置文件中的<code>MASTER</code>改为<code>BACKUP</code>即可</p>
<h3 id="2-3-3-RS服务器配置"><a href="#2-3-3-RS服务器配置" class="headerlink" title="2.3.3 RS服务器配置"></a>2.3.3 RS服务器配置</h3><p>两台服务器参考<code>2.2.3.2</code>章节配置即可</p>
<h3 id="2-3-4-测试"><a href="#2-3-4-测试" class="headerlink" title="2.3.4 测试"></a>2.3.4 测试</h3><h4 id="1）-keepalived的主备切换"><a href="#1）-keepalived的主备切换" class="headerlink" title="1） keepalived的主备切换"></a>1） keepalived的主备切换</h4><p>启动服务后，默认lb01是主，并且有生成10.0.0.3的网络接口</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@lb01 /etc/sysconfig/network-scripts]#systemctl status keepalived.service </span><br><span class="line">● keepalived.service - LVS and VRRP High Availability Monitor</span><br><span class="line">...</span><br><span class="line">Aug 20 16:43:06 lb01 Keepalived_vrrp[5888]: Sending gratuitous ARP on eth0 for 10.0.0.3</span><br><span class="line">Aug 20 16:43:11 lb01 Keepalived_vrrp[5888]: VRRP_Instance(VI_1) Sending/queueing gratuitous ARPs on eth0 for 10.0.0.3</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<p>lb02为备，不生成10.0.0.3网络接口</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 ~]#systemctl status keepalived.service </span><br><span class="line">● keepalived.service - LVS and VRRP High Availability Monitor</span><br><span class="line">...</span><br><span class="line">Aug 20 16:43:06 lb02 Keepalived_vrrp[5049]: VRRP_Instance(VI_1) Entering BACKUP STATE</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<p>关闭lb01的keepalived服务，手动造成故障</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@lb01 /etc/sysconfig/network-scripts]#systemctl stop keepalived.service </span><br></pre></td></tr></tbody></table></figure>

<p>lb02切换为主，验证成功</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 ~]#systemctl status keepalived.service </span><br><span class="line">● keepalived.service - LVS and VRRP High Availability Monitor</span><br><span class="line">...</span><br><span class="line">Aug 20 16:55:14 lb02 Keepalived_vrrp[5162]: VRRP_Instance(VI_1) Transition to MASTER STATE</span><br><span class="line">Aug 20 16:55:15 lb02 Keepalived_vrrp[5162]: Sending gratuitous ARP on eth0 for 10.0.0.3</span><br><span class="line">Aug 20 16:55:15 lb02 Keepalived_vrrp[5162]: VRRP_Instance(VI_1) Sending/queueing gratuitous ARPs on eth0 for 10.0.0.3</span><br><span class="line">Aug 20 16:55:15 lb02 Keepalived_vrrp[5162]: Sending gratuitous ARP on eth0 for 10.0.0.3</span><br></pre></td></tr></tbody></table></figure>



<h4 id="2）-LVS的负载均衡测试"><a href="#2）-LVS的负载均衡测试" class="headerlink" title="2） LVS的负载均衡测试"></a>2） LVS的负载均衡测试</h4><p>访问<a href="http://10.0.0.3:80，可见访问web01和web02循环。">http://10.0.0.3:80，可见访问web01和web02循环。</a></p>
<p>查看LVS规则流量信息，确保两条路都有流量，验证成功</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@lb01 /etc/sysconfig/network-scripts]#ipvsadm -ln --stats</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port               Conns   InPkts  OutPkts  InBytes OutBytes</span><br><span class="line"><span class="meta prompt_">  -&gt; </span><span class="language-bash">RemoteAddress:Port</span></span><br><span class="line">TCP  10.0.0.3:80                         8      132        0    34840        0</span><br><span class="line"><span class="meta prompt_">  -&gt; </span><span class="language-bash">10.0.0.7:80                         4       90        0    24476        0</span></span><br><span class="line"><span class="meta prompt_">  -&gt; </span><span class="language-bash">10.0.0.8:80                         4       42        0    10364        0</span></span><br></pre></td></tr></tbody></table></figure>



<h1 id="二、加密隧道服务"><a href="#二、加密隧道服务" class="headerlink" title="二、加密隧道服务"></a>二、加密隧道服务</h1><h2 id="2-1-应用场景"><a href="#2-1-应用场景" class="headerlink" title="2.1 应用场景"></a>2.1 应用场景</h2><p>两点之间如何传输数据最安全？</p>
<ul>
<li>方案1：铺设专线，成本高昂</li>
<li>方案2：使用硬件3层路由、硬件VPN设备（如深信服VPN）</li>
<li>方案3：使用公有云等商业产品，通过网络传输</li>
<li>方案4：使用开源软件搭建VPN（如OpenVPN）</li>
</ul>
<p>加密隧道服务即是其中的方案4，OpenVPN有如下应用场景：</p>
<ul>
<li>运营：通过OpenVPN实现网站安全登录（后台地址，设置为只能通过VPN登录）</li>
<li>开发：通过OpenVPN实现开发与测试人员连接网站，进行开发测试</li>
<li>运维：通过OpenVPN连接内网服务器进行管理</li>
</ul>
<h2 id="2-2-OpenVPN原理图"><a href="#2-2-OpenVPN原理图" class="headerlink" title="2.2 OpenVPN原理图"></a>2.2 OpenVPN原理图</h2><p><img src="/../../../img/image-20240821133723790.png" alt="image-20240821133723790"></p>
<h2 id="2-3-OpenVPN快速上手"><a href="#2-3-OpenVPN快速上手" class="headerlink" title="2.3 OpenVPN快速上手"></a>2.3 OpenVPN快速上手</h2><h3 id="2-3-1-环境准备-1"><a href="#2-3-1-环境准备-1" class="headerlink" title="2.3.1 环境准备"></a>2.3.1 环境准备</h3><table>
<thead>
<tr>
<th>主机</th>
<th>ip</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>m01</td>
<td>10.0.0.61  / 172.16.1.61</td>
<td>openvpn server服务端</td>
</tr>
<tr>
<td>db01</td>
<td>10.0.0.51 / 172.16.1.51</td>
<td>内网服务器</td>
</tr>
<tr>
<td>windows 笔记本</td>
<td>192.168.1.103</td>
<td>openvpn客户端</td>
</tr>
</tbody></table>
<h3 id="2-3-2-服务端创建证书"><a href="#2-3-2-服务端创建证书" class="headerlink" title="2.3.2 服务端创建证书"></a>2.3.2 服务端创建证书</h3><h4 id="1）安装工具"><a href="#1）安装工具" class="headerlink" title="1）安装工具"></a>1）安装工具</h4><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">[root@mn01 ~]#yum install -y openvpn easy-rsa</span><br></pre></td></tr></tbody></table></figure>

<h4 id="2）创建CA证书"><a href="#2）创建CA证书" class="headerlink" title="2）创建CA证书"></a>2）创建CA证书</h4><p>修改vars文件，配置证书参数</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">充当权威机构,修改vars文件</span></span><br><span class="line">mkdir -p /opt/easy-rsa</span><br><span class="line">cp -a /usr/share/easy-rsa/3.0.8/* /opt/easy-rsa/</span><br><span class="line">cp /usr/share/doc/easy-rsa-3.0.8/vars.example /opt/easy-rsa/vars</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &gt;/opt/easy-rsa/vars&lt;&lt;'EOF'</span><br><span class="line">if [ -z "$EASYRSA_CALLER" ]; then</span><br><span class="line">	echo "You appear to be sourcing an Easy-RSA 'vars' file." &gt;&amp;2</span><br><span class="line">	echo "This is no longer necessary and is disallowed. See the section called" &gt;&amp;2</span><br><span class="line">	echo "'How to use this file' near the top comments for more details." &gt;&amp;2</span><br><span class="line">	return 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">set_var EASYRSA_DN "cn_only"</span><br><span class="line">set_var EASYRSA_REQ_COUNTRY "CN"</span><br><span class="line">set_var EASYRSA_REQ_PROVINCE "Beijing"</span><br><span class="line">set_var EASYRSA_REQ_CITY "Beijing"</span><br><span class="line">set_var EASYRSA_REQ_ORG "oldboylinux"</span><br><span class="line">set_var EASYRSA_REQ_EMAIL "oldboy@qq.com"</span><br><span class="line">set_var EASYRSA_NS_SUPPORT "yes"</span><br><span class="line">EOF</span><br></pre></td></tr></tbody></table></figure>

<p>初始化</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /opt/easy-rsa]#./easyrsa init-pki</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初始化完成，显示可以创建CA证书</span></span><br><span class="line">Note: using Easy-RSA configuration from: /opt/easy-rsa/vars</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初始化后的目录，在pki里面</span></span><br><span class="line">init-pki complete; you may now create a CA or requests.</span><br><span class="line">Your newly created PKI dir is: /opt/easy-rsa/pki</span><br></pre></td></tr></tbody></table></figure>

<p>生成证书</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /opt/easy-rsa]#./easyrsa build-ca</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">需要输入密码和姓名信息</span></span><br></pre></td></tr></tbody></table></figure>

<p>生成后的证书文件</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /opt/easy-rsa]#tree</span><br><span class="line">...</span><br><span class="line">├── pki</span><br><span class="line">│&nbsp;&nbsp; ├── ca.crt	# ca证书文件</span><br><span class="line">....</span><br><span class="line">│&nbsp;&nbsp; ├── private</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; └── ca.key	# ca私钥</span><br><span class="line">....</span><br><span class="line">14 directories, 18 files</span><br></pre></td></tr></tbody></table></figure>



<h4 id="3）创建server证书"><a href="#3）创建server证书" class="headerlink" title="3）创建server证书"></a>3）创建server证书</h4><p>1、创建server证书请求文件与服务器私钥，nopass表示不加密私钥文件，其他默认即可</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /opt/easy-rsa]#./easyrsa gen-req server nopass</span><br><span class="line">...</span><br><span class="line">Keypair and certificate request completed. Your files are:</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">req文件为请求文件，用于请求创建证书</span></span><br><span class="line">req: /opt/easy-rsa/pki/reqs/server.req	</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">key文件为server私钥文件</span></span><br><span class="line">key: /opt/easy-rsa/pki/private/server.key</span><br></pre></td></tr></tbody></table></figure>

<p>2、给server端证书签名，并生成server证书文件</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /opt/easy-rsa]#./easyrsa sign server server</span><br><span class="line">...</span><br><span class="line">Certificate created at: /opt/easy-rsa/pki/issued/server.crt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">需要输入<span class="built_in">yes</span>和前面设置的密码</span></span><br></pre></td></tr></tbody></table></figure>



<h4 id="4）创建client证书"><a href="#4）创建client证书" class="headerlink" title="4）创建client证书"></a>4）创建client证书</h4><p>1、创建client证书请求文件和私钥</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /opt/easy-rsa]#./easyrsa gen-req client nopass</span><br><span class="line">...</span><br><span class="line">req: /opt/easy-rsa/pki/reqs/client.req</span><br><span class="line">key: /opt/easy-rsa/pki/private/client.key</span><br></pre></td></tr></tbody></table></figure>

<p>2、给client端证书签名，生成client证书文件</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /opt/easy-rsa]#./easyrsa sign client client</span><br><span class="line">...</span><br><span class="line">Certificate created at: /opt/easy-rsa/pki/issued/client.crt</span><br></pre></td></tr></tbody></table></figure>



<h4 id="5）创建dh-pem算法文件"><a href="#5）创建dh-pem算法文件" class="headerlink" title="5）创建dh-pem算法文件"></a>5）创建dh-pem算法文件</h4><p>密钥交换时的认证方法</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /opt/easy-rsa]#./easyrsa gen-dh</span><br><span class="line">...</span><br><span class="line">DH parameters of size 2048 created at /opt/easy-rsa/pki/dh.pem</span><br></pre></td></tr></tbody></table></figure>



<h4 id="6）目录汇总"><a href="#6）目录汇总" class="headerlink" title="6）目录汇总"></a>6）目录汇总</h4><p>服务端生成文件的作用</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /opt/easy-rsa]#tree</span><br><span class="line">.</span><br><span class="line">├── easyrsa</span><br><span class="line">├── openssl-easyrsa.cnf</span><br><span class="line">├── pki</span><br><span class="line">│&nbsp;&nbsp; ├── ca.crt	# CA证书</span><br><span class="line">│&nbsp;&nbsp; ├── certs_by_serial</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── C3D54868BA8E3E17F9B7413AC6B14344.pem</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; └── DDF5E7679F3F220F3BB2466868D040F3.pem</span><br><span class="line">│&nbsp;&nbsp; ├── dh.pem	# dh算法文件</span><br><span class="line">│&nbsp;&nbsp; ├── index.txt</span><br><span class="line">│&nbsp;&nbsp; ├── index.txt.attr</span><br><span class="line">│&nbsp;&nbsp; ├── index.txt.attr.old</span><br><span class="line">│&nbsp;&nbsp; ├── index.txt.old</span><br><span class="line">│&nbsp;&nbsp; ├── issued</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── client.crt	# client证书</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; └── server.crt	# server证书</span><br><span class="line">│&nbsp;&nbsp; ├── openssl-easyrsa.cnf</span><br><span class="line">│&nbsp;&nbsp; ├── private</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ca.key</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── client.key	# server私钥</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; └── server.key	# client私钥</span><br><span class="line">...</span><br><span class="line">14 directories, 30 files</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-3-3-服务端配置文件，启动服务"><a href="#2-3-3-服务端配置文件，启动服务" class="headerlink" title="2.3.3 服务端配置文件，启动服务"></a>2.3.3 服务端配置文件，启动服务</h3><p>openvpn安装完之后的目录</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /opt/easy-rsa]#cd /etc/openvpn/</span><br><span class="line">[root@mn01 /etc/openvpn]#tree</span><br><span class="line">.</span><br><span class="line">├── client</span><br><span class="line">└── server</span><br></pre></td></tr></tbody></table></figure>

<p>创建服务端配置文件</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /etc/openvpn]#cat server/server.conf</span><br><span class="line">port 1194 #端口</span><br><span class="line">proto udp #协议</span><br><span class="line">dev tun #采用路由隧道模式tun</span><br><span class="line">ca ca.crt #ca证书文件位置，放在/etc/opnevpnr中</span><br><span class="line">cert server.crt # 服务端公钥文件</span><br><span class="line">key server.key #服务端私钥文件</span><br><span class="line">dh dh.pem #加密算法文件</span><br><span class="line">server 10.8.0.0 255.255.255.0 #给客户端分配地址池(ip地址范围)，注意：不能和VPN服务器内网网段有相同</span><br><span class="line">push "route 172.16.1.0 255.255.255.0" #客户端连接后,推送给客户端的路由规则</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ifconfig-pool-persist ipp.txt <span class="comment">#地址池记录文件位置 未来让openvpn 客户端固定ip地址使用的.</span></span></span><br><span class="line">keepalive 10 120 #存活时间，10秒ping一次,120 如未收到响应则视为断线</span><br><span class="line">max-clients 100 #最多允许100个客户端连接</span><br><span class="line"></span><br><span class="line">status /var/log/openvpn-status.log # 服务状态文件存放路径</span><br><span class="line">log /var/log/openvpn.log # openvpn日志记录位置</span><br><span class="line">verb 3 # verbose日志输出级别 数字越大越详细 最多11(debug)</span><br><span class="line">client-to-client # 客户端与客户端之间支持通信</span><br><span class="line">persist-key # 通过keepalive检测超时后，重新启动VPN，不重新读取keys，保留第一次使用的keys 对私钥进行缓存.</span><br><span class="line">persist-tun #检测超时后，重新启动VPN，一直保持tun是linkup的。否则网络会先linkdown然后再linkup</span><br><span class="line">duplicate-cn #客户端密钥(证书和私钥)是否可以重复</span><br></pre></td></tr></tbody></table></figure>

<p>拷贝证书到对应目录中</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /etc/openvpn]#cd /opt/easy-rsa/pki/</span><br><span class="line">[root@mn01 /opt/easy-rsa/pki]#cp  ca.crt  /etc/openvpn/server/</span><br><span class="line">[root@mn01 /opt/easy-rsa/pki]#cp dh.pem /etc/openvpn/server/</span><br><span class="line">[root@mn01 /opt/easy-rsa/pki]#cp issued/server.crt private/server.key /etc/openvpn/server/</span><br></pre></td></tr></tbody></table></figure>

<p>启动服务</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /]#systemctl daemon-reload </span><br><span class="line">[root@mn01 /]#systemctl enable --now openvpn-server@server</span><br></pre></td></tr></tbody></table></figure>

<p>启动后如果设置了密码，需要输入</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /etc/openvpn]#ss -lntup |grep 1194</span><br><span class="line">Broadcast message from root@mn01 (Wed 2024-08-21 15:35:54 CST):</span><br><span class="line"></span><br><span class="line">Password entry required for 'Enter Private Key Password:' (PID 4787).</span><br><span class="line">Please enter password with the systemd-tty-ask-password-agent tool!</span><br><span class="line"></span><br><span class="line">[root@mn01 /etc/openvpn]#systemd-tty-ask-password-agent</span><br><span class="line">Enter Private Key Password: *********</span><br></pre></td></tr></tbody></table></figure>

<p>查看进程状态</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /etc/openvpn]#ss -lntup |grep 1194</span><br><span class="line">udp    UNCONN     0      0         *:1194                  *:*                   users:(("openvpn",pid=4786,fd=5))</span><br><span class="line">[root@mn01 /etc/openvpn]#ip a s tun0</span><br><span class="line">4: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 100</span><br><span class="line">    link/none </span><br><span class="line">    inet 10.8.0.1 peer 10.8.0.2/32 scope global tun0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::34d5:c7f6:e5ac:1b53/64 scope link flags 800 </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></tbody></table></figure>

<p>查看路由状态</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /etc/openvpn]#route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.0.0.2        0.0.0.0         UG    102    0        0 ens33</span><br><span class="line">10.0.0.0        0.0.0.0         255.255.255.0   U     102    0        0 ens33</span><br><span class="line">10.8.0.0        10.8.0.2        255.255.255.0   UG    0      0        0 tun0</span><br><span class="line">10.8.0.2        0.0.0.0         255.255.255.255 UH    0      0        0 tun0</span><br><span class="line">172.16.1.0      0.0.0.0         255.255.255.0   U     101    0        0 ens36</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-3-4-客户端配置文件，连接访问"><a href="#2-3-4-客户端配置文件，连接访问" class="headerlink" title="2.3.4 客户端配置文件，连接访问"></a>2.3.4 客户端配置文件，连接访问</h3><h4 id="1）安装OpenVPN客户端"><a href="#1）安装OpenVPN客户端" class="headerlink" title="1）安装OpenVPN客户端"></a>1）安装OpenVPN客户端</h4><p>windows下载安装OpenVPN-GUI</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://openvpn.net/community-downloads/</span><br></pre></td></tr></tbody></table></figure>

<h4 id="2）准备配置文件"><a href="#2）准备配置文件" class="headerlink" title="2）准备配置文件"></a>2）准备配置文件</h4><p>将客户端需要的文件拷贝出来，放到一起</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /tmp]#ls client-gs/</span><br><span class="line">ca.crt  client.crt  client.key</span><br></pre></td></tr></tbody></table></figure>

<p>创建ovpn文件</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">client #指定当前VPN是客户端</span><br><span class="line">dev tun #使用tun隧道传输协议</span><br><span class="line">proto udp #使用udp协议传输数据</span><br><span class="line">remote 10.0.0.61 1194 #openvpn服务器IP地址端口号</span><br><span class="line">resolv-retry infinite #断线自动重新连接，在网络不稳定的情况下非常有用</span><br><span class="line">nobind #不绑定本地特定的端口号</span><br><span class="line">ca ca.crt #指定CA证书的文件路径</span><br><span class="line">cert client.crt #指定当前客户端的证书文件路径</span><br><span class="line">key client.key #指定当前客户端的私钥文件路径</span><br><span class="line">verb 3 #指定日志文件的记录详细级别，可选0-9，等级越高日志内容越详细</span><br><span class="line">persist-key #通过keepalive检测超时后，重新启动VPN，不重新读取keys，保留第一次使用的keys</span><br></pre></td></tr></tbody></table></figure>

<p>存放的目录可以在OpenVPN客户端中指定</p>
<p><img src="/../../../img/image-20240821155451333.png" alt="image-20240821155451333"></p>
<p>全部文件如下</p>
<p><img src="/../../../img/image-20240821155504577.png" alt="image-20240821155504577"></p>
<h4 id="3）连接OpenVPN和测试"><a href="#3）连接OpenVPN和测试" class="headerlink" title="3）连接OpenVPN和测试"></a>3）连接OpenVPN和测试</h4><p>右键小图标 — 连接，成功后变为绿色状态</p>
<p><img src="/../../../img/image-20240821155626815.png" alt="image-20240821155626815"></p>
<p>测试访问服务端内网的172网段，测试成功</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开启VPN可以访问</span></span><br><span class="line">C:\Users\gs&gt;ping 172.16.1.61</span><br><span class="line">正在 Ping 172.16.1.61 具有 32 字节的数据:</span><br><span class="line">来自 172.16.1.61 的回复: 字节=32 时间&lt;1ms TTL=64</span><br><span class="line">来自 172.16.1.61 的回复: 字节=32 时间&lt;1ms TTL=64</span><br><span class="line">来自 172.16.1.61 的回复: 字节=32 时间=6ms TTL=64</span><br><span class="line">来自 172.16.1.61 的回复: 字节=32 时间=1ms TTL=64</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭VPN无法访问</span></span><br><span class="line">C:\Users\gs&gt;ping 172.16.1.61</span><br><span class="line">正在 Ping 172.16.1.61 具有 32 字节的数据:</span><br><span class="line">请求超时。</span><br></pre></td></tr></tbody></table></figure>



<h2 id="2-4-OpenVPN连接内网"><a href="#2-4-OpenVPN连接内网" class="headerlink" title="2.4 OpenVPN连接内网"></a>2.4 OpenVPN连接内网</h2><p>应用场景：</p>
<p>​	目前我们可以已经可以通过OpenVPN来连接内网的mn01服务器（172.16.1.61），但是内网的其他的服务器仍是访问不到的，比如db01（172.16.1.51）</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[C:\~]$ ping 172.16.1.51</span><br><span class="line">正在 Ping 172.16.1.51 具有 32 字节的数据:</span><br><span class="line">请求超时。</span><br><span class="line">请求超时。</span><br></pre></td></tr></tbody></table></figure>

<p>原因是什么？</p>
<ul>
<li>流量可以过去，但是回来没有路由，过不来</li>
</ul>
<p>让我们来解决这个问题吧！</p>
<p>1、服务端mn01：开启内核转发功能</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /tmp]#echo 'net.ipv4.ip_forward = 1' &gt;&gt;/etc/sysctl.conf</span><br><span class="line">[root@mn01 /tmp]#sysctl -p</span><br><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></tbody></table></figure>

<p>2、内网服务器db01：添加路由规则（回来的路由）</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@db01 ~]#route add -net 10.8.0.0/24 gw 172.16.1.61</span><br></pre></td></tr></tbody></table></figure>



<p>OK，再试试，已经通了！</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[C:\~]$ ping 172.16.1.51</span><br><span class="line">正在 Ping 172.16.1.51 具有 32 字节的数据:</span><br><span class="line">来自 172.16.1.51 的回复: 字节=32 时间=1ms TTL=63</span><br><span class="line">来自 172.16.1.51 的回复: 字节=32 时间=1ms TTL=63</span><br><span class="line">来自 172.16.1.51 的回复: 字节=32 时间=5ms TTL=63</span><br><span class="line">来自 172.16.1.51 的回复: 字节=32 时间&lt;1ms TTL=63</span><br></pre></td></tr></tbody></table></figure>



<h2 id="2-5-OpenVPN密码认证"><a href="#2-5-OpenVPN密码认证" class="headerlink" title="2.5 OpenVPN密码认证"></a>2.5 OpenVPN密码认证</h2><p>方便设置客户端帐号，如：</p>
<table>
<thead>
<tr>
<th>用户分离</th>
</tr>
</thead>
<tbody><tr>
<td><strong>服务端</strong></td>
</tr>
<tr>
<td>ca.crt</td>
</tr>
<tr>
<td>server.key</td>
</tr>
<tr>
<td>server.crt</td>
</tr>
<tr>
<td><strong>客户端-张三</strong></td>
</tr>
<tr>
<td>ca.crt</td>
</tr>
<tr>
<td>zhangsan.key</td>
</tr>
<tr>
<td>zhangsan.crt</td>
</tr>
<tr>
<td>zhagnsan.ovpn</td>
</tr>
<tr>
<td><strong>客户端-托马斯-gao</strong></td>
</tr>
<tr>
<td>ca.crt</td>
</tr>
<tr>
<td>tomcat-gao.key</td>
</tr>
<tr>
<td>tomcat-gao.crt</td>
</tr>
<tr>
<td>tomcat-gao.ovpn</td>
</tr>
</tbody></table>
<h3 id="2-5-1-服务端开启密码认证功能"><a href="#2-5-1-服务端开启密码认证功能" class="headerlink" title="2.5.1 服务端开启密码认证功能"></a>2.5.1 服务端开启密码认证功能</h3><p>1、修改配置文件，添加四行</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">script-security 3 # 允许使用自定义脚本</span><br><span class="line">auth-user-pass-verify /etc/openvpn/check.sh via-env # 指定认证脚本</span><br><span class="line">username-as-common-name # 开启用户密码登陆方式验证</span><br><span class="line">client-cert-not-required # 只使用用户密码方式验证登录，不加则代表需要证书和用户名密码双重验证登录</span><br></pre></td></tr></tbody></table></figure>

<p>2、创建check.sh脚本文件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">##############################################################</span><br><span class="line"># File Name:check.sh</span><br><span class="line"># Version:V1.0</span><br><span class="line"># Author:Haris Gong</span><br><span class="line"># Organization:gsproj.github.io</span><br><span class="line"># Desc:</span><br><span class="line">##############################################################</span><br><span class="line"></span><br><span class="line">PASSFILE="/etc/openvpn/openvpnfile" #密码文件 用户名 密码明文</span><br><span class="line">LOG_FILE="/var/log/openvpn-password.log" #用户登录情况的日志</span><br><span class="line">TIME_STAMP=`date "+%Y-%m-%d %T"`</span><br><span class="line"></span><br><span class="line">if [ ! -r "${PASSFILE}" ]; then</span><br><span class="line">  echo "${TIME_STAMP}: Could not open password file \"${PASSFILE}\" for reading." &gt;&gt; ${LOG_FILE}</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">CORRECT_PASSWORD=`awk '!/^;/&amp;&amp;!/^#/&amp;&amp;$1=="'${username}'"{print $2;exit}' ${PASSFILE}`</span><br><span class="line"></span><br><span class="line">if [ "${CORRECT_PASSWORD}" = "" ]; then </span><br><span class="line">  echo "${TIME_STAMP}: User does not exist: username=\"${username}\", password=\"${password}\"." &gt;&gt; ${LOG_FILE}</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ "${password}" = "${CORRECT_PASSWORD}" ]; then </span><br><span class="line">  echo "${TIME_STAMP}: Successful authentication: username=\"${username}\"." &gt;&gt; ${LOG_FILE}</span><br><span class="line">  exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo "${TIME_STAMP}: Incorrect password: username=\"${username}\", password=\"${password}\"." &gt;&gt; ${LOG_FILE}</span><br><span class="line">exit 1</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>3、脚本设置执行权限</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 700 check.sh</span><br></pre></td></tr></tbody></table></figure>

<p>4、创建用户和密码文件</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@mn01 /etc/openvpn]#cat openvpnfile </span><br><span class="line">xiaoming 123</span><br><span class="line">xiaozhou 223</span><br></pre></td></tr></tbody></table></figure>

<p>5、重启服务</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart openvpn-server@server.service</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-5-2-客户端连接"><a href="#2-5-2-客户端连接" class="headerlink" title="2.5.2 客户端连接"></a>2.5.2 客户端连接</h3><h4 id="1）手动输入帐号密码的方式"><a href="#1）手动输入帐号密码的方式" class="headerlink" title="1）手动输入帐号密码的方式"></a>1）手动输入帐号密码的方式</h4><p>修改配置文件，关闭秘钥认证，开启密码认证</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">client #指定当前VPN是客户端</span><br><span class="line">dev tun #使用tun隧道传输协议</span><br><span class="line">proto udp #使用udp协议传输数据</span><br><span class="line">remote 10.0.0.61 1194 #openvpn服务器IP地址端口号</span><br><span class="line">resolv-retry infinite #断线自动重新连接，在网络不稳定的情况下非常有用</span><br><span class="line">nobind #不绑定本地特定的端口号</span><br><span class="line">ca ca.crt #指定CA证书的文件路径</span><br><span class="line">;cert client.crt # 注释，因为不需要密钥认证了</span><br><span class="line">;key client.key # 注释，因为不需要密钥认证了</span><br><span class="line">verb 3 #指定日志文件的记录详细级别，可选0-9，等级越高日志内容越详细</span><br><span class="line">persist-key #通过keepalive检测超时后，重新启动VPN，不重新读取keys，保留第一次使用的keys</span><br><span class="line">auth-user-pass # 开启密码认证</span><br></pre></td></tr></tbody></table></figure>

<p>测试连接，会弹出输入帐号密码的框</p>
<p><img src="/../../../img/image-20240821171242085.png" alt="image-20240821171242085"></p>
<p>连接成功</p>
<p><img src="/../../../img/image-20240821171312095.png" alt="image-20240821171312095"></p>
<h4 id="2）保存到文件的方式"><a href="#2）保存到文件的方式" class="headerlink" title="2）保存到文件的方式"></a>2）保存到文件的方式</h4><p>创建一个保存帐号密码的文件</p>
<p><img src="/../../../img/image-20240821171537460.png" alt="image-20240821171537460"></p>
<p>在ovpn配置文件中指定即可</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth-user-pass login.conf</span><br></pre></td></tr></tbody></table></figure>



<h1 id="三、JumpServer跳板机"><a href="#三、JumpServer跳板机" class="headerlink" title="三、JumpServer跳板机"></a>三、JumpServer跳板机</h1><p>为什么需要使用跳板机？</p>
<ul>
<li>普通日常运维一般使用远程连接工具，一台台登录，这种方式虽然方便，但是不方便做行为审计，如何时何地做了什么？难以批量管理。</li>
<li>自动化运维推荐使用跳板机管理服务器，不仅方便审计，还可以利用自动化工具对服务器进行批量管理。</li>
</ul>
<h2 id="3-1-常用跳板机选择"><a href="#3-1-常用跳板机选择" class="headerlink" title="3.1 常用跳板机选择"></a>3.1 常用跳板机选择</h2><table>
<thead>
<tr>
<th>跳板机</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>teleport</td>
<td>功能简单，使用方便，简约风</td>
</tr>
<tr>
<td>Jms(JumpServer)</td>
<td>功能详细，需要系统配置要求会更高</td>
</tr>
<tr>
<td>其他开源软件…</td>
<td></td>
</tr>
<tr>
<td>商业软件/硬件</td>
<td></td>
</tr>
</tbody></table>
<h2 id="3-2-实验环境准备"><a href="#3-2-实验环境准备" class="headerlink" title="3.2 实验环境准备"></a>3.2 实验环境准备</h2><table>
<thead>
<tr>
<th>主机</th>
<th>IP</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>jms01</td>
<td>10.0.0.65</td>
<td>跳板机</td>
</tr>
<tr>
<td>web01</td>
<td>10.0.0.5</td>
<td>被管理机器</td>
</tr>
<tr>
<td>web02</td>
<td>10.0.0.6</td>
<td>被管理机器</td>
</tr>
</tbody></table>
<h2 id="3-3-快速上手-单机部署"><a href="#3-3-快速上手-单机部署" class="headerlink" title="3.3 快速上手  - 单机部署"></a>3.3 快速上手  - 单机部署</h2><blockquote>
<p>选用开源软件 JumpServer</p>
<p>官网：<a target="_blank" rel="noopener" href="https://www.jumpserver.org/">https://www.jumpserver.org/</a></p>
</blockquote>
<h3 id="3-3-1-下载安装包"><a href="#3-3-1-下载安装包" class="headerlink" title="3.3.1 下载安装包"></a>3.3.1 下载安装包</h3><p>1、下载安装包，上传至服务器</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">选择LTS版本：3.10.13</span> </span><br><span class="line">jumpserver-offline-installer-v3.10.13-amd64.tar.gz</span><br></pre></td></tr></tbody></table></figure>

<p>2、安装依赖包</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y wget curl tar gettext iptables</span><br></pre></td></tr></tbody></table></figure>



<h3 id="3-3-2-部署数据库和缓存"><a href="#3-3-2-部署数据库和缓存" class="headerlink" title="3.3.2 部署数据库和缓存"></a>3.3.2 部署数据库和缓存</h3><p>1、部署MySQL数据库，（PostgreSQL、MySQL 或 MariaDB 三选一）</p>
<p>安装方式<a href="http://gsproj.github.io/2024/05/13/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/02_%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/19-web%E9%9B%86%E7%BE%A4-Tomcat-2-%E5%AE%8C%E7%BB%93/">参考连接</a>中的5.2.2节，至服务启动</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@h3cy02 tools]# systemctl start mysqld</span><br><span class="line">[root@h3cy02 tools]# systemctl status mysqld</span><br><span class="line">● mysqld.service - LSB: start and stop MySQL</span><br><span class="line">   Loaded: loaded (/etc/rc.d/init.d/mysqld; bad; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Fri 2024-09-06 10:03:15 CST; 4s ago</span><br><span class="line">...</span><br><span class="line">Sep 06 10:03:15 h3cy02 mysqld[51584]: SUCCESS!</span><br><span class="line">Sep 06 10:03:15 h3cy02 systemd[1]: Started LSB: start and stop MySQL.</span><br><span class="line">[root@h3cy02 tools]# mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">...</span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span></span><br></pre></td></tr></tbody></table></figure>

<p>创建jumpserver数据库</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show create database jumpserver;</span></span><br></pre></td></tr></tbody></table></figure>

<p>创建jumpserver用户，用于连接jumpserver数据库</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create user jumpserver@<span class="string">'localhost'</span> identified with mysql_native_password by <span class="string">'redhat123'</span>;</span></span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">grant all on jumpserver.* to jumpserver@<span class="string">'localhost'</span>;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></tbody></table></figure>

<p>修改MySQL的ROOT密码</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER 'root'@'localhost' IDENTIFIED BY 'rxxxx3';</span><br></pre></td></tr></tbody></table></figure>



<p>2、部署Redis（源码方式）</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载源码</span></span><br><span class="line">wget https://download.redis.io/releases/redis-6.2.6.tar.gz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压</span></span><br><span class="line">tar -xf redis-6.2.6.tar.gz </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译安装</span></span><br><span class="line">make -j 8 &amp;&amp; make install</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@h3cy02 redis-6.2.6]# redis-cli  --version</span><br><span class="line">redis-cli 6.2.6</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建服务文件</span></span><br><span class="line">[root@h3cy02 ~]# cat /usr/lib/systemd/system/redis-server.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Redis Server</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/local/bin/redis-server</span><br><span class="line">KillMode=process</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动服务</span></span><br><span class="line">[root@h3cy02 systemd]# systemctl enable --now redis-server.service </span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/redis-server.service to /usr/lib/systemd/system/redis-server.service.</span><br><span class="line">[root@h3cy02 systemd]# systemctl status redis-server.service </span><br><span class="line">● redis-server.service - Redis Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/redis-server.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Fri 2024-09-06 10:24:52 CST; 5s ago</span><br><span class="line"> Main PID: 57145 (redis-server)</span><br><span class="line">   CGroup: /system.slice/redis-server.service</span><br><span class="line">           └─57145 /usr/local/bin/redis-server *:6379</span><br></pre></td></tr></tbody></table></figure>



<h3 id="3-3-4-部署docker和docker-compose"><a href="#3-3-4-部署docker和docker-compose" class="headerlink" title="3.3.4 部署docker和docker-compose"></a>3.3.4 部署docker和docker-compose</h3><p>在线安装方法</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加阿里源</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出列表</span></span><br><span class="line">[root@h3cy02 yum.repos.d]# yum list docker-ce --showduplicates | sort -r</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">docker-ce.x86_64            3:26.1.4-1.el7                      docker-ce-stable</span><br><span class="line">docker-ce.x86_64            3:26.1.3-1.el7                      docker-ce-stable</span><br><span class="line">....</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装Docker18</span></span><br><span class="line">yum install -y docker-ce</span><br></pre></td></tr></tbody></table></figure>

<p>离线安装方法<strong>（采用）</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载</span></span><br><span class="line">wget https://mirrors.aliyun.com/docker-ce/linux/static/stable/x86_64/docker-27.2.0.tgz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压</span></span><br><span class="line">tar -xf docker-27.2.0.tgz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">部署</span></span><br><span class="line">cp -a ./* /usr/local/bin/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置服务文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /usr/lib/systemd/system/docker.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network-online.target firewalld.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">ExecStart=/usr/local/bin/dockerd</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">TimeoutStartSec=0</span><br><span class="line">RestartSec=2</span><br><span class="line">Restart=always</span><br><span class="line">StartLimitBurst=3</span><br><span class="line">StartLimitInterval=60s</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">TasksMax=infinity</span><br><span class="line">Delegate=yes</span><br><span class="line">KillMode=process</span><br><span class="line">OOMScoreAdjust=-500</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动服务</span></span><br><span class="line">systemctl enable --now docker.service</span><br></pre></td></tr></tbody></table></figure>

<p>安装docker-compose</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载</span></span><br><span class="line">curl -SL https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行权限</span></span><br><span class="line">chmod a+x /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@h3cy02 docker]# docker-compose -v</span><br><span class="line">Docker Compose version v2.16.0</span><br></pre></td></tr></tbody></table></figure>



<h3 id="3-3-3-部署Jumpserver（离线安装）"><a href="#3-3-3-部署Jumpserver（离线安装）" class="headerlink" title="3.3.3 部署Jumpserver（离线安装）"></a>3.3.3 部署Jumpserver（离线安装）</h3><p>离线安装目前只支持 linux/amd64架构，其他架构需要在线安装</p>
<p>1、设置</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压安装包，放到/opt文件夹</span></span><br><span class="line">[root@h3cy02 tarball]# tar -xf jumpserver-offline-installer-v3.10.13-amd64.tar.gz -C /opt/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">软连接</span></span><br><span class="line">ln -s /opt/jumpserver-offline-installer-v3.10.13-amd64/ /opt/jumpserver</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据需要修改配置文件模板</span></span><br><span class="line">mkdir config</span><br><span class="line">cp config-example.txt /config/config.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改mysql的部分</span></span><br><span class="line">DB_HOST=localhost</span><br><span class="line">DB_PORT=3306</span><br><span class="line">DB_USER=jumpserver</span><br><span class="line">DB_PASSWORD=rxxxx3</span><br><span class="line">DB_NAME=jumpserver</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2、执行安装</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入目录</span></span><br><span class="line">cd /opt/jumpserver</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">[root@h3cy02 jumpserver]# ./jmsctl.sh install</span><br></pre></td></tr></tbody></table></figure>

<p>安装成功的显示</p>
<p><img src="/../../../img/image-20240906121933414.png" alt="image-20240906121933414"></p>
<p>3、启动命令</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动</span></span><br><span class="line">./jmsctl.sh start</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止</span></span><br><span class="line">./jmsctl.sh down</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载</span></span><br><span class="line">./jmsctl.sh uninstall</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">帮助</span></span><br><span class="line">./jmsctl.sh -h</span><br></pre></td></tr></tbody></table></figure>

<p>4、80端口访问站点</p>
<p><img src="/../../../img/image-20240909094020576.png" alt="image-20240909094020576"></p>
<p>初始密码：admin / admin</p>
<p>5、进入管理页面后，配置资产、授权等页面，实现跳板机访问内网服务器</p>
<p><img src="/../../../img/image-20240909103404023.png" alt="image-20240909103404023"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://gsproj.github.io">Haris</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://gsproj.github.io/2024/08/21/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day79-LVS%E4%B8%8EJumpServer/">http://gsproj.github.io/2024/08/21/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day79-LVS%E4%B8%8EJumpServer/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://gsproj.github.io" target="_blank">Haris的小站</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/%E5%A4%B4%E5%83%8F.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/08/02/06_%E6%9D%82%E8%AE%B0/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" title="人工智能集群了解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">人工智能集群了解</div></div><div class="info-2"><div class="info-item-1">一、InfiniBand算力网络1.1 技术背景infiniband直译为“无限带宽”技术，是一个高性能计算的计算机网络通信标准。大致发展路线如下：  上世纪90年代：为了连接更多的外部设备，英特尔推出PCI总线，刚开始都用这个  1999年，FIO Developers Forum（IBM、康柏以及惠普）和NGIO Forum（英特尔、微软、SUN）进行了合并，创立了InfiniBand贸易协会，诞生的目的，就是为了取代PCI  2001年，从英特尔公司和伽利略技术公司离职的员工，在以色列创立了一家芯片公司Mellanox，2001年加入InifiniBand联盟，并推出首款InfiniBand产品  2002年，InfiniBand阵营突遭巨变，英特尔公司“临阵脱逃”，决定转向开发PCI...</div></div></div></a><a class="pagination-related" href="/2024/09/09/06_%E6%9D%82%E8%AE%B0/Mellanox%E7%BD%91%E5%8D%A1%E5%AE%89%E8%A3%85%E9%A9%B1%E5%8A%A8/" title="Mellanox网卡安装驱动"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Mellanox网卡安装驱动</div></div><div class="info-2"><div class="info-item-1">Mellanox网卡安装驱动文档作用： ​	在旧版本操作系统中（如Cenos7.4），部分网卡不能识别出来，需要手动安装驱动。 一、查看网卡BMC界面查看安装了7张网卡，共13个网口  在系统中使用lspci也可以看到13个网口 1234567891011121314[root@localhost ~]# lspci | grep Mellanox04:00.0 Ethernet controller: Mellanox Technologies MT27800 Family [ConnectX-5]04:00.1 Ethernet controller: Mellanox Technologies MT27800 Family [ConnectX-5]08:00.0 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4 Lx]08:00.1 Ethernet controller: Mellanox Technologies MT27710 Family [ConnectX-4...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info-name">Haris</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">215</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">32</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%BB%8B%E7%BB%8D"><span class="toc-text">一、负载均衡介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%B8%B8%E8%A7%81%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AF%B9%E6%AF%94"><span class="toc-text">1.1 常见负载均衡对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%92%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">1.2 反向代理和负载均衡的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-ARP%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90"><span class="toc-text">1.3 ARP地址解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-ARP%E6%AC%BA%E9%AA%97"><span class="toc-text">1.3.1 ARP欺骗</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81LVS%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="toc-text">二、LVS快速上手</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-LVS%E6%A6%82%E8%BF%B0"><span class="toc-text">2.1 LVS概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-LVS-DR%E6%A8%A1%E5%BC%8F%E4%B8%8A%E6%89%8B"><span class="toc-text">2.2 LVS-DR模式上手</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">2.2.1 环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E5%89%8D%E6%8F%90%E5%A4%84%E7%90%86"><span class="toc-text">2.2.2 前提处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-DR%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B"><span class="toc-text">2.2.3 DR模式配置流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-1-LVS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">2.2.3.1 LVS服务器配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-2-%E5%90%8E%E7%AB%AFweb%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">2.2.3.2 后端web服务器配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">2.2.3.3 测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-LVS%E8%A7%84%E5%88%99%E7%9A%84%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D"><span class="toc-text">2.2.4 LVS规则的备份和恢复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-LVS%E4%B8%8Ekeepalived%E7%BB%93%E5%90%88"><span class="toc-text">2.3 LVS与keepalived结合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">2.3.1 环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-DS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">2.3.2 DS服务器配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89DS1%E9%85%8D%E7%BD%AELVS-Keepalived"><span class="toc-text">1）DS1配置LVS+Keepalived</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89DS2%E9%85%8D%E7%BD%AELVS-Keepalived"><span class="toc-text">2）DS2配置LVS+Keepalived</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-RS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">2.3.3 RS服务器配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-%E6%B5%8B%E8%AF%95"><span class="toc-text">2.3.4 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89-keepalived%E7%9A%84%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2"><span class="toc-text">1） keepalived的主备切换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89-LVS%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%B5%8B%E8%AF%95"><span class="toc-text">2） LVS的负载均衡测试</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%8A%A0%E5%AF%86%E9%9A%A7%E9%81%93%E6%9C%8D%E5%8A%A1"><span class="toc-text">二、加密隧道服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">2.1 应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-OpenVPN%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="toc-text">2.2 OpenVPN原理图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-OpenVPN%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="toc-text">2.3 OpenVPN快速上手</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-1"><span class="toc-text">2.3.1 环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6"><span class="toc-text">2.3.2 服务端创建证书</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E5%AE%89%E8%A3%85%E5%B7%A5%E5%85%B7"><span class="toc-text">1）安装工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E5%88%9B%E5%BB%BACA%E8%AF%81%E4%B9%A6"><span class="toc-text">2）创建CA证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E5%88%9B%E5%BB%BAserver%E8%AF%81%E4%B9%A6"><span class="toc-text">3）创建server证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E5%88%9B%E5%BB%BAclient%E8%AF%81%E4%B9%A6"><span class="toc-text">4）创建client证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%EF%BC%89%E5%88%9B%E5%BB%BAdh-pem%E7%AE%97%E6%B3%95%E6%96%87%E4%BB%B6"><span class="toc-text">5）创建dh-pem算法文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%EF%BC%89%E7%9B%AE%E5%BD%95%E6%B1%87%E6%80%BB"><span class="toc-text">6）目录汇总</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="toc-text">2.3.3 服务端配置文件，启动服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E8%BF%9E%E6%8E%A5%E8%AE%BF%E9%97%AE"><span class="toc-text">2.3.4 客户端配置文件，连接访问</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E5%AE%89%E8%A3%85OpenVPN%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">1）安装OpenVPN客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E5%87%86%E5%A4%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">2）准备配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E8%BF%9E%E6%8E%A5OpenVPN%E5%92%8C%E6%B5%8B%E8%AF%95"><span class="toc-text">3）连接OpenVPN和测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-OpenVPN%E8%BF%9E%E6%8E%A5%E5%86%85%E7%BD%91"><span class="toc-text">2.4 OpenVPN连接内网</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-OpenVPN%E5%AF%86%E7%A0%81%E8%AE%A4%E8%AF%81"><span class="toc-text">2.5 OpenVPN密码认证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-1-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%90%AF%E5%AF%86%E7%A0%81%E8%AE%A4%E8%AF%81%E5%8A%9F%E8%83%BD"><span class="toc-text">2.5.1 服务端开启密码认证功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-2-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5"><span class="toc-text">2.5.2 客户端连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E6%89%8B%E5%8A%A8%E8%BE%93%E5%85%A5%E5%B8%90%E5%8F%B7%E5%AF%86%E7%A0%81%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">1）手动输入帐号密码的方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E4%BF%9D%E5%AD%98%E5%88%B0%E6%96%87%E4%BB%B6%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">2）保存到文件的方式</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81JumpServer%E8%B7%B3%E6%9D%BF%E6%9C%BA"><span class="toc-text">三、JumpServer跳板机</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%B8%B8%E7%94%A8%E8%B7%B3%E6%9D%BF%E6%9C%BA%E9%80%89%E6%8B%A9"><span class="toc-text">3.1 常用跳板机选择</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">3.2 实验环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B-%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2"><span class="toc-text">3.3 快速上手  - 单机部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%8C%85"><span class="toc-text">3.3.1 下载安装包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E9%83%A8%E7%BD%B2%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E7%BC%93%E5%AD%98"><span class="toc-text">3.3.2 部署数据库和缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-4-%E9%83%A8%E7%BD%B2docker%E5%92%8Cdocker-compose"><span class="toc-text">3.3.4 部署docker和docker-compose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-%E9%83%A8%E7%BD%B2Jumpserver%EF%BC%88%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%EF%BC%89"><span class="toc-text">3.3.3 部署Jumpserver（离线安装）</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/14/06_%E6%9D%82%E8%AE%B0/%E5%8D%8E%E4%B8%BAUSG6615F%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AESSL%20VPN/" title="华为USG6615F防火墙配置SSLVPN">华为USG6615F防火墙配置SSLVPN</a><time datetime="2025-05-14T07:00:52.000Z" title="发表于 2025-05-14 15:00:52">2025-05-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/06/10_%E5%AD%A6%E7%A5%9EK8S/01-Docker%E5%9F%BA%E7%A1%80/01-Dokcer%E5%9F%BA%E7%A1%80/" title="01-Docker基础">01-Docker基础</a><time datetime="2025-05-06T05:52:52.000Z" title="发表于 2025-05-06 13:52:52">2025-05-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/30/06_%E6%9D%82%E8%AE%B0/vllm%E9%83%A8%E7%BD%B2Qwen3%E5%A4%A7%E6%A8%A1%E5%9E%8B/" title="VLLM部署Qwen3大模型">VLLM部署Qwen3大模型</a><time datetime="2025-04-30T07:15:52.000Z" title="发表于 2025-04-30 15:15:52">2025-04-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/21/06_%E6%9D%82%E8%AE%B0/%E5%8D%8E%E4%B8%BA%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%85%8D%E7%BD%AEmux-vlan/" title="华为交换机配置mux-vlan">华为交换机配置mux-vlan</a><time datetime="2025-04-21T08:29:52.000Z" title="发表于 2025-04-21 16:29:52">2025-04-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/21/06_%E6%9D%82%E8%AE%B0/ollama%E9%83%A8%E7%BD%B2deepseek%E5%A4%A7%E6%A8%A1%E5%9E%8B/" title="8卡A800运行DeepseekR1-671B大模型">8卡A800运行DeepseekR1-671B大模型</a><time datetime="2025-04-21T06:29:52.000Z" title="发表于 2025-04-21 14:29:52">2025-04-21</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">©2019 - 2025 By Haris</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"></div><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>