

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="GongSheng">
  <meta name="keywords" content="">
  
    <meta name="description" content="è‡ªåŠ¨åŒ–æ¶æ„-iptablesé˜²ç«å¢™ä»Šæ—¥å†…å®¹ï¼š â€‹	iptablesé˜²ç«å¢™ ä¸€ã€é˜²ç«å¢™æ¦‚è¿°1.1 é˜²ç«å¢™çš„åŠŸèƒ½å¯ä»¥ç”¨äºå®ç°ï¼š  ç«¯å£å°ç¦ IPå°ç¦ å®ç°NATåŠŸèƒ½ å…±äº«ä¸Šç½‘ ç«¯å£è½¬å‘ã€IPæ˜ å°„    1.2 é˜²ç«å¢™ç§ç±»åŠä½¿ç”¨è¯´æ˜ç¡¬ä»¶: æ•´ä¸ªä¼ä¸šå…¥å£  ä¸‰å±‚è·¯ç”±: H3C åä¸º Cisco(æ€ç§‘) é˜²ç«å¢™: æ·±ä¿¡æœ,ç»¿ç›Ÿ,å¥‡å®‰ä¿¡â€¦..  è½¯ä»¶: å¼€æºè½¯ä»¶ ç½‘ç«™å†…éƒ¨ å°ip å°ip  iptables">
<meta property="og:type" content="article">
<meta property="og:title" content="day59-è‡ªåŠ¨åŒ–æ¶æ„-iptablesé˜²ç«å¢™">
<meta property="og:url" content="http://gsproj.github.io/2024/05/23/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day58-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84-iptables%E9%98%B2%E7%81%AB%E5%A2%99/index.html">
<meta property="og:site_name" content="è¿é£ä¹‹è±šçš„åšå®¢">
<meta property="og:description" content="è‡ªåŠ¨åŒ–æ¶æ„-iptablesé˜²ç«å¢™ä»Šæ—¥å†…å®¹ï¼š â€‹	iptablesé˜²ç«å¢™ ä¸€ã€é˜²ç«å¢™æ¦‚è¿°1.1 é˜²ç«å¢™çš„åŠŸèƒ½å¯ä»¥ç”¨äºå®ç°ï¼š  ç«¯å£å°ç¦ IPå°ç¦ å®ç°NATåŠŸèƒ½ å…±äº«ä¸Šç½‘ ç«¯å£è½¬å‘ã€IPæ˜ å°„    1.2 é˜²ç«å¢™ç§ç±»åŠä½¿ç”¨è¯´æ˜ç¡¬ä»¶: æ•´ä¸ªä¼ä¸šå…¥å£  ä¸‰å±‚è·¯ç”±: H3C åä¸º Cisco(æ€ç§‘) é˜²ç«å¢™: æ·±ä¿¡æœ,ç»¿ç›Ÿ,å¥‡å®‰ä¿¡â€¦..  è½¯ä»¶: å¼€æºè½¯ä»¶ ç½‘ç«™å†…éƒ¨ å°ip å°ip  iptables">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240523093136580.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240523095135715.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240523100757954.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240523100936333.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240523101321910.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240523152333677.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240523155941222.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240523161946286.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240523163857176.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240523163311287.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240523173000068.png">
<meta property="og:image" content="http://gsproj.github.io/img/image-20240523173536525.png">
<meta property="article:published_time" content="2024-05-23T01:08:52.000Z">
<meta property="article:modified_time" content="2024-08-02T01:48:34.361Z">
<meta property="article:author" content="GongSheng">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://gsproj.github.io/img/image-20240523093136580.png">
  
  
  
  <title>day59-è‡ªåŠ¨åŒ–æ¶æ„-iptablesé˜²ç«å¢™ - è¿é£ä¹‹è±šçš„åšå®¢</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"gsproj.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Harisçš„åšå®¢</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="day59-è‡ªåŠ¨åŒ–æ¶æ„-iptablesé˜²ç«å¢™"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-05-23 09:08" pubdate>
          2024å¹´5æœˆ23æ—¥ ä¸Šåˆ
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          34 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">day59-è‡ªåŠ¨åŒ–æ¶æ„-iptablesé˜²ç«å¢™</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="è‡ªåŠ¨åŒ–æ¶æ„-iptablesé˜²ç«å¢™"><a href="#è‡ªåŠ¨åŒ–æ¶æ„-iptablesé˜²ç«å¢™" class="headerlink" title="è‡ªåŠ¨åŒ–æ¶æ„-iptablesé˜²ç«å¢™"></a>è‡ªåŠ¨åŒ–æ¶æ„-iptablesé˜²ç«å¢™</h1><p>ä»Šæ—¥å†…å®¹ï¼š</p>
<p>â€‹	iptablesé˜²ç«å¢™</p>
<h1 id="ä¸€ã€é˜²ç«å¢™æ¦‚è¿°"><a href="#ä¸€ã€é˜²ç«å¢™æ¦‚è¿°" class="headerlink" title="ä¸€ã€é˜²ç«å¢™æ¦‚è¿°"></a>ä¸€ã€é˜²ç«å¢™æ¦‚è¿°</h1><h2 id="1-1-é˜²ç«å¢™çš„åŠŸèƒ½"><a href="#1-1-é˜²ç«å¢™çš„åŠŸèƒ½" class="headerlink" title="1.1 é˜²ç«å¢™çš„åŠŸèƒ½"></a>1.1 é˜²ç«å¢™çš„åŠŸèƒ½</h2><p>å¯ä»¥ç”¨äºå®ç°ï¼š</p>
<ul>
<li>ç«¯å£å°ç¦</li>
<li>IPå°ç¦</li>
<li>å®ç°NATåŠŸèƒ½<ul>
<li>å…±äº«ä¸Šç½‘</li>
<li>ç«¯å£è½¬å‘ã€IPæ˜ å°„</li>
</ul>
</li>
</ul>
<h2 id="1-2-é˜²ç«å¢™ç§ç±»åŠä½¿ç”¨è¯´æ˜"><a href="#1-2-é˜²ç«å¢™ç§ç±»åŠä½¿ç”¨è¯´æ˜" class="headerlink" title="1.2 é˜²ç«å¢™ç§ç±»åŠä½¿ç”¨è¯´æ˜"></a>1.2 é˜²ç«å¢™ç§ç±»åŠä½¿ç”¨è¯´æ˜</h2><p>ç¡¬ä»¶: æ•´ä¸ªä¼ä¸šå…¥å£</p>
<ul>
<li>ä¸‰å±‚è·¯ç”±: H3C åä¸º Cisco(æ€ç§‘)</li>
<li>é˜²ç«å¢™: æ·±ä¿¡æœ,ç»¿ç›Ÿ,å¥‡å®‰ä¿¡â€¦..</li>
</ul>
<p>è½¯ä»¶: å¼€æºè½¯ä»¶ ç½‘ç«™å†…éƒ¨ å°ip å°ip</p>
<ul>
<li>iptables å†™å…¥åˆ°Linuxå†…æ ¸ä¸­,ä»¥åæœåŠ¡docker å·¥ä½œåœ¨ 4å±‚(å¤§éƒ¨åˆ†)</li>
<li>firewalld C7</li>
<li>nftalbes C8</li>
<li>ufw (ubuntu firewall) Ubuntu</li>
</ul>
<p>äº‘é˜²ç«å¢™(å…¬æœ‰äº‘)</p>
<ul>
<li>é˜¿é‡Œäº‘:<ul>
<li>å®‰å…¨ç»„ (å°ip,å°ç«¯å£)</li>
<li>NATç½‘å…³(å…±äº«ä¸Šç½‘,ç«¯å£æ˜ å°„â€¦.)</li>
<li>wafåº”ç”¨é˜²ç«å¢™</li>
</ul>
</li>
<li>wafé˜²ç«å¢™(åº”ç”¨é˜²ç«å¢™,å¤„ç†7å±‚çš„æ”»å‡») SQLæ³¨å…¥,ç­‰æ”»å‡».<ul>
<li>ä¹¦å†™è§„åˆ™(æè¿°æ”»å‡»è¿‡ç¨‹,å…³é”®æç¤º,å…³é”®æ“ä½œ.)</li>
</ul>
</li>
</ul>
<blockquote>
<p>ä¼ä¸šé€‰å‹å»ºè®®:  </p>
<p>ä¸­å°ä¼ä¸š: ä½¿ç”¨å…¬æœ‰äº‘,å®‰å…¨ç»„,wafé˜²ç«å¢™,æ€åŠ¿æ„ŸçŸ¥ </p>
<p>è®¿é—®é‡å·¨å¤§: ä½¿ç”¨ç¡¬ä»¶é˜²ç«å¢™,wafé˜²ç«å¢™,ç¡¬ä»¶æœåŠ¡å™¨+äº‘æœåŠ¡å™¨  </p>
</blockquote>
<h2 id="1-3-å¿…é¡»ç†Ÿæ‚‰çš„åè¯"><a href="#1-3-å¿…é¡»ç†Ÿæ‚‰çš„åè¯" class="headerlink" title="1.3 å¿…é¡»ç†Ÿæ‚‰çš„åè¯"></a>1.3 å¿…é¡»ç†Ÿæ‚‰çš„åè¯</h2><p>å®¹å™¨ï¼šå¦‚ç“¶å­ã€ç½å­ï¼Œå­˜æ”¾ä¸œè¥¿</p>
<p>è¡¨ï¼ˆtablesï¼‰ï¼šå­˜æ”¾é“¾çš„å®¹å™¨ï¼Œé˜²ç«å¢™æœ€å¤§æ¦‚å¿µ</p>
<p>é“¾ï¼ˆchainï¼‰ï¼šå­˜æ”¾è§„åˆ™çš„å®¹å™¨</p>
<p>è§„åˆ™ï¼ˆpolicyï¼‰ï¼šå‡†è®¸æˆ–æ‹’ç»è§„åˆ™</p>
<table>
<thead>
<tr>
<th>Netfilter</th>
<th>è¡¨ï¼ˆtablesï¼‰</th>
<th>é“¾ï¼ˆchainsï¼‰</th>
<th>è§„åˆ™ï¼ˆPolicyï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸€æ ‹æ¥¼</td>
<td>æ¥¼é‡Œçš„æˆ¿å­</td>
<td>æˆ¿å­é‡Œçš„æŸœå­</td>
<td>æŸœå­é‡Œè¡£æœï¼Œæ‘†æ”¾è§„åˆ™</td>
</tr>
</tbody></table>
<h2 id="1-4-iptablesçš„æ‰§è¡Œè¿‡ç¨‹ï¼ˆé‡è¦ï¼‰"><a href="#1-4-iptablesçš„æ‰§è¡Œè¿‡ç¨‹ï¼ˆé‡è¦ï¼‰" class="headerlink" title="1.4 iptablesçš„æ‰§è¡Œè¿‡ç¨‹ï¼ˆé‡è¦ï¼‰"></a>1.4 iptablesçš„æ‰§è¡Œè¿‡ç¨‹ï¼ˆé‡è¦ï¼‰</h2><p>å·¥ä½œæµç¨‹ï¼š</p>
<ol>
<li>é˜²ç«å¢™æ˜¯å±‚å±‚è¿‡æ»¤çš„ï¼Œå®é™…æ˜¯æŒ‰ç…§é…ç½®è§„åˆ™çš„é¡ºåº<strong>ä»ä¸Šåˆ°ä¸‹ï¼Œä»å‰åˆ°å</strong>è¿›è¡Œè¿‡æ»¤çš„ã€‚</li>
<li>å¦‚æœåŒ¹é…æˆåŠŸè§„åˆ™ï¼Œå³æ˜ç¡®è¡¨ç¤ºæ˜¯æ‹’ç»(DROP)è¿˜æ˜¯æ¥æ”¶(ACCEPT)ï¼Œæ•°æ®åŒ…å°±ä¸å†å‘ä¸‹åŒ¹é…æ–°çš„è§„åˆ™ã€‚</li>
<li>å¦‚æœè§„åˆ™ä¸­æ²¡æœ‰æ˜ç¡®è¡¨æ˜æ˜¯é˜»æ­¢è¿˜æ˜¯é€šè¿‡çš„ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰åŒ¹é…è§„åˆ™ï¼Œå‘ä¸‹è¿›è¡ŒåŒ¹é…ï¼Œç›´åˆ°åŒ¹é…é»˜è®¤è§„åˆ™å¾—åˆ°æ˜ç¡®çš„é˜»æ­¢è¿˜æ˜¯é€šè¿‡ã€‚</li>
<li>é˜²ç«å¢™çš„é»˜è®¤è§„åˆ™æ˜¯æ‰€æœ‰è§„åˆ™éƒ½åŒ¹é…å®Œæ‰ä¼šåŒ¹é…çš„ã€‚</li>
</ol>
<h2 id="1-5-è¡¨ä¸é“¾"><a href="#1-5-è¡¨ä¸é“¾" class="headerlink" title="1.5 è¡¨ä¸é“¾"></a>1.5 è¡¨ä¸é“¾</h2><h3 id="1-5-1-æ¦‚è¿°"><a href="#1-5-1-æ¦‚è¿°" class="headerlink" title="1.5.1 æ¦‚è¿°"></a>1.5.1 æ¦‚è¿°</h3><p>è¡¨(table)æ˜¯å¯¹åŠŸèƒ½çš„åˆ†ç±»ï¼Œå¦‚ï¼š</p>
<ul>
<li>é˜²ç«å¢™åŠŸèƒ½(filterè¡¨)</li>
<li>å…±äº«ä¸Šç½‘,ç«¯å£è½¬å‘(natè¡¨)</li>
</ul>
<p>é“¾å¯¹æ•°æ®æµè¿›è¡Œå¤„ç†,éœ€è¦ä½¿ç”¨ä¸åŒçš„é“¾ï¼Œå¦‚ï¼š</p>
<ul>
<li>æ•°æ®æµå…¥(INPUT)</li>
<li>æ•°æ®æµå‡º(OUTPUT)</li>
</ul>
<p>iptables æ˜¯<strong>4è¡¨5é“¾</strong></p>
<ul>
<li>4è¡¨: filterè¡¨ natè¡¨ rawè¡¨ mangleè¡¨</li>
<li>5é“¾: INPUT OUTPUT FORWARD PREROUTING POSTROUTING</li>
</ul>
<p>é“¾çš„ç†è§£ï¼Œä»¥ä¸»æœºè‡ªèº«ä¸ºå‡†ï¼Œå¦‚ï¼š</p>
<ul>
<li>INPUTï¼Œå°±æ˜¯ç¦æ­¢åˆ«çš„ä¸»æœºæ•°æ®åŒ…è¿›å…¥æˆ‘</li>
<li>OUTPUTï¼Œç¦æ­¢æˆ‘çš„æ•°æ®åŒ…å‡ºå»</li>
</ul>
<h3 id="1-5-2-æ¯ä¸ªè¡¨çš„è¯´æ˜"><a href="#1-5-2-æ¯ä¸ªè¡¨çš„è¯´æ˜" class="headerlink" title="1.5 2 æ¯ä¸ªè¡¨çš„è¯´æ˜"></a>1.5 2 æ¯ä¸ªè¡¨çš„è¯´æ˜</h3><p><strong>1ï¼‰filterè¡¨</strong></p>
<blockquote>
<p>ä¼ä¸šå·¥ä½œåœºæ™¯ï¼šä¸»æœºé˜²ç«å¢™</p>
</blockquote>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>æ˜¯iptablesé»˜è®¤çš„è¡¨ï¼Œç”¨äºè¿‡æ»¤</li>
<li>å®ç°é˜²ç«å¢™åŠŸèƒ½ï¼šï¼ˆå¯¹æ•°æ®åŒ…filterè¿‡æ»¤ï¼‰å±è”½æˆ–å‡†è®¸ç«¯å£æˆ–IP</li>
</ul>
<p>è¿™ä¸ªè¡¨å®šä¹‰äº†ä¸‰ä¸ªé“¾ï¼ˆchainsï¼‰ </p>
<table>
<thead>
<tr>
<th>filterè¡¨</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>INPUT</td>
<td>è´Ÿè´£è¿‡æ»¤æ‰€æœ‰ç›®æ ‡åœ°å€æ˜¯æœ¬æœºåœ°å€çš„æ•°æ®åŒ… é€šä¿—æ¥è¯´ï¼šå°±æ˜¯è¿‡æ»¤è¿›å…¥ä¸»æœºçš„æ•°æ®åŒ… (èƒ½å¦è®©æ•°æ®åŒ…è¿›å…¥æœåŠ¡å™¨)</td>
</tr>
<tr>
<td>FORWARD</td>
<td>è·¯è¿‡: è´Ÿè´£è½¬å‘æµç»ä¸»æœºçš„æ•°æ®åŒ…ã€‚èµ·è½¬å‘çš„ä½œç”¨ï¼Œå’ŒNATå…³ç³»å¾ˆå¤§ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç» LVS NATæ¨¡å¼ï¼Œ net.ipv4.ip_forward&#x3D;0</td>
</tr>
<tr>
<td>OUTPUT</td>
<td>å¤„ç†æ‰€æœ‰æºåœ°å€æ˜¯æœ¬æœºåœ°å€çš„æ•°æ®åŒ… é€šä¿—çš„è®²ï¼šå°±æ˜¯å¤„ç†ä»ä¸»æœºå‘å‡ºå»çš„æ•°æ®åŒ…</td>
</tr>
</tbody></table>
<p><strong>2ï¼‰natè¡¨</strong></p>
<blockquote>
<p>ä¼ä¸šå·¥ä½œåœºæ™¯ï¼š </p>
<ol>
<li>ç”¨äºä¼ä¸šè·¯ç”±ï¼ˆzebraï¼‰æˆ–ç½‘å…³ï¼ˆiptablesï¼‰ï¼Œå…±äº«ä¸Šç½‘ï¼ˆPOSTROUTINGï¼‰ </li>
<li>åšå†…éƒ¨å¤–éƒ¨IPåœ°å€ä¸€å¯¹ä¸€æ˜ å°„ï¼ˆdmzï¼‰ï¼Œç¡¬ä»¶é˜²ç«å¢™æ˜ å°„IPåˆ°å†…éƒ¨æœåŠ¡å™¨ï¼ŒftpæœåŠ¡ï¼ˆPREROUTINGï¼‰ </li>
<li>WEBï¼Œå•ä¸ªç«¯å£çš„æ˜ å°„ï¼Œç›´æ¥æ˜ å°„80ç«¯å£ï¼ˆPREROUTINGï¼‰</li>
</ol>
</blockquote>
<p>ä½œç”¨ï¼š</p>
<ul>
<li><p>å®ç°å…±äº«ä¸Šç½‘çš„åŠŸèƒ½ï¼ˆå†…ç½‘æœåŠ¡å™¨ä¸Šå¤–ç½‘ï¼‰</p>
</li>
<li><p>ç«¯å£æ˜ å°„ã€IPæ˜ å°„</p>
</li>
</ul>
<p>è¿™ä¸ªè¡¨å®šä¹‰äº†3ä¸ªé“¾ï¼ŒnatåŠŸèƒ½ç›¸å½“äºç½‘ç»œçš„aclæ§ åˆ¶ã€‚å’Œç½‘ç»œäº¤æ¢æœºaclç±»ä¼¼</p>
<table>
<thead>
<tr>
<th>natè¡¨</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>OUTPUT</td>
<td>å’Œä¸»æœºæ”¾å‡ºå»çš„æ•°æ®åŒ…æœ‰å…³ï¼Œæ”¹å˜ä¸»æœºå‘å‡ºæ•°æ®åŒ…çš„ç›®çš„åœ°å€ã€‚</td>
</tr>
<tr>
<td>PREROUTING</td>
<td>åœ¨æ•°æ®åŒ…åˆ°è¾¾é˜²ç«å¢™æ—¶ï¼Œè¿›è¡Œè·¯ç”±åˆ¤æ–­ä¹‹å‰æ‰§è¡Œçš„è§„åˆ™ï¼Œä½œç”¨æ˜¯æ”¹å˜æ•°æ®åŒ…çš„ç›®çš„åœ°å€ã€ç›®çš„ç«¯å£ç­‰ å°±æ˜¯æ”¶ä¿¡æ—¶ï¼Œæ ¹æ®è§„åˆ™é‡å†™æ”¶ä»¶äººçš„åœ°å€ã€‚ ä¾‹å¦‚ï¼šæŠŠå…¬ç½‘IPï¼šxxx.xxx.xxx.xxxæ˜ å°„åˆ°å±€åŸŸç½‘çš„xx.xx.xx.xxæœåŠ¡å™¨ä¸Šã€‚ å¦‚æœæ˜¯webæœåŠ¡ï¼Œå¯ä»¥æŠ¥80è½¬æ¢ä¸ºå±€åŸŸç½‘çš„æœåŠ¡å™¨9000ç«¯å£ä¸Š 10.0.0.61 8080(ç›®æ ‡ç«¯å£) â€”-natè½¬æ¢10.0.0.7 22</td>
</tr>
<tr>
<td>POSTROUTING</td>
<td>åœ¨æ•°æ®åŒ…ç¦»å¼€é˜²ç«å¢™æ—¶è¿›è¡Œè·¯ç”±åˆ¤æ–­ä¹‹åæ‰§è¡Œçš„è§„åˆ™ï¼Œä½œç”¨æ”¹å˜æ•°æ®åŒ…çš„æºåœ°å€ï¼Œæºç«¯å£ç­‰ã€‚ å†™å¥½å‘ä»¶äººçš„åœ°å€ï¼Œè¦è®©å®¶äººå›ä¿¡æ—¶èƒ½å¤Ÿæœ‰åœ°å€å¯å›ã€‚ ä¾‹å¦‚ã€‚é»˜è®¤ç¬”è®°æœ¬å’Œè™šæ‹Ÿæœºéƒ½æ˜¯å±€åŸŸç½‘åœ°å€ï¼Œåœ¨å‡ºç½‘çš„æ—¶å€™è¢«è·¯ç”±å™¨å°†æºåœ°å€æ”¹ä¸ºäº†å…¬ç½‘åœ°å€ã€‚ ç”Ÿäº§åº”ç”¨ï¼šå±€åŸŸç½‘å…±äº«ä¸Šç½‘ã€‚</td>
</tr>
</tbody></table>
<p><strong>3ï¼‰rawè¡¨</strong></p>
<p>ä¸»è¦ç”¨æ¥å†³å®šæ˜¯å¦å¯¹æ•°æ®åŒ…è¿›è¡ŒçŠ¶æ€è·Ÿè¸ªã€‚</p>
<p>å¯¹åº”çš„å†…æ ¸æ¨¡å—ä¸ºï¼š<code>iptable_raw</code>ï¼Œå…¶è¡¨å†…åŒ…æ‹¬ä¸¤ä¸ªé“¾ï¼š<code>output</code>ã€<code>prerouting</code>;</p>
<p><strong>4ï¼‰mangleè¡¨</strong></p>
<p>ä¸»è¦ç”¨æ¥ä¿®æ”¹æ•°æ®åŒ…çš„æœåŠ¡ç±»å‹ï¼Œç”Ÿå­˜å‘¨æœŸï¼Œä¸ºæ•°æ®åŒ…è®¾ç½®æ ‡è®°ï¼Œå®ç°æµé‡æ•´å½¢ã€ç­–ç•¥</p>
<p>è·¯ç”±ç­‰ï¼Œå¯¹åº”çš„å†…æ ¸æ¨¡å—ä¸ºï¼š<code>iptable_mangle</code>ï¼Œ</p>
<p>å…¶è¡¨å†…åŒ…æ‹¬äº”ä¸ªé“¾ï¼š<code>prerouting</code>ã€<code>postrouting</code>ã€<code>input</code>ã€<code>output</code>ã€<code>forward</code>;</p>
<h3 id="1-5-3-æµç¨‹å›¾"><a href="#1-5-3-æµç¨‹å›¾" class="headerlink" title="1.5.3 æµç¨‹å›¾"></a>1.5.3 æµç¨‹å›¾</h3><p><img src="/../../../img/image-20240523093136580.png" srcset="/img/loading.gif" lazyload alt="image-20240523093136580"></p>
<h2 id="1-6-iptablesçš„å‘½ä»¤å‚æ•°"><a href="#1-6-iptablesçš„å‘½ä»¤å‚æ•°" class="headerlink" title="1.6 iptablesçš„å‘½ä»¤å‚æ•°"></a>1.6 iptablesçš„å‘½ä»¤å‚æ•°</h2><table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>-L</td>
<td>æ˜¾ç¤ºè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™</td>
</tr>
<tr>
<td>-n</td>
<td>ä¸è¦æŠŠç«¯å£æˆ–ipåå‘è§£æä¸ºåå­—</td>
</tr>
<tr>
<td>æŒ‡å®šè¡¨</td>
<td></td>
</tr>
<tr>
<td>-t</td>
<td>æŒ‡å®šè¡¨,ä¸æŒ‡å®šé»˜è®¤æ˜¯filterè¡¨</td>
</tr>
<tr>
<td>æŒ‡å®šè¿æ¥(åŠ å…¥&#x2F;è¿½åŠ &#x2F;åˆ é™¤)</td>
<td></td>
</tr>
<tr>
<td>-A</td>
<td>append è¿½åŠ æŠŠè§„åˆ™å†™å…¥åˆ°é“¾çš„æœ«å°¾.åŠ å…¥å‡†è®¸ç±»è§„åˆ™ ä½¿ç”¨-A</td>
</tr>
<tr>
<td>-I</td>
<td>insert æŠŠè§„åˆ™åŠ åœ¨é“¾çš„ç¬¬1æ¡ æ‹’ç»ç±»è§„åˆ™æ”¾åœ¨æ‰€æœ‰è§„åˆ™æœ€ä¸Šé¢ æ‹’ç»ç±» -I</td>
</tr>
<tr>
<td>-D</td>
<td>delete åˆ é™¤ -D INPUT 1</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>-p</td>
<td>æŒ‡å®šåè®® protocal tcp&#x2F;udp&#x2F;icmp&#x2F;all</td>
</tr>
<tr>
<td>â€“dport</td>
<td>ç›®æ ‡ç«¯å£ dest destination âš  æŒ‡å®šç«¯å£çš„æ—¶å€™åŠ ä¸Šåè®® -p tcp</td>
</tr>
<tr>
<td>â€“sport</td>
<td>æºç«¯å£ source æº</td>
</tr>
<tr>
<td>-s</td>
<td>â€“source æºip âš  å¦‚æœåªå±è”½&#x2F;å‡†è®¸ip,ç½‘æ®µ,ä¸ç”¨åŠ ä¸Šåè®®.</td>
</tr>
<tr>
<td>-d</td>
<td>â€“destination ç›®æ ‡ip</td>
</tr>
<tr>
<td>-m</td>
<td>æŒ‡å®šæ¨¡å— multiport</td>
</tr>
<tr>
<td>-i</td>
<td>input è¾“å…¥çš„æ—¶å€™ ä»å“ªä¸ªç½‘å¡è¿›æ¥</td>
</tr>
<tr>
<td>-o</td>
<td>ouput è¾“å‡ºçš„æ—¶å€™ ä»å“ªä¸ªç½‘å¡å‡ºå»</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>-j</td>
<td>æ»¡è¶³æ¡ä»¶åçš„åŠ¨ä½œ : DROP(æ‹’ç»)&#x2F;ACCEPT(å‡†è®¸)&#x2F;REJECT(æ‹’ç»)</td>
</tr>
<tr>
<td>DROP REJECTæ‹’ç» DROP æŠŠæ•°æ®ä¸¢æ‰ ä¸ä¼šè¿”å›ä¿¡æ¯ç»™ç”¨æˆ· REJECT æ‹’ç» è¿”å›æ‹’ç»ä¿¡æ¯</td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>-F flush</td>
<td>æ¸…é™¤æŒ‡å®šè¡¨ä¸­æ‰€æœ‰çš„è§„åˆ™,å¤‡ä»½.</td>
</tr>
<tr>
<td>-X</td>
<td>åˆ é™¤ç”¨æˆ·è‡ªå®šä¹‰çš„é“¾</td>
</tr>
<tr>
<td>-Z zero</td>
<td>é“¾çš„è®¡æ•°å™¨æ¸…é›¶ï¼ˆæ•°æ®åŒ…è®¡æ•°å™¨ä¸æ•°æ®åŒ…å­—èŠ‚è®¡æ•°å™¨ï¼‰ iptables</td>
</tr>
<tr>
<td>-v</td>
<td>æ˜¾ç¤ºæ•°æ®åŒ…,æ•°æ®é‡</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>iptableså‘½ä»¤åŠé€‰é¡¹</th>
<th>æŒ‡å®šè¡¨</th>
<th>æŒ‡å®šé“¾ (æ’å…¥&#x2F;è¿½åŠ &#x2F;åˆ é™¤)</th>
<th>ip</th>
<th>å…·ä½“è¦æ±‚ (ç«¯å£,ip,åè®®)</th>
<th>ç«¯å£</th>
<th>åŠ¨ä½œ</th>
</tr>
</thead>
<tbody><tr>
<td>iptables</td>
<td>-t filter</td>
<td>-A INPUT</td>
<td>-s</td>
<td>-p tcp&#x2F;udp&#x2F;icmp</td>
<td>â€“dport ç›®æ ‡ç«¯å£</td>
<td>-j DROP</td>
</tr>
<tr>
<td></td>
<td></td>
<td>-I</td>
<td>-d</td>
<td></td>
<td>â€“sport æºç«¯å£</td>
<td>-j REJECT</td>
</tr>
<tr>
<td></td>
<td></td>
<td>-D</td>
<td></td>
<td></td>
<td></td>
<td>-j ACCEPT</td>
</tr>
</tbody></table>
<h1 id="äºŒã€å®æ“"><a href="#äºŒã€å®æ“" class="headerlink" title="äºŒã€å®æ“"></a>äºŒã€å®æ“</h1><h2 id="2-1-ç¯å¢ƒå‡†å¤‡"><a href="#2-1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="2.1 ç¯å¢ƒå‡†å¤‡"></a>2.1 ç¯å¢ƒå‡†å¤‡</h2><p>1ï¼‰è™šæ‹Ÿæœºå‡†å¤‡</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">m01 10.0.0.61 172.16.1.61
web01 10.0.0.7 172.16.1.7
web02 10.0.0.8 172.16.1.8</code></pre></div></figure>

<p>2ï¼‰å®‰è£…</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@mn01[ ~]#yum install -y iptables-services</code></pre></div></figure>

<p>ä¸»è¦é…ç½®æ–‡ä»¶</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@mn01[ ~]#rpm -ql iptables-services
# é˜²ç«å¢™é…ç½®æ–‡ä»¶
&#x2F;etc&#x2F;sysconfig&#x2F;ip6tables
&#x2F;etc&#x2F;sysconfig&#x2F;iptables
# é˜²ç«å¢™æœåŠ¡çš„é…ç½®æ–‡ä»¶(systemctl)
&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;ip6tables.service
&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;iptables.service
...

[root@mn01[ ~]#rpm -ql iptables | grep iptables
...
&#x2F;usr&#x2F;sbin&#x2F;iptables	# iptableså‘½ä»¤
&#x2F;usr&#x2F;sbin&#x2F;iptables-restore	# æ¢å¤
&#x2F;usr&#x2F;sbin&#x2F;iptables-save	# iptablesè§„åˆ™ è¾“å‡ºï¼ˆä¿å­˜ï¼‰
...</code></pre></div></figure>

<p>3ï¼‰iptableæ¨¡å—åŠ è½½åˆ°å†…æ ¸ä¸­</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># å†™å…¥æ–‡ä»¶ï¼Œç”¨ä¹…ç”Ÿæ•ˆï¼Œå¦‚åªæƒ³ä¸´æ—¶ç”Ÿæ•ˆï¼Œæ‰§è¡Œmodprobeå‘½ä»¤å³å¯
cat &gt;&gt;&#x2F;etc&#x2F;rc.local&lt;&lt;EOF
modprobe ip_tables
modprobe iptable_filter
modprobe iptable_nat
modprobe ip_conntrack
modprobe ip_conntrack_ftp
modprobe ip_nat_ftp
modprobe ipt_state
EOF

# sourceç”Ÿæ•ˆ 
[root@mn01[ ~]#source &#x2F;etc&#x2F;rc.local </code></pre></div></figure>

<p>æŸ¥çœ‹å†…æ ¸æ¨¡å—ï¼Œæ˜¯å¦ç”Ÿæ•ˆ</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@mn01[ ~]#lsmod | egrep &#39;filter|nat|ipt&#39;
nf_nat_ftp             12809  0 
nf_conntrack_ftp       18478  1 nf_nat_ftp
iptable_nat            12875  0 
nf_nat_ipv4            14115  1 iptable_nat
nf_nat                 26583  2 nf_nat_ftp,nf_nat_ipv4
ipt_REJECT             12541  2 
nf_reject_ipv4         13373  1 ipt_REJECT
nf_conntrack          139264  7 nf_nat_ftp,nf_nat,xt_state,nf_nat_ipv4,xt_conntrack,nf_conntrack_ftp,nf_conntrack_ipv4
iptable_filter         12810  1 
ip_tables              27126  2 iptable_filter,iptable_nat
libcrc32c              12644  3 xfs,nf_nat,nf_conntrack</code></pre></div></figure>

<p>4ï¼‰å¯åŠ¨æœåŠ¡</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># å…ˆåœæ­¢firewalldæœåŠ¡
[root@mn01[ ~]#systemctl stop firewalld
[root@mn01[ ~]#systemctl disable firewalld

# å†å¯åŠ¨iptables
[root@mn01[ ~]#systemctl enable iptables
Created symlink from &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;basic.target.wants&#x2F;iptables.service to &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;iptables.service.
[root@mn01[ ~]#systemctl start iptables</code></pre></div></figure>

<p>5ï¼‰æŸ¥çœ‹è¡¨ä¸­çš„è§„åˆ™ï¼Œé»˜è®¤æŸ¥çœ‹filterè¡¨</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@mn01[ ~]#iptables -nL
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     all  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0            state RELATED,ESTABLISHED
ACCEPT     icmp --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0           
ACCEPT     all  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0           
ACCEPT     tcp  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0            state NEW tcp dpt:22
REJECT     all  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0            reject-with icmp-host-prohibited

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         
REJECT     all  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0            reject-with icmp-host-prohibited

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         </code></pre></div></figure>

<p>æŸ¥çœ‹æŒ‡å®šè¡¨ä¸­çš„è§„åˆ™</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@mn01[ ~]#iptables -t nat -nL
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination         

Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination       </code></pre></div></figure>

<p><img src="/../../../img/image-20240523095135715.png" srcset="/img/loading.gif" lazyload alt="image-20240523095135715"></p>
<h2 id="2-2-é…ç½®filterè¡¨è§„åˆ™"><a href="#2-2-é…ç½®filterè¡¨è§„åˆ™" class="headerlink" title="2.2 é…ç½®filterè¡¨è§„åˆ™"></a>2.2 é…ç½®filterè¡¨è§„åˆ™</h2><h3 id="2-2-1-å¤‡ä»½å¹¶æ¸…ç©º"><a href="#2-2-1-å¤‡ä»½å¹¶æ¸…ç©º" class="headerlink" title="2.2.1 å¤‡ä»½å¹¶æ¸…ç©º"></a>2.2.1 å¤‡ä»½å¹¶æ¸…ç©º</h3><p>æ­£å¼é…ç½®ä¹‹å‰ï¼Œå…ˆå¤‡ä»½ï¼Œæ¸…ç©ºè§„åˆ™</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@mn01[ ~]#iptables -F	# Flushæ¸…ç©º
[root@mn01[ ~]#iptables -X	# åˆ é™¤ç”¨æˆ·è‡ªå®šä¹‰çš„é“¾
[root@mn01[ ~]#iptables -Z	# é“¾çš„è®¡æ•°é‡ç½®ä¸º0

# ç¡®ä¿æ¸…ç©º
[root@mn01[ ~]#iptables -nL
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination    </code></pre></div></figure>

<h3 id="2-2-2-ç¦æ­¢è®¿é—®22ç«¯å£"><a href="#2-2-2-ç¦æ­¢è®¿é—®22ç«¯å£" class="headerlink" title="2.2.2 ç¦æ­¢è®¿é—®22ç«¯å£"></a>2.2.2 ç¦æ­¢è®¿é—®22ç«¯å£</h3><p>é…ç½®ï¼š</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@mn01[ ~]#iptables -t  filter -A INPUT -p tcp --dport 22 -j DROP
# é…ç½®åsshé“¾æ¥ä¼šæ–­å¼€

# æŸ¥çœ‹è§„åˆ™

# åˆ é™¤è§„åˆ™</code></pre></div></figure>

<p>è™šæ‹Ÿæœºä¸ŠæŸ¥çœ‹è§„åˆ™</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># æ˜¾ç¤ºåºå·
iptables -t filter -nL --line-number</code></pre></div></figure>

<p><img src="/../../../img/image-20240523100757954.png" srcset="/img/loading.gif" lazyload alt="image-20240523100757954"></p>
<p>åˆ é™¤è§„åˆ™</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iptables -t filter -D INPUT 1 #æ ¹æ®åºå·åˆ é™¤</code></pre></div></figure>

<p><img src="/../../../img/image-20240523100936333.png" srcset="/img/loading.gif" lazyload alt="image-20240523100936333"></p>
<p>åˆ é™¤å®Œï¼Œåˆèƒ½é‡æ–°sshè®¿é—®</p>
<h3 id="2-2-3-ç¦æ­¢æŒ‡å®šIP"><a href="#2-2-3-ç¦æ­¢æŒ‡å®šIP" class="headerlink" title="2.2.3 ç¦æ­¢æŒ‡å®šIP"></a>2.2.3 ç¦æ­¢æŒ‡å®šIP</h3><p>é…ç½®</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@mn01[ ~]#iptables -I INPUT -s 10.0.0.7 -j DROP
[root@mn01[ ~]#iptables -I INPUT -s 172.16.1.7 -j DROP

# æŸ¥çœ‹
[root@mn01[ ~]#iptables -nL --line-number
Chain INPUT (policy ACCEPT)
num  target     prot opt source               destination         
1    DROP       all  --  172.16.1.7           0.0.0.0&#x2F;0           
2    DROP       all  --  10.0.0.7             0.0.0.0&#x2F;0           
3               all  --  10.0.0.7             0.0.0.0&#x2F;0           

Chain FORWARD (policy ACCEPT)
num  target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
num  target     prot opt source               destination     </code></pre></div></figure>

<p>å°ç¦åpingä¸é€šã€sshä¹Ÿä¸é€š</p>
<p><img src="/../../../img/image-20240523101321910.png" srcset="/img/loading.gif" lazyload alt="image-20240523101321910"></p>
<h3 id="2-2-4-ç¦æ­¢æŒ‡å®šç½‘æ®µ"><a href="#2-2-4-ç¦æ­¢æŒ‡å®šç½‘æ®µ" class="headerlink" title="2.2.4 ç¦æ­¢æŒ‡å®šç½‘æ®µ"></a>2.2.4 ç¦æ­¢æŒ‡å®šç½‘æ®µ</h3><p>é…ç½®ï¼Œç¦æ­¢10.0.0.0&#x2F;24ç½‘æ®µè®¿é—®8080ç«¯å£  </p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@mn01[ ~]#iptables -I INPUT -s 10.0.0.0&#x2F;24 -p tcp --dport 8080 -j DROP</code></pre></div></figure>

<blockquote>
<p>å‚æ•°ç†è§£ï¼š</p>
<p>-Iï¼šé…ç½®INPUTé“¾</p>
<p>-sï¼šæºç½‘æ®µï¼ˆå°ç¦ç½‘æ®µï¼‰</p>
<p>-pï¼šç«¯å£ç±»å‹</p>
<p>â€“dportï¼šç›®çš„ç«¯å£å·ï¼ˆæœ¬æœºï¼‰</p>
<p>-jï¼šç¦æ­¢è®¿é—®</p>
</blockquote>
<h3 id="2-2-5-åªå…è®¸æŒ‡å®šç½‘æ®µè¿å…¥"><a href="#2-2-5-åªå…è®¸æŒ‡å®šç½‘æ®µè¿å…¥" class="headerlink" title="2.2.5 åªå…è®¸æŒ‡å®šç½‘æ®µè¿å…¥"></a>2.2.5 åªå…è®¸æŒ‡å®šç½‘æ®µè¿å…¥</h3><p>å®ç°é˜¿é‡Œäº‘ç™½åå•åŠŸèƒ½ :é»˜è®¤æ˜¯æ‹’ç»ï¼Œå¼€æ”¾éƒ¨åˆ†ç«¯å£ã€ç½‘æ®µï¼Œå¦‚</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">allow 10.0.0.0&#x2F;24;
deny all;</code></pre></div></figure>

<p>é…ç½®æ–¹æ³•ä¸€ï¼Œåˆ©ç”¨<code>!</code>æ’é™¤</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iptables -I INPUT ! -s 172.16.1.0&#x2F;24 -j DROP
iptables -I INPUT ! -s 10.0.0.0&#x2F;24 -j DROP</code></pre></div></figure>

<p>é…ç½®æ–¹æ³•äºŒï¼šä¿®æ”¹é“¾çš„é»˜è®¤è§„åˆ™ï¼Œé»˜è®¤æ‹’ç»ï¼Œå†æ·»åŠ å…è®¸</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">#ä¿®æ”¹é»˜è®¤è§„åˆ™
iptables -P INPUT DROP

# å†å…è®¸
iptables -t filter -I INPUT -s 10.0.0.0&#x2F;24 -j ACCEPT</code></pre></div></figure>



<h3 id="2-2-6-æŒ‡å®šå¤šä¸ªç«¯å£"><a href="#2-2-6-æŒ‡å®šå¤šä¸ªç«¯å£" class="headerlink" title="2.2.6 æŒ‡å®šå¤šä¸ªç«¯å£"></a>2.2.6 æŒ‡å®šå¤šä¸ªç«¯å£</h3><p>å¦‚æœéœ€è¦å°ç¦å¤šä¸ªç«¯å£ï¼Œä¸€ä¸ªä¸ªæ¥æ¯”è¾ƒéº»çƒ¦</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># æ•ˆç‡ä½
iptables -I INPUT -p tcp --dport 8888 -j DROP
iptables -I INPUT -p tcp --dport 9999 -j DROP</code></pre></div></figure>

<p>å¯ä»¥é€šè¿‡é€‰é¡¹ï¼Œä¸€æ¬¡æŒ‡å®šå¤šä¸ªç«¯å£</p>
<p><code>-m multiport -p tcp --dport 80,443  </code></p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iptables -A INPUT -m multiport -p tcp --dport 80,443 -j ACCEP</code></pre></div></figure>

<p>å¦‚æœç«¯å£æ˜¯è¿ç»­çš„ï¼Œå¯ä»¥ä¸åŠ <code>-m multiport</code>é€‰é¡¹</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iptables -I INPUT -p tcp --dport 1024:65535 -j DROP</code></pre></div></figure>



<h3 id="2-2-7-åŒ¹é…ICMPç±»å‹"><a href="#2-2-7-åŒ¹é…ICMPç±»å‹" class="headerlink" title="2.2.7 åŒ¹é…ICMPç±»å‹"></a>2.2.7 åŒ¹é…ICMPç±»å‹</h3><p>é€šè¿‡é˜²ç«å¢™è§„åˆ™ï¼Œæ§åˆ¶æ˜¯å¦å¯ä»¥pingé€š</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># ç²¾ç¡®å†™æ³•
iptables -I INPUT -p icmp --icmp-type 8 -j DROP

# ç®€å•å†™æ³•
iptables -I INPUT -p icmp -j DROP</code></pre></div></figure>

<blockquote>
<p>æ‰©å±•ï¼š</p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹å†…æ ¸å‚æ•°ï¼Œæ¥æ§åˆ¶ping</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">&gt;[root@m01 ~]# cat &#x2F;etc&#x2F;sysctl.conf
&gt;#&#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;icmp_echo_ignore_all
&gt;#netç½‘ç»œ ipv4åè®® icmpåè®®å¿½ç•¥æ‰€æœ‰
&gt;net.ipv4.icmp_echo_ignore_all &#x3D; 1
&gt;#ç”Ÿæ•ˆ
&gt;sysctl -p</code></pre></div></figure>
</blockquote>
<h3 id="2-2-8-åŒ¹é…ç½‘ç»œçŠ¶æ€ï¼ˆTCP-IPè¿æ¥çŠ¶æ€ï¼‰"><a href="#2-2-8-åŒ¹é…ç½‘ç»œçŠ¶æ€ï¼ˆTCP-IPè¿æ¥çŠ¶æ€ï¼‰" class="headerlink" title="2.2.8 åŒ¹é…ç½‘ç»œçŠ¶æ€ï¼ˆTCP&#x2F;IPè¿æ¥çŠ¶æ€ï¼‰"></a>2.2.8 åŒ¹é…ç½‘ç»œçŠ¶æ€ï¼ˆTCP&#x2F;IPè¿æ¥çŠ¶æ€ï¼‰</h3><p><code>-m state --state</code> çŠ¶æ€å³å¯</p>
<ul>
<li>NEWï¼šå·²ç»æˆ–å°†å¯åŠ¨æ–°çš„è¿æ¥</li>
<li>ESTABLISHEDï¼šå·²å»ºç«‹çš„è¿æ¥</li>
<li>RELATEDï¼šæ­£åœ¨å¯åŠ¨çš„æ–°è¿æ¥</li>
<li>INVALIDï¼šéæ³•æˆ–æ— æ³•è¯†åˆ«çš„</li>
</ul>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@mn01[ ~]#iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
[root@mn01[ ~]#iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</code></pre></div></figure>



<h3 id="2-2-9-é™åˆ¶å¹¶å‘åŠé€Ÿç‡"><a href="#2-2-9-é™åˆ¶å¹¶å‘åŠé€Ÿç‡" class="headerlink" title="2.2.9 é™åˆ¶å¹¶å‘åŠé€Ÿç‡"></a>2.2.9 é™åˆ¶å¹¶å‘åŠé€Ÿç‡</h3><p><code>-m limit</code>é™åˆ¶æ¨¡å—</p>
<p><code>--limit</code>é€‰é¡¹ï¼š</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">#æ¯åˆ†é’Ÿåªèƒ½æœ‰10ä¸ªæ•°æ®åŒ…ï¼Œå³æ¯6ç§’ç”Ÿæˆä¸€ä¸ª
-m limit --limit 10&#x2F;minute 

# æŒ‡å®šæ—¶é—´å†…çš„è¯·æ±‚é€Ÿç‡â€nâ€ä¸ºé€Ÿç‡ï¼Œåé¢ä¸ºæ—¶é—´åˆ†åˆ«ä¸ºï¼šç§’ åˆ† æ—¶
-m limit --limit n&#x2F;&#123;second&#x2F;minute&#x2F;hour&#125;:</code></pre></div></figure>

<p><code>--limit-burst</code>é€‰é¡¹ï¼š</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># æ¯6ç§’é‡Šæ”¾å·¥ç‰Œ ç»™åˆ«äººä½¿ç”¨
# 10ä¸ªæ•°æ®åŒ…å‰5ä¸ª 1ç§’1ä¸ªå·¥ç‰Œ ä»ç¬¬6ä¸ªå¼€å§‹ æ¯6ç§’ æ‰èƒ½é‡Šæ”¾1ä¸ªå·¥ç‰Œ
-m limit --limit 10&#x2F;minute --limit-burst 5 </code></pre></div></figure>

<p>å®éªŒï¼š</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">#æ¸…ç©º
iptables -F

# æ‹’ç»æ‰€æœ‰
iptables -P INPUT DROP

# åªå…è®¸icmpï¼Œä½†æ˜¯é™åˆ¶é€Ÿç‡
iptables -I INPUT -p icmp -m limit --limit 10&#x2F;minute --limit-burst 5 -j ACCEPT</code></pre></div></figure>

<p>æµ‹è¯•ï¼šç”¨web01 ping</p>
<p><img src="/../../../img/image-20240523152333677.png" srcset="/img/loading.gif" lazyload alt="image-20240523152333677"></p>
<h3 id="2-2-10-é˜²ç«å¢™è§„åˆ™çš„ä¿å­˜ä¸æ¢å¤ï¼ˆé‡è¦ï¼‰"><a href="#2-2-10-é˜²ç«å¢™è§„åˆ™çš„ä¿å­˜ä¸æ¢å¤ï¼ˆé‡è¦ï¼‰" class="headerlink" title="2.2.10 é˜²ç«å¢™è§„åˆ™çš„ä¿å­˜ä¸æ¢å¤ï¼ˆé‡è¦ï¼‰"></a>2.2.10 é˜²ç«å¢™è§„åˆ™çš„ä¿å­˜ä¸æ¢å¤ï¼ˆé‡è¦ï¼‰</h3><p><code>iptables-save</code> è¿›è¡Œå¤‡ä»½,é»˜è®¤è¾“å‡ºåˆ°å±å¹•</p>
<p><code>iptables-restore</code> è¿›è¡Œæ¢å¤ï¼ŒåŠ ä¸Šæ–‡ä»¶</p>
<h4 id="2-2-10-1-ä¿å­˜"><a href="#2-2-10-1-ä¿å­˜" class="headerlink" title="2.2.10.1 ä¿å­˜"></a>2.2.10.1 ä¿å­˜</h4><p>æ¡ˆä¾‹ï¼šä¿å­˜é…ç½®åˆ°<code>/etc/sysconfig/iptables</code>  </p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># æŸ¥æŸ¥çœ‹ç°åœ¨çš„è§„åˆ™
[root@mn01[ ~]#iptables -nL
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     icmp --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0            limit: avg 10&#x2F;min burst 5

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

# ä¿å­˜
[root@mn01[ ~]#iptables-save &gt;&#x2F;etc&#x2F;sysconfig&#x2F;iptables

# ä¿å­˜åçš„æ–‡ä»¶
[root@mn01[ ~]#cat &#x2F;etc&#x2F;sysconfig&#x2F;iptables
# Generated by iptables-save v1.4.21 on Thu May 23 15:26:57 2024
*nat
:PREROUTING ACCEPT [46:3292]
:INPUT ACCEPT [17:1184]
:OUTPUT ACCEPT [121:7862]
:POSTROUTING ACCEPT [121:7862]
COMMIT
# Completed on Thu May 23 15:26:57 2024
# Generated by iptables-save v1.4.21 on Thu May 23 15:26:57 2024
*filter
:INPUT ACCEPT [113:6572]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [59:5420]
-A INPUT -p icmp -m limit --limit 10&#x2F;min -j ACCEPT
COMMIT
# Completed on Thu May 23 15:26:57 2024</code></pre></div></figure>

<h4 id="2-2-10-2-æ¢å¤"><a href="#2-2-10-2-æ¢å¤" class="headerlink" title="2.2.10.2 æ¢å¤"></a>2.2.10.2 æ¢å¤</h4><p>å…ˆåˆ é™¤æœ‰çš„è§„åˆ™</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@mn01[ ~]#iptables -D INPUT 1
[root@mn01[ ~]#iptables -nL
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination        </code></pre></div></figure>

<p>å†æ¢å¤</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@mn01[ ~]#iptables-restore &lt;&#x2F;etc&#x2F;sysconfig&#x2F;iptables
# å·²å¤åŸ
[root@mn01[ ~]#iptables -nL
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     icmp --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0            limit: avg 10&#x2F;min burst 5

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         </code></pre></div></figure>

<blockquote>
<p>è¡¥å……ï¼š</p>
<p>é‡å¯iptablesæœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ¢å¤é…ç½®</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">&gt;# ä¼šè‡ªåŠ¨è¯»å–&#x2F;etc&#x2F;sysconfig&#x2F;iptableså†…å®¹
&gt;systemctl restart iptables </code></pre></div></figure>
</blockquote>
<h3 id="2-2-11-filterè¡¨çš„å®é™…ç”Ÿäº§ç”¨æ³•"><a href="#2-2-11-filterè¡¨çš„å®é™…ç”Ÿäº§ç”¨æ³•" class="headerlink" title="2.2.11 filterè¡¨çš„å®é™…ç”Ÿäº§ç”¨æ³•"></a>2.2.11 filterè¡¨çš„å®é™…ç”Ÿäº§ç”¨æ³•</h3><p>iptablesé…ç½®æ–¹å¼</p>
<ul>
<li>é€›å…¬å›­æ¨¡å¼: é»˜è®¤è§„åˆ™æ˜¯ ACCEPTï¼ˆé»‘åå•æ¨¡å¼ï¼‰</li>
<li>çœ‹ç”µå½±æ¨¡å¼: é»˜è®¤è§„åˆ™æ˜¯ DROP ï¼ˆç™½åå•æ¨¡å¼ï¼‰</li>
</ul>
<p>ç”Ÿäº§ä¸­å»ºè®®é‡‡ç”¨<code>çœ‹ç”µå½±æ¨¡å¼</code>ï¼Œåœ¨è®¾ç½®ä»¥ä¸‹ç™½åå•</p>
<p>1ã€sshå¯ä»¥è¿æ¥è¿›æ¥</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># æ¸…ç©º
iptables -F
iptables -X
iptables -Z

# é…ç½®
iptables -A INPUT -p tcp ÕÊ”dport 22 -j ACCEPT</code></pre></div></figure>

<p>2ã€å…è®¸æœ¬æœºå›ç¯loæ¥å£æ•°æ®æµé‡æµå‡ºä¸æµå…¥  </p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># -i æ•°æ®è¿›å…¥çš„æ—¶å€™
iptables -A INPUT -i lo -j ACCEPT
# -o æ•°æ®æµå‡ºçš„æ—¶å€™
iptables -A OUTPUT -o lo -j ACCEPT</code></pre></div></figure>

<p>3ã€é…ç½®é»˜è®¤è§„åˆ™ï¼Œæ”¾è¡Œ80ã€443ç«¯å£</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iptables -A INPUT -m multiport -p tcp --dport 443,80 -j ACCEPT</code></pre></div></figure>

<p>4ã€å…è®¸ç½‘æ®µè®¿é—®</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iptables -A INPUT -s 10.0.0.0&#x2F;24 -j ACCEPT
iptables -A INPUT -s 172.16.1.0&#x2F;24 -j ACCEPT</code></pre></div></figure>

<p>5ã€ä¿å­˜é…ç½®</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iptables-save</code></pre></div></figure>

<h2 id="2-3-é…ç½®NATè¡¨è§„åˆ™"><a href="#2-3-é…ç½®NATè¡¨è§„åˆ™" class="headerlink" title="2.3 é…ç½®NATè¡¨è§„åˆ™"></a>2.3 é…ç½®NATè¡¨è§„åˆ™</h2><h3 id="2-3-1-å®ç°å…±äº«ä¸Šç½‘ğŸŒŸ"><a href="#2-3-1-å®ç°å…±äº«ä¸Šç½‘ğŸŒŸ" class="headerlink" title="2.3.1 å®ç°å…±äº«ä¸Šç½‘ğŸŒŸ"></a>2.3.1 å®ç°å…±äº«ä¸Šç½‘ğŸŒŸ</h3><h4 id="1ï¼‰åŸç†"><a href="#1ï¼‰åŸç†" class="headerlink" title="1ï¼‰åŸç†"></a>1ï¼‰åŸç†</h4><p>172.16.1.7å†…ç½‘æœåŠ¡å™¨ï¼Œé€šè¿‡iptableså®ç°å…±äº«ä¸Šç½‘</p>
<p><img src="/../../../img/image-20240523155941222.png" srcset="/img/loading.gif" lazyload alt="image-20240523155941222"></p>
<p>ç›¸å…³å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iptables -t nat -A POSTROUTING -s 172.16.1.7 -j SNAT --to-source 10.0.0.61

# 1. æŒ‡å®šnatè¡¨,é…ç½®POSTROUTINGé“¾
# 2. æºipæ˜¯172.16.1.7è¿™å°ä¸»æœºè¿›è¡Œå…±äº«ä¸Šç½‘,å¦‚æœæ˜¯å¤šå°(-s 172.16.1.0&#x2F;24)
# 3. æŒ‡å®šä½¿ç”¨SNATåŠŸèƒ½,æºåœ°å€è½¬æ¢
# 4. é€šè¿‡SNATåŠŸèƒ½æŠŠæ•°æ®åŒ…ä¸­çš„æºipåœ°å€æ”¹ä¸ºé˜²ç«å¢™å…¬ç½‘çš„ipåœ°å€.(10.0.0.61)</code></pre></div></figure>

<blockquote>
<p>æ¸©é¦¨æç¤ºï¼š</p>
<p>å¦‚æœå…¬ç½‘ipä¸å›ºå®š, -j SNAT â€“to-source 10.0.0.61 å¯ä»¥å†™ä¸º -j MASQUERADE ä¼ªè£…æˆå…¬ç½‘ip  </p>
</blockquote>
<h4 id="2ï¼‰ç¯å¢ƒå‡†å¤‡"><a href="#2ï¼‰ç¯å¢ƒå‡†å¤‡" class="headerlink" title="2ï¼‰ç¯å¢ƒå‡†å¤‡"></a>2ï¼‰ç¯å¢ƒå‡†å¤‡</h4><p>å…³é—­web01çš„å…¬ç½‘ç½‘å¡ï¼ˆ10.0.0.7ï¼‰ï¼Œåªä¿ç•™å†…ç½‘172ç½‘æ®µçš„IP</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@web01[ ~]#ifconfig ens33 down</code></pre></div></figure>



<h4 id="3ï¼‰é…ç½®NATå…±äº«ä¸Šç½‘"><a href="#3ï¼‰é…ç½®NATå…±äº«ä¸Šç½‘" class="headerlink" title="3ï¼‰é…ç½®NATå…±äº«ä¸Šç½‘"></a>3ï¼‰é…ç½®NATå…±äº«ä¸Šç½‘</h4><p>å‘½ä»¤</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># é…ç½®iptables
iptables -t nat -A POSTROUTING -s 172.16.1.0&#x2F;24 -j SNAT --to-source 10.0.0.61

# -- å¦‚å…¬ç½‘IPä¸å›ºå®šï¼Œæ”¹ç”¨è¿™æ¡
iptables -t nat -A POSTROUTING -s 172.16.1.0&#x2F;24 -j MASQUERADE

# å¼€å¯å†…æ ¸è½¬å‘ğŸŒŸğŸŒŸ
echo &#39;net.ipv4.ip_forward &#x3D; 1&#39; &gt;&gt; &#x2F;etc&#x2F;sysctl.conf
# ç”Ÿæ•ˆ
sysctl -p</code></pre></div></figure>



<h4 id="4ï¼‰web01æœåŠ¡å™¨è®¾ç½®ç½‘å…³"><a href="#4ï¼‰web01æœåŠ¡å™¨è®¾ç½®ç½‘å…³" class="headerlink" title="4ï¼‰web01æœåŠ¡å™¨è®¾ç½®ç½‘å…³"></a>4ï¼‰web01æœåŠ¡å™¨è®¾ç½®ç½‘å…³</h4><p>å°†ç½‘å…³æŒ‡å‘172.16.1.61ï¼Œå¹¶è®¾ç½®DNS</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[root@web01[ ~]#cat &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens36 
NMAE&#x3D;ens36
DEVICE&#x3D;ens36
IPADDR&#x3D;172.16.1.7
PREFIX&#x3D;24
ONBOOT&#x3D;yes
BOOPROTO&#x3D;static
GATEWAY&#x3D;172.16.1.61	# ç½‘å…³
DNS1&#x3D;223.5.5.5	# DNS</code></pre></div></figure>



<h4 id="5ï¼‰æµ‹è¯•"><a href="#5ï¼‰æµ‹è¯•" class="headerlink" title="5ï¼‰æµ‹è¯•"></a>5ï¼‰æµ‹è¯•</h4><p>pingç™¾åº¦ï¼Œè™½ç„¶æ— 10ç½‘æ®µIPï¼Œä½†ä»ç„¶å¯ä»¥é€š</p>
<p><img src="/../../../img/image-20240523161946286.png" srcset="/img/loading.gif" lazyload alt="image-20240523161946286"></p>
<h3 id="2-3-2-å®ç°ç«¯å£è½¬å‘ğŸŒŸ"><a href="#2-3-2-å®ç°ç«¯å£è½¬å‘ğŸŒŸ" class="headerlink" title="2.3.2 å®ç°ç«¯å£è½¬å‘ğŸŒŸ"></a>2.3.2 å®ç°ç«¯å£è½¬å‘ğŸŒŸ</h3><p>ç«¯å£è½¬å‘å¸¸ç”¨äºè§£å†³ç”¨æˆ·è¿›æ¥çš„é—®é¢˜ï¼Œå¦‚ï¼šå¤–éƒ¨çš„ç”¨æˆ·è®¿é—®å†…ç½‘çš„æŸä¸ªæœåŠ¡å™¨ï¼Œç«¯å£â€¦</p>
<p>vmwareä¹Ÿèƒ½è®¾ç½®ç«¯å£æ˜ å°„ï¼Œæ¯”å¦‚æˆ‘æƒ³åœ¨çœŸå®æœºï¼Œé€šè¿‡<a href="http://127.0.0.1:9000è®¿é—®åˆ°http://10.0.0.7:80ï¼Œå¯ä»¥æŒ‰å›¾ç¤ºè®¾ç½®ç«¯å£æ˜ å°„">http://127.0.0.1:9000è®¿é—®åˆ°http://10.0.0.7:80ï¼Œå¯ä»¥æŒ‰å›¾ç¤ºè®¾ç½®ç«¯å£æ˜ å°„</a></p>
<p><img src="/../../../img/image-20240523163857176.png" srcset="/img/loading.gif" lazyload alt="image-20240523163857176"></p>
<h4 id="1ï¼‰åŸç†-1"><a href="#1ï¼‰åŸç†-1" class="headerlink" title="1ï¼‰åŸç†"></a>1ï¼‰åŸç†</h4><p><img src="/../../../img/image-20240523163311287.png" srcset="/img/loading.gif" lazyload alt="image-20240523163311287"></p>
<h4 id="2ï¼‰é…ç½®"><a href="#2ï¼‰é…ç½®" class="headerlink" title="2ï¼‰é…ç½®"></a>2ï¼‰é…ç½®</h4><p>ä½œç”¨ï¼šè®¿é—®10.0.0.61:9000ï¼Œç›¸å½“äºè®¿é—®172.16.1.7:22</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># é…ç½®sysctl.conf
ç•¥è¿‡

# å¼€å¯ç³»ç»Ÿnatæ¨¡å—ï¼ˆé‡è¦ï¼ï¼ï¼‰
iptables -t nat -A POSTROUTING -j MASQUERADE

# é…ç½®ç«¯å£è½¬å‘
iptables -t nat -A PREROUTING -d 10.0.0.61 -p tcp --dport 388 -j DNAT --to-destination 172.16.1.7:22

# æŸ¥çœ‹
[root@mn01[ ~]#iptables -t nat -nL
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination         
DNAT       tcp  --  0.0.0.0&#x2F;0            10.0.0.61            tcp dpt:388 to:172.16.1.7:22

Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination         
MASQUERADE  all  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0      </code></pre></div></figure>



<h4 id="3ï¼‰æµ‹è¯•"><a href="#3ï¼‰æµ‹è¯•" class="headerlink" title="3ï¼‰æµ‹è¯•"></a>3ï¼‰æµ‹è¯•</h4><p>åœ¨xshellæœ¬åœ°æ¨¡å¼ä¸­</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[d:\~]$ ssh root@10.0.0.61 388

# ç™»å½•è¿›å»æ˜¯web01</code></pre></div></figure>

<p><img src="/../../../img/image-20240523173000068.png" srcset="/img/loading.gif" lazyload alt="image-20240523173000068"></p>
<blockquote>
<p>è®°å½•ï¼š</p>
<p>é¦–å…ˆæµ‹è¯•å¤±è´¥ï¼Œå› ä¸ºæ²¡æœ‰â€œå¼€å¯ç³»ç»Ÿnatæ¨¡å—â€çš„å‘½ä»¤</p>
</blockquote>
<h3 id="2-3-3-å®ç°IPæ˜ å°„"><a href="#2-3-3-å®ç°IPæ˜ å°„" class="headerlink" title="2.3.3 å®ç°IPæ˜ å°„"></a>2.3.3 å®ç°IPæ˜ å°„</h3><h4 id="1ï¼‰é…ç½®"><a href="#1ï¼‰é…ç½®" class="headerlink" title="1ï¼‰é…ç½®"></a>1ï¼‰é…ç½®</h4><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iptables -t nat -A PREROUTING -d 10.0.0.61 -j DNAT --to-destination 172.16.1.7

# æŸ¥çœ‹
[root@mn01[ ~]#iptables -t nat -nL
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination         
DNAT       tcp  --  0.0.0.0&#x2F;0            10.0.0.61            tcp dpt:388 to:172.16.1.7:22
DNAT       all  --  0.0.0.0&#x2F;0            10.0.0.61            to:172.16.1.7

Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination         
MASQUERADE  all  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0           </code></pre></div></figure>

<p>æµ‹è¯•</p>
<p>sshè®¿é—®10.0.0.61:22ï¼Œç™»å½•åˆ°äº†web01ï¼Œè¯´æ˜IPè½¬å‘æˆåŠŸ</p>
<p><img src="/../../../img/image-20240523173536525.png" srcset="/img/loading.gif" lazyload alt="image-20240523173536525"></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E8%BF%90%E7%BB%B4/" class="category-chain-item">è¿ç»´</a>
  
  
    <span>></span>
    
  <a href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%BA%8C%EF%BC%89%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/" class="category-chain-item">ï¼ˆäºŒï¼‰ç»¼åˆæ¶æ„</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>day59-è‡ªåŠ¨åŒ–æ¶æ„-iptablesé˜²ç«å¢™</div>
      <div>http://gsproj.github.io/2024/05/23/07_85æœŸè¿ç»´/03_è‡ªåŠ¨åŒ–æ¶æ„/day58-è‡ªåŠ¨åŒ–æ¶æ„-iptablesé˜²ç«å¢™/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>GongSheng</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2024å¹´5æœˆ23æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/05/24/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day59-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-1/" title="day59-å®¹å™¨æ¶æ„-Dockerï¼ˆä¸€ï¼‰">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">day59-å®¹å™¨æ¶æ„-Dockerï¼ˆä¸€ï¼‰</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/05/22/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day57-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84-shell%E8%87%AA%E5%8A%A8%E5%8C%96%E7%BC%96%E7%A8%8B-6/" title="day57-è‡ªåŠ¨åŒ–æ¶æ„-shellè‡ªåŠ¨åŒ–ç¼–ç¨‹ï¼ˆå…­ï¼‰-å®Œç»“">
                        <span class="hidden-mobile">day57-è‡ªåŠ¨åŒ–æ¶æ„-shellè‡ªåŠ¨åŒ–ç¼–ç¨‹ï¼ˆå…­ï¼‰-å®Œç»“</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script  src="https://lib.baomitu.com/prism/1.29.0/components/prism-core.min.js" ></script>

  <script  src="https://lib.baomitu.com/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js" ></script>

  <script  src="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js" ></script>

  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
