<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>day60-容器架构-Docker（二） | Haris的小站</title><meta name="author" content="Haris"><meta name="copyright" content="Haris"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="容器架构-Docker-02今日内容：  Docker容器管理  一、Docker容器管理🌟🌟运行起来的镜像可以称为容器，1个容器相当于是1个进程。  以docker container开头的指令一般表示容器管理指令，部分指令container可以省略   1234# 完整写法docker container ps# 缩略写法docker ps  1.1 容器管理的操作1.1.1 查看容器12">
<meta property="og:type" content="article">
<meta property="og:title" content="day60-容器架构-Docker（二）">
<meta property="og:url" content="http://gsproj.github.io/2024/05/24/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day60-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-2/index.html">
<meta property="og:site_name" content="Haris的小站">
<meta property="og:description" content="容器架构-Docker-02今日内容：  Docker容器管理  一、Docker容器管理🌟🌟运行起来的镜像可以称为容器，1个容器相当于是1个进程。  以docker container开头的指令一般表示容器管理指令，部分指令container可以省略   1234# 完整写法docker container ps# 缩略写法docker ps  1.1 容器管理的操作1.1.1 查看容器12">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://gsproj.github.io/img/%E5%A4%B4%E5%83%8F.png">
<meta property="article:published_time" content="2024-05-24T05:08:52.000Z">
<meta property="article:modified_time" content="2024-08-02T01:48:34.361Z">
<meta property="article:author" content="Haris">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://gsproj.github.io/img/%E5%A4%B4%E5%83%8F.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "day60-容器架构-Docker（二）",
  "url": "http://gsproj.github.io/2024/05/24/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day60-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-2/",
  "image": "http://gsproj.github.io/img/%E5%A4%B4%E5%83%8F.png",
  "datePublished": "2024-05-24T05:08:52.000Z",
  "dateModified": "2024-08-02T01:48:34.361Z",
  "author": [
    {
      "@type": "Person",
      "name": "Haris",
      "url": "http://gsproj.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://gsproj.github.io/2024/05/24/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day60-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'day60-容器架构-Docker（二）',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/modify.css"><style>#article-container.post-content h1:before, h2:before, h3:before, h4:before, h5:before, h6:before { -webkit-animation: avatar_turn_around 1s linear infinite; -moz-animation: avatar_turn_around 1s linear infinite; -o-animation: avatar_turn_around 1s linear infinite; -ms-animation: avatar_turn_around 1s linear infinite; animation: avatar_turn_around 1s linear infinite; }</style><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/css/loading-bar.css"><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/img/猫.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">211</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/car2.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Haris的小站</span></a><a class="nav-page-title" href="/"><span class="site-name">day60-容器架构-Docker（二）</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">day60-容器架构-Docker（二）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-05-24T05:08:52.000Z" title="发表于 2024-05-24 13:08:52">2024-05-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-02T01:48:34.361Z" title="更新于 2024-08-02 09:48:34">2024-08-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%BA%8C%EF%BC%89%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/">（二）综合架构</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="top-img" style="background-image: url(/img/car2.png);"></div><article class="container post-content" id="article-container"><h1 id="容器架构-Docker-02"><a href="#容器架构-Docker-02" class="headerlink" title="容器架构-Docker-02"></a>容器架构-Docker-02</h1><p>今日内容：</p>
<ul>
<li>Docker容器管理</li>
</ul>
<h1 id="一、Docker容器管理🌟🌟"><a href="#一、Docker容器管理🌟🌟" class="headerlink" title="一、Docker容器管理🌟🌟"></a>一、Docker容器管理🌟🌟</h1><p>运行起来的镜像可以称为容器，1个容器相当于是1个进程。 </p>
<p>以<code>docker container</code>开头的指令一般表示容器管理指令，部分指令container可以省略  </p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">完整写法</span></span><br><span class="line">docker container ps</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">缩略写法</span></span><br><span class="line">docker ps</span><br></pre></td></tr></tbody></table></figure>

<h2 id="1-1-容器管理的操作"><a href="#1-1-容器管理的操作" class="headerlink" title="1.1 容器管理的操作"></a>1.1 容器管理的操作</h2><h3 id="1-1-1-查看容器"><a href="#1-1-1-查看容器" class="headerlink" title="1.1.1 查看容器"></a>1.1.1 查看容器</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01[ ~]#docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED       STATUS       PORTS                               NAMES</span><br><span class="line">50715f7f85a3   nginx     "/docker-entrypoint.…"   4 hours ago   Up 4 hours   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   bold_bartik</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">完整写法</span></span><br><span class="line">[root@docker01[ ~]#docker container ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED       STATUS       PORTS                               NAMES</span><br><span class="line">50715f7f85a3   nginx     "/docker-entrypoint.…"   4 hours ago   Up 4 hours   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   bold_bartik</span><br></pre></td></tr></tbody></table></figure>

<p>案例：查看当前运行中的容器，查看下80端口是否被占用</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01[ ~]#docker ps -a	</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED       STATUS       PORTS                               NAMES</span><br><span class="line">50715f7f85a3   nginx     "/docker-entrypoint.…"   5 hours ago   Up 5 hours   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   bold_bartik</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可见80端口已被占用</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="1-1-2-创建-运行容器"><a href="#1-1-2-创建-运行容器" class="headerlink" title="1.1.2 创建/运行容器"></a>1.1.2 创建/运行容器</h3><p>创建容器（一般直接用run）</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker create 创建容器 --name</span><br></pre></td></tr></tbody></table></figure>

<p>运行容器</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -it -p 80:80 nginx:latest</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>选项说明：</p>
<ul>
<li>-d 容器后台运行.</li>
<li>-p 端口映射,外部或其他服务器想要访问容器内部的某个服务的端口. </li>
<li>-p 外部用于访问的端口:容器内部服务的端口</li>
<li>–name 指定容器的名字  </li>
<li>-i 以交互式模式运行容器，通常与<code>-t</code>一起</li>
<li>-i 为程序重新分配一个伪输入终端，通常与<code>-i</code>一起</li>
</ul>
<p>docker run 的背后做了很多事情：</p>
<ul>
<li>docker create 创建容器.</li>
<li>docker start 启动容器.</li>
<li>docker stop 关闭容器. #向容器中的主进程,pid 1 进程发出信号(kill),关闭.</li>
<li>docker restart重启重启</li>
</ul>
</blockquote>
<p><strong>案例01</strong>：创建一个nginx-alpine的容器并运行</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建</span></span><br><span class="line">[root@docker01[ ~]#docker run -d -p 80:80 --name test_nginx_alpine_v1 nginx:stable-alpine </span><br><span class="line">cd4d36318002007a8354146d376e85d1a711ddfdfeb24d1a393258347844f0fa</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看</span></span><br><span class="line">[root@docker01[ ~]#docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED          STATUS          PORTS                               NAMES</span><br><span class="line">cd4d36318002   nginx:stable-alpine   "/docker-entrypoint.…"   31 seconds ago   Up 31 seconds   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   test_nginx_alpine_v1</span><br></pre></td></tr></tbody></table></figure>

<p><strong>案例02</strong>：创建centos容器，并交互运行，进入容器内部</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">run 创建并运行centos容器</span></span><br><span class="line">[root@docker01[ ~]#docker run -it --name "my_docker_centos" centos</span><br><span class="line">Unable to find image 'centos:latest' locally</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">a1d0c7532777: Pull complete </span><br><span class="line">Digest: sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177</span><br><span class="line">Status: Downloaded newer image for centos:latest</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">因为-it选项的使用，已经进入容器内部，查看系统版本</span></span><br><span class="line">[root@631cf5e874ba /]# cat /etc/system-release</span><br><span class="line">CentOS Linux release 8.4.2105</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>注意事项：</p>
<p>以<code>-it</code>运行的容器，如果退出了会怎么样？</p>
<ul>
<li>容器退出后，直接关闭</li>
</ul>
<p><strong>这也是<code>-it</code>的缺点！</strong></p>
</blockquote>
<h3 id="1-1-3-启动-停止容器"><a href="#1-1-3-启动-停止容器" class="headerlink" title="1.1.3 启动/停止容器"></a>1.1.3 启动/停止容器</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动容器</span></span><br><span class="line">docker start</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止容器</span></span><br><span class="line">docker stop </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启容器</span></span><br><span class="line">docker restart </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">强制停止容器</span></span><br><span class="line">docker kill </span><br></pre></td></tr></tbody></table></figure>

<p>案例：以上方法均在容器上用一遍</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01[ ~]#docker stop cd4d36318002</span><br><span class="line">cd4d36318002</span><br><span class="line">[root@docker01[ ~]#docker restart cd4d36318002</span><br><span class="line">cd4d36318002</span><br><span class="line">[root@docker01[ ~]#docker start cd4d36318002</span><br><span class="line">cd4d36318002</span><br><span class="line">[root@docker01[ ~]#docker kill -s 9 cd4d36318002</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-s表示信号 -s 9 等于 <span class="built_in">kill</span> -9 pid强制结束</span></span><br><span class="line">cd4d36318002</span><br><span class="line">[root@docker01[ ~]#docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED              STATUS                        PORTS     NAMES</span><br><span class="line">cd4d36318002   nginx:stable-alpine   "/docker-entrypoint.…"   About a minute ago   Exited (137) 11 seconds ago             test_nginx_alpine_v1</span><br></pre></td></tr></tbody></table></figure>



<h3 id="1-1-4-删除容器"><a href="#1-1-4-删除容器" class="headerlink" title="1.1.4 删除容器"></a>1.1.4 删除容器</h3><p>单个删除</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm</span><br></pre></td></tr></tbody></table></figure>

<p>批量删除</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f `docker ps -a -q`</span><br></pre></td></tr></tbody></table></figure>

<p>案例：删除已有的容器</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">找到一个容器</span></span><br><span class="line">[root@docker01[ ~]#docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED       STATUS       PORTS                               NAMES</span><br><span class="line">50715f7f85a3   nginx     "/docker-entrypoint.…"   5 hours ago   Up 5 hours   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   bold_bartik</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除，不成功，因为容器正在运行</span></span><br><span class="line">[root@docker01[ ~]#docker  rm 50715f7f85a3</span><br><span class="line">Error response from daemon: cannot remove container "/bold_bartik": container is running: stop the container before removing or force remove</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-f强制删除</span></span><br><span class="line">[root@docker01[ ~]#docker  rm -f 50715f7f85a3</span><br></pre></td></tr></tbody></table></figure>

<h3 id="1-1-5-进入正在运行的容器"><a href="#1-1-5-进入正在运行的容器" class="headerlink" title="1.1.5 进入正在运行的容器"></a>1.1.5 进入正在运行的容器</h3><p>方法一<code>exec</code>：将分配一个新的终端</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it 容器id/容器名字 /bin/bash(/bin/sh)</span><br></pre></td></tr></tbody></table></figure>

<p>方法二<code>attach</code>：使用相同的终端</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker attach</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">暂时退出：ctrl + p, ctrl + q</span></span><br></pre></td></tr></tbody></table></figure>

<p>案例：exec进入已经运行的容器</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看已有容器</span></span><br><span class="line">[root@docker01[ ~]#docker ps</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED          STATUS          PORTS                               NAMES</span><br><span class="line">5251e5df489e   nginx:stable-alpine   "/docker-entrypoint.…"   19 minutes ago   Up 19 minutes   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   test_nginx_alpine_v1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器</span></span><br><span class="line">[root@docker01[ ~]#docker exec -it test_nginx_alpine_v1 /bin/sh</span><br><span class="line">/ # ls</span><br><span class="line">bin                   etc                   mnt                   run                   tmp</span><br><span class="line">dev                   home                  opt                   sbin                  usr</span><br><span class="line">docker-entrypoint.d   lib                   proc                  srv                   var</span><br><span class="line">docker-entrypoint.sh  media                 root                  sys</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改nginx首页内容</span></span><br><span class="line">/ # cd /usr/share/nginx/html</span><br><span class="line">/usr/share/nginx/html # echo "New Page" &gt; /usr/share/nginx/html/index.html </span><br></pre></td></tr></tbody></table></figure>

<p>测试访问</p>
<p><img src="/../../../img/image-20240524154601603.png" alt="image-20240524154601603"></p>
<h4 id="exec和attach的区别"><a href="#exec和attach的区别" class="headerlink" title="exec和attach的区别"></a>exec和attach的区别</h4><table>
<thead>
<tr>
<th>docker container 指令</th>
<th>exec</th>
<th>attach</th>
</tr>
</thead>
<tbody><tr>
<td>共同点</td>
<td>连接到容器</td>
<td>连接到容器</td>
</tr>
<tr>
<td>区别</td>
<td>连接的时候创建终端</td>
<td>容器要有终端(容器进程中要有个/bin/bash 或/bin/sh) 只能连接到已有的终端中.</td>
</tr>
<tr>
<td>区别</td>
<td>不同的exec连接互不影响,</td>
<td>共用,所有连接都一样</td>
</tr>
</tbody></table>
<h3 id="1-1-6-查看容器信息与状态"><a href="#1-1-6-查看容器信息与状态" class="headerlink" title="1.1.6 查看容器信息与状态"></a>1.1.6 查看容器信息与状态</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker inspect</span><br><span class="line">docker stats</span><br><span class="line">docker top</span><br></pre></td></tr></tbody></table></figure>



<h3 id="1-1-7-容器夯住才能一直运行🌟"><a href="#1-1-7-容器夯住才能一直运行🌟" class="headerlink" title="1.1.7 容器夯住才能一直运行🌟"></a>1.1.7 容器夯住才能一直运行🌟</h3><p>体会下面2个命令的区别：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name "oldboy_centos_v2" centos</span><br><span class="line">docker run -d --name "oldboy_centos_v2" centos sleep 20</span><br></pre></td></tr></tbody></table></figure>

<p>执行后，没加<code>sleep</code>的容器刚运行就消失了，加了<code>sleep</code>的容器维持了20秒</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01[ ~]#docker run -d --name "oldboy_centos_v2" centos</span><br><span class="line">fb8ba4d7a6c5dceffc6123953b2ad5235b0b13454ea7a4b0d072bf3fff0201d0</span><br><span class="line">[root@docker01[ ~]#docker ps	</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED          STATUS          PORTS                               NAMES</span><br><span class="line">5251e5df489e   nginx:stable-alpine   "/docker-entrypoint.…"   12 minutes ago   Up 12 minutes   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   test_nginx_alpine_v1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">centos容器不见了</span></span><br><span class="line"></span><br><span class="line">[root@docker01[ ~]#docker run -d --name "oldboy_centos_v3" centos sleep 20</span><br><span class="line">bed3239b9850cda3235c73eda64472b8e3bd233ac3a40ede82ddec3acd24d801</span><br><span class="line">[root@docker01[ ~]#docker run -ps</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED          STATUS          PORTS                               NAMES</span><br><span class="line">bed3239b9850   centos                "sleep 20"               2 seconds ago    Up 1 second                                         oldboy_centos_v3</span><br><span class="line">5251e5df489e   nginx:stable-alpine   "/docker-entrypoint.…"   12 minutes ago   Up 12 minutes   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   test_nginx_alpine_v1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">centos容器还在</span></span><br></pre></td></tr></tbody></table></figure>

<p>这是因为容器任务执行结束后，它也就自动退出了，因此 ，想要容器在后台（-d）一直运行，那么就要对容器运行的时候<strong>加上初始命令，使容器夯住</strong>(阻塞/前台运行)</p>
<p>例如：如何后台持续运行纯净系统的容器（Centos）</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过-itd选项来指定命令解释器持续运行</span></span><br><span class="line">[root@docker01[ ~]#docker run -itd --name oldboy_centos_v6 centos</span><br><span class="line">c4a59405f253ba62bfaa4f7431be2d21bbd8ca73ce174d27bb8b9f8475c0e872</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">容器还在</span></span><br><span class="line">[root@docker01[ ~]#docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED          STATUS                      PORTS                               NAMES</span><br><span class="line">c4a59405f253   centos                "/bin/bash"              13 seconds ago   Up 13 seconds                                                   oldboy_centos_v6</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器</span></span><br><span class="line">[root@docker01[ ~]#docker exec -it oldboy_centos_v6 /bin/bash</span><br><span class="line">[root@c4a59405f253 /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure>



<h3 id="1-1-8-容器传输文件"><a href="#1-1-8-容器传输文件" class="headerlink" title="1.1.8 容器传输文件"></a>1.1.8 容器传输文件</h3><p>怎么跟容器互相传输文件？使用<code>docker cp</code>命令</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th>源</th>
<th>目标</th>
</tr>
</thead>
<tbody><tr>
<td>宿主机–&gt;容器 上传</td>
<td>docker cp</td>
<td>路径或文件</td>
<td>容器:容器中目录</td>
</tr>
<tr>
<td>容器–&gt;宿主机 下载</td>
<td>docker cp</td>
<td>容器:容器中目录</td>
<td>路径或文件</td>
</tr>
</tbody></table>
<p>案例01：从容器下载文件</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝容器中的hosts文件下来</span></span><br><span class="line">[root@docker01[ ~]#docker cp oldboy_centos_v6:/etc/hosts ./docker_centos_hosts</span><br><span class="line">Successfully copied 2.05kB to /root/docker_centos_hosts</span><br></pre></td></tr></tbody></table></figure>

<p>案例02：上传文件到容器</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">百度首页，保存到物理机</span></span><br><span class="line">[root@docker01[ ~]#curl -o index.html www.baidu.com</span><br><span class="line"><span class="meta prompt_">  % </span><span class="language-bash">Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  2381  100  2381    0     0  31048      0 --:--:-- --:--:-- --:--:-- 30922</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">上传到nginx容器，替换首页</span></span><br><span class="line">[root@docker01[ ~]#docker cp index.html test_nginx_alpine_v1:/usr/share/nginx/html/index.html</span><br><span class="line">Successfully copied 4.1kB to test_nginx_alpine_v1:/usr/share/nginx/html/index.html</span><br></pre></td></tr></tbody></table></figure>



<h3 id="1-1-9-commit自定义镜像🌟"><a href="#1-1-9-commit自定义镜像🌟" class="headerlink" title="1.1.9 commit自定义镜像🌟"></a>1.1.9 commit自定义镜像🌟</h3><p>commit用于处理容器，生成镜像.  </p>
<p>使用流程:</p>
<ul>
<li>运行服务镜像或系统镜像,启动后成为容器.</li>
<li>根据我们的需求,对容器进行修改.</li>
<li>测试完成后.</li>
<li>最后通过commit命令把容器保存为镜像.</li>
<li>根据新生成的镜像创建容器并测试.</li>
</ul>
<p>案例：修改nginx容器，生成自定义镜像</p>
<ul>
<li>需求：<ul>
<li>基于ngx镜像创建容器</li>
<li>修改站点目录 /app/code/restart/ (default.conf)</li>
<li>上传代码,解压</li>
<li>测试</li>
<li>commit</li>
</ul>
</li>
</ul>
<p>1、创建容器</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01[ ~]#docker run -d -p 80:80 --name "commit_nginx" nginx:stable-alpine </span><br><span class="line">d7919255e43900e6ac3b556e1e27dff6ba3c4932fe354e27a62319a215cc20aa</span><br></pre></td></tr></tbody></table></figure>

<p>2、进入容器，修改配置文件，准备环境</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改配置文件</span></span><br><span class="line">/etc/nginx/conf.d # cat default.conf</span><br><span class="line">server {</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  restart.commit.cn;</span><br><span class="line">    root   /app/code/restart;</span><br><span class="line">    location / {</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建文件夹</span></span><br><span class="line">/ # mkdir -p /app/code/restart</span><br></pre></td></tr></tbody></table></figure>

<p>3、上传html代码</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01[ ~]#echo "RESTART PAGE" &gt; index.html </span><br><span class="line">[root@docker01[ ~]#docker cp index.html  commit_nginx:/app/code/restart</span><br><span class="line">Successfully copied 2.05kB to commit_nginx:/app/code/restart</span><br></pre></td></tr></tbody></table></figure>

<p>重启服务测试下</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01[ ~]#docker restart d7919255e439</span><br><span class="line">d7919255e439</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../../../img/image-20240524161534148.png" alt="image-20240524161534148"></p>
<p>4、根据容器生成镜像</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01[ ~]#docker commit commit_nginx nginx:stable-alpine_restart_v1</span><br><span class="line">sha256:21ca067362e8bf124ea914db502b69de62053cddcdae61699951abc34f8cf832</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看</span></span><br><span class="line">[root@docker01[ ~]#docker images</span><br><span class="line">REPOSITORY   TAG                        IMAGE ID       CREATED          SIZE</span><br><span class="line">nginx        stable-alpine_restart_v1   21ca067362e8   18 seconds ago   23.2MB</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<p>5、根据新的镜像，重新创建容器，端口81</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01[ ~]#docker run -d -p 81:80 nginx:stable-alpine_restart_v1 </span><br><span class="line">5477c2d5e0c9fab71a23b8bd6183277c2c4219fef8137ba761474909bbd34817</span><br></pre></td></tr></tbody></table></figure>

<p>测试访问<a target="_blank" rel="noopener" href="http://10.0.0.81:81/">http://10.0.0.81:81</a></p>
<p><img src="/../../../img/image-20240524161910037.png" alt="image-20240524161910037"></p>
<h3 id="1-1-10-容器导出导入"><a href="#1-1-10-容器导出导入" class="headerlink" title="1.1.10 容器导出导入"></a>1.1.10 容器导出导入</h3><p>导出容器成tar包</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看容器</span></span><br><span class="line">[root@docker01 ~]#docker ps</span><br><span class="line">CONTAINER ID   IMAGE              COMMAND                  CREATED         STATUS         PORTS                               NAMES</span><br><span class="line">e4ee1efb593c   tengine:birds-v1   "nginx -g 'daemon of…"   3 seconds ago   Up 2 seconds   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   birds_test</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">导出容器</span></span><br><span class="line">[root@docker01 ~]#docker export birds_test -o bird_test.tar</span><br></pre></td></tr></tbody></table></figure>

<p>将打包文件拷贝到另一台机器中，导入成镜像（有坑）</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝到docker02中</span></span><br><span class="line">[root@docker01 ~]#scp bird_test.tar 10.0.0.82:/tmp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker02虚拟机中没有任何镜像和容器</span></span><br><span class="line">[root@docker02 ~]#docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID   CREATED   SIZE</span><br><span class="line">[root@docker02 ~]#docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker02导入</span></span><br><span class="line">[root@docker02 ~]#docker import /tmp/bird_test.tar </span><br><span class="line">sha256:a823ac7e01d4c783ec8f00356662176c5c279b10999fe6f463a4476a9b16bb05</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">坑，导入后生成的镜像没有名字标签</span></span><br><span class="line">[root@docker02 ~]#docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">&lt;none&gt;       &lt;none&gt;    a823ac7e01d4   11 seconds ago   409MB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新添加仓库名和标签</span></span><br><span class="line">[root@docker02 ~]#docker tag a823ac7e01d4 tengine:birds-v1</span><br><span class="line">[root@docker02 ~]#docker images</span><br><span class="line">REPOSITORY   TAG        IMAGE ID       CREATED         SIZE</span><br><span class="line">tengine      birds-v1   a823ac7e01d4   3 minutes ago   409MB</span><br></pre></td></tr></tbody></table></figure>



<h1 id="二、端口映射"><a href="#二、端口映射" class="headerlink" title="二、端口映射"></a>二、端口映射</h1><p>容器的端口映射怎么实现的？</p>
<ul>
<li>使用<code>docker run -p</code>的时候，外界访问docker容器中的服务或端口，需要使用端口映射。</li>
<li>本质是通过iptables nat规则实现的，在nat表中创建了docker自定义的链</li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01[ ~]#iptables -t nat -nL</span><br><span class="line">Chain PREROUTING (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER     all  --  0.0.0.0/0            0.0.0.0/0            ADDRTYPE match dst-type LOCAL</span><br><span class="line"></span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER     all  --  0.0.0.0/0           !127.0.0.0/8          ADDRTYPE match dst-type LOCA</span><br><span class="line"></span><br><span class="line">Chain POSTROUTING (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">MASQUERADE  all  --  172.17.0.0/16        0.0.0.0/0           </span><br><span class="line">MASQUERADE  tcp  --  172.17.0.2           172.17.0.2           tcp dpt:80</span><br><span class="line">MASQUERADE  tcp  --  172.17.0.3           172.17.0.3           tcp dpt:80</span><br><span class="line"></span><br><span class="line">Chain DOCKER (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">RETURN     all  --  0.0.0.0/0            0.0.0.0/0           </span><br><span class="line">DNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:80 to:172.17.0.2:80</span><br><span class="line">DNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:81 to:172.17.0.3:80</span><br></pre></td></tr></tbody></table></figure>



<h2 id="2-1-背后具体做了什么？"><a href="#2-1-背后具体做了什么？" class="headerlink" title="2.1 背后具体做了什么？"></a>2.1 背后具体做了什么？</h2><ul>
<li>添加了对应防火墙规则</li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">类似于</span></span><br><span class="line">iptables -t nat -A DOCKER ! -i docker0 -p tcp -m tcp --dport 81 -j DNAT --todestination 10.0.0.81:80</span><br></pre></td></tr></tbody></table></figure>

<p>-<br>  开启内核转发功能(需要我们自己开启)  </p>
<p>查看端口信息：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01[ ~]#ss -lntup | grep 81</span><br><span class="line">tcp    LISTEN     0      128       *:81                    *:*                   users:(("docker-proxy",pid=26582,fd=4))</span><br><span class="line">tcp    LISTEN     0      128    [::]:81                 [::]:*                   users:(("docker-proxy",pid=26586,fd=4))</span><br></pre></td></tr></tbody></table></figure>



<h2 id="2-2-用户访问的时候经历了什么"><a href="#2-2-用户访问的时候经历了什么" class="headerlink" title="2.2 用户访问的时候经历了什么"></a>2.2 用户访问的时候经历了什么</h2><p>内部通过<code>虚拟网卡</code>来实现分配，如图</p>
<p><img src="/../../../img/image-20240524162640454.png" alt="image-20240524162640454"></p>
<h2 id="2-3-端口映射的案例"><a href="#2-3-端口映射的案例" class="headerlink" title="2.3 端口映射的案例"></a>2.3 端口映射的案例</h2><h3 id="2-3-1-一对一映射"><a href="#2-3-1-一对一映射" class="headerlink" title="2.3.1 一对一映射"></a>2.3.1 一对一映射</h3><p>还是使用<code>docker run -p</code></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name "oldboy_nginx_80" -p 80:80 nginx:1.20.2-alpine</span><br></pre></td></tr></tbody></table></figure>

<p>关于<code>-p</code>选项的详细描述</p>
<table>
<thead>
<tr>
<th>docker run</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>-p选项(小写字母P) 宿主机端口:容器中的端口</td>
<td>-p 80:80 -p 443:443</td>
</tr>
<tr>
<td>-p :容器中端口</td>
<td>-p :80 表示宿主机端口随机,很少用.</td>
</tr>
<tr>
<td>-p 端口范围:端口范围</td>
<td>80-88:80-88</td>
</tr>
</tbody></table>
<h3 id="2-3-2-多对多映射"><a href="#2-3-2-多对多映射" class="headerlink" title="2.3.2 多对多映射"></a>2.3.2 多对多映射</h3><p>映射8080,8081,8082 到容器中容器中也是8080,8081,8082  </p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-d一个个写</span></span><br><span class="line">[root@docker01[ ~]#dockedocker run -d -p 8080:8080 -p 8081:8081 -p 8082:8082 -p 86:80 nginx:stable-alpine</span><br><span class="line">43bcb519597f7a2f00ceea65fcb4664c5e52419d80c92c62dd5fbc1ccc2a0f5e</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看状态</span></span><br><span class="line">[root@docker01[ ~]#docker ps</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED         STATUS         PORTS                                                                                              NAMES</span><br><span class="line">43bcb519597f   nginx:stable-alpine   "/docker-entrypoint.…"   3 seconds ago   Up 2 seconds   0.0.0.0:8080-8082-&gt;8080-8082/tcp, :::8080-8082-&gt;8080-8082/tcp, 0.0.0.0:86-&gt;80/tcp, :::86-&gt;80/tcp   magical_margulis</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看port信息</span></span><br><span class="line">[root@docker01[ ~]#docker port magical_margulis</span><br><span class="line">80/tcp -&gt; 0.0.0.0:86</span><br><span class="line">80/tcp -&gt; [::]:86</span><br><span class="line">8080/tcp -&gt; 0.0.0.0:8080</span><br><span class="line">8080/tcp -&gt; [::]:8080</span><br><span class="line">8081/tcp -&gt; 0.0.0.0:8081</span><br><span class="line">8081/tcp -&gt; [::]:8081</span><br><span class="line">8082/tcp -&gt; 0.0.0.0:8082</span><br><span class="line">8082/tcp -&gt; [::]:8082	# 容器中的端口 -&gt; 宿主机端口</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-3-3-IP绑定端口"><a href="#2-3-3-IP绑定端口" class="headerlink" title="2.3.3 IP绑定端口"></a>2.3.3 IP绑定端口</h3><p>用户只能通过宿主机的某个网卡连接这个端口，起安全防护作用</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">只能用172.16.1.8:12306来访问容器的80端口</span></span><br><span class="line">[root@docker01[ ~]#docker run -d -p 172.16.1.81:12306:80 nginx:stable-alpine</span><br><span class="line">44d0e51e63f65650e0faadd705fb33c944409591b30a4d4731fa1c3643200f75</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看</span></span><br><span class="line">[root@docker01[ ~]#docker ps</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED          STATUS          PORTS                       NAMES</span><br><span class="line">44d0e51e63f6   nginx:stable-alpine   "/docker-entrypoint.…"   44 seconds ago   Up 43 seconds   172.16.1.81:12306-&gt;80/tcp   nice_mendel</span><br></pre></td></tr></tbody></table></figure>



<h1 id="三、数据卷挂载"><a href="#三、数据卷挂载" class="headerlink" title="三、数据卷挂载"></a>三、数据卷挂载</h1><h2 id="3-1-为什么需要挂载数据"><a href="#3-1-为什么需要挂载数据" class="headerlink" title="3.1 为什么需要挂载数据"></a>3.1 为什么需要挂载数据</h2><p>数据放容器里，要是不小心<code>rm -f</code>删了怎么办？</p>
<p>为了解决这个数据持久化的问题，需要让数据永久<strong>保存在宿主机</strong>中，通过挂载的方式挂</p>
<p>到容器上</p>
<p><img src="/../../../img/image-20240524164011370.png" alt="image-20240524164011370"></p>
<h2 id="3-2-选项补充"><a href="#3-2-选项补充" class="headerlink" title="3.2 选项补充"></a>3.2 选项补充</h2><h3 id="3-2-1-docker-run选项补充"><a href="#3-2-1-docker-run选项补充" class="headerlink" title="3.2.1 docker run选项补充"></a>3.2.1 docker run选项补充</h3><p><code>--rm</code>选项</p>
<ul>
<li>容器退出的时候，容器自动删除</li>
<li>一般用于测试，临时使用容器</li>
</ul>
<p><code>--restart</code>选项，容器的重启策略</p>
<ul>
<li>always 自动重启</li>
<li>unless-stopped 只在容器关闭，停止的时候</li>
<li>on-failure 只在失败的时候重启</li>
<li>默认，不自动重启</li>
</ul>
<h3 id="3-2-2-docker-exec选项补充"><a href="#3-2-2-docker-exec选项补充" class="headerlink" title="3.2.2 docker exec选项补充"></a>3.2.2 docker exec选项补充</h3><p>在进入Mysql或者redis等数据库时候，可以直接exec进入数据库操作终端，而不是/bin/bash，方法如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">对Mysql</span></span><br><span class="line">docker exec -it 容器 mysql -u root -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">对redis</span></span><br><span class="line">docker exec -it 容器 redis-cli</span><br></pre></td></tr></tbody></table></figure>

<h2 id="3-3-挂载项目"><a href="#3-3-挂载项目" class="headerlink" title="3.3 挂载项目"></a>3.3 挂载项目</h2><p>将站点文件/站点目录、配置文件目录、日志目录以<code>-v</code>的方式挂载</p>
<h3 id="3-3-1-挂载单个站点文件"><a href="#3-3-1-挂载单个站点文件" class="headerlink" title="3.3.1 挂载单个站点文件"></a>3.3.1 挂载单个站点文件</h3><p>使用数据卷挂载index.html到容器中的/usr/share/nginx/html/index.html  </p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建本地文件</span></span><br><span class="line">mkdir -p /app/docker/test/code</span><br><span class="line">echo "&lt;h1&gt;THIS IS MOUNTED PAGE&lt;/h1&gt;" &gt; /app/docker/test/code/index.html</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行容器（挂载卷）</span></span><br><span class="line">docker run -d \</span><br><span class="line">--name "docker_volumnt_ngx_v1" \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-v /app/docker/test/code/index.html:/usr/share/nginx/html/index.html \</span><br><span class="line">nginx:stable-alpine</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看挂载</span></span><br><span class="line">[root@docker01[ ~]#docker inspect docker_volumnt_ngx_v1 | jq .[].HostConfig.Binds</span><br><span class="line">[</span><br><span class="line">  "/app/docker/test/code/index.html:/usr/share/nginx/html/index.html"</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p>测试</p>
<p><img src="/../../../img/image-20240524170033688.png" alt="image-20240524170033688"></p>
<blockquote>
<p>提示：</p>
<p>如果宿主机文件内容改变了，需要<strong>重启容器才能生效</strong></p>
</blockquote>
<h3 id="3-3-2-挂载站点目录"><a href="#3-3-2-挂载站点目录" class="headerlink" title="3.3.2 挂载站点目录"></a>3.3.2 挂载站点目录</h3><p>需求：</p>
<ul>
<li>用数据卷挂载：代码目录.</li>
<li>用数据卷挂载：配置文件，配置文件目录.</li>
<li>用数据卷挂载：数据目录(数据库)</li>
<li>还可以用于日志</li>
</ul>
<blockquote>
<p>补充：</p>
<p>Nginx - alpine镜像的配置文件：</p>
<ul>
<li>配置文件子目录: /app/docker/restart/conf/nginx/conf.d/</li>
<li>挂载到：/etc/nginx/conf.d/</li>
<li>配置文件主目录: /app/docker/restart/conf/nginx/nginx.conf</li>
<li>挂载到：/etc/nginx/nginx.conf</li>
<li>站点目录: /app/docker/restart/code/</li>
<li>挂载到：/app/code/restart/</li>
</ul>
</blockquote>
<p>实现：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">物理机，创建文件夹</span></span><br><span class="line">[root@docker01[ /app/docker/test/code]#mkdir -p /app/docker/conf/nginx/conf.d /app/docker/code/restart</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动docker并挂载文件</span></span><br><span class="line">docker run -d --name "oldboy_restart_volume_v1" -p 80:80 \</span><br><span class="line">-v /app/docker/restart/conf/nginx/conf.d/:/etc/nginx/conf.d/ \</span><br><span class="line">-v /app/docker/restart/conf/nginx/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v /app/docker/restart/code/:/app/code/restart/ \</span><br><span class="line">--restart=always \</span><br><span class="line">nginx:alpine</span><br></pre></td></tr></tbody></table></figure>



<h2 id="3-4-数据卷空间"><a href="#3-4-数据卷空间" class="headerlink" title="3.4 数据卷空间"></a>3.4 数据卷空间</h2><p>应用场景：只关注容器中的数据不丢，不关注数据具体放在哪里</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建数据卷</span></span><br><span class="line">[root@docker01[ /]#docker volume create oldboydata</span><br><span class="line">oldboydata</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看数据卷</span></span><br><span class="line">[root@docker01[ /]#docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     oldboydata</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在物理机的实际存放位置</span></span><br><span class="line">[root@docker01[ /]#tree /var/lib/docker/volumes/oldboydata/</span><br><span class="line">/var/lib/docker/volumes/oldboydata/</span><br><span class="line">└── _data</span><br><span class="line">1 directory, 0 files</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">挂载数据卷运行</span></span><br><span class="line">[root@docker01[ /]#docker run -d --name "nginx_vol" -p 80:80 -v oldboydata:/var/log/nginx/ nginx:stable-alpine</span><br><span class="line">8c2800b434161fd7401b56b45ba236b3e0f10e354baecbc47be03e47e4b70878</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">已经生效</span></span><br><span class="line">[root@docker01[ /app/docker/restart/conf/nginx]#ls -l /var/lib/docker/volumes/</span><br><span class="line">total 24</span><br><span class="line">brw-------. 1 root root 253, 0 May 24 10:35 backingFsBlockDev</span><br><span class="line">-rw-------. 1 root root  32768 May 27 09:09 metadata.db</span><br><span class="line">drwx-----x. 3 root root     19 May 27 09:09 oldboydata</span><br><span class="line">[root@docker01[ /app/docker/restart/conf/nginx]#ls -l /var/lib/docker/volumes/oldboydata/_data/</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx. 1 root root 11 Nov 17  2021 access.log -&gt; /dev/stdout</span><br><span class="line">lrwxrwxrwx. 1 root root 11 Nov 17  2021 error.log -&gt; /dev/stderr</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>注意：</p>
<p>nginx容器的日志默认是输出到docker标准输出和标准错误输出的，而不是存放在文</p>
<p>件中。未来查看日志的时候，不用进入到容器，然后tail/less使用命令查看.</p>
<p>直接使用docker logs 容器id或名字 就可以看日志。</p>
<p>相当于查看access.log或error.log  </p>
</blockquote>
<h2 id="3-5-随机数据卷（较少使用）"><a href="#3-5-随机数据卷（较少使用）" class="headerlink" title="3.5 随机数据卷（较少使用）"></a>3.5 随机数据卷（较少使用）</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v不指定具体的卷标</span></span><br><span class="line">docker run -d --name "nginx_vol_oldboylogdatav2" -p :80 -v :/var/log/nginx/ nginx:stable-alpine</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>注意：</p>
<p>在Docker version 26.1.3中，测试已经不行了，会报错</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker: invalid spec: :/var/log/nginx/: empty section between colons</span></span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<h2 id="3-6-容器时区的问题"><a href="#3-6-容器时区的问题" class="headerlink" title="3.6 容器时区的问题"></a>3.6 容器时区的问题</h2><p>进入容器内执行</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装tzdata工具，设置时区</span></span><br><span class="line">apk update \</span><br><span class="line">&amp;&amp; apk add tzdata \</span><br><span class="line">&amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/locatime \</span><br><span class="line">&amp;&amp; echo "Asia/Shanghai" &gt; /etc/timezone</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>测试，时区没有生效。。。。还是要用时网上找吧</p>
</blockquote>
<h2 id="3-7-数据卷使用与容器架构"><a href="#3-7-数据卷使用与容器架构" class="headerlink" title="3.7 数据卷使用与容器架构"></a>3.7 数据卷使用与容器架构</h2><p>运行多个docker的时候，只需要维护一份代码</p>
<p><img src="/../../../img/image-20240528140249375.png" alt="image-20240528140249375"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://gsproj.github.io">Haris</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://gsproj.github.io/2024/05/24/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day60-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-2/">http://gsproj.github.io/2024/05/24/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day60-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://gsproj.github.io" target="_blank">Haris的小站</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/%E5%A4%B4%E5%83%8F.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/05/24/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day59-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-1/" title="day59-容器架构-Docker（一）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">day59-容器架构-Docker（一）</div></div><div class="info-2"><div class="info-item-1">容器架构-Docker-01今日内容：  服务架构概述 容器介绍 Docker快速上手  一、IAAS PAAS SAAS概述Iaas：基础设施即服务 Infrastructure-as-a-Service Paas：平台即服务 Platform-as-a-Service Saas：软件即服务 Software-as-a-Service Caas：容器即服务 介于IAAS和PAAS IAAS，PAAS，SAAS这些服务，用于帮助人们更快实现目标(搭建环境,使用产品) 从左到右，人们需要管理与维护的地方越来越少，人们可以把重点关注在使用/应用上.   更形象点：  IAAS平台:基础设施,阿里云,云厂商. PAAS平台:服务/运行环境是ok，公有云，负载均衡SLB SAAS平台:服务已经准备好，您直接用，具体产品，如processon,wps,亿图  图示-抽象：  图示-具体：  二、容器介绍2.1...</div></div></div></a><a class="pagination-related" href="/2024/05/28/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day61-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-3/" title="day61-容器架构-Docker（三）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">day61-容器架构-Docker（三）</div></div><div class="info-2"><div class="info-item-1">容器架构-Docker-03今日内容： -  一、容器自动化Dockerfile手动自定义镜像，就像加工流水线，需要一直进行重复的操作：  需要使用Dockerfile来让它自动化运行 1.1 手动实现-创建tengine镜像目标：先手动创建tengine镜像，了解流程 1.1.1 启动Ubuntu容器123456# 启动[root@docker01 /]#docker run -itd --name "tengine_bird_v1" ubuntu:20.04 /bin/bash# 进入[root@docker01 /]#docker exec -it tengine_bird_v1 /bin/bashroot@281122640a6d:/#   1.1.2 配置apt源并安装软件12345678# 替换为阿里源root@281122640a6d:/# sed -ri 's#archive.ubuntu.com|security.ubuntu.com#mirrors.aliyun.com#g'...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info-name">Haris</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">211</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-Docker-02"><span class="toc-text">容器架构-Docker-02</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Docker%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%F0%9F%8C%9F%F0%9F%8C%9F"><span class="toc-text">一、Docker容器管理🌟🌟</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">1.1 容器管理的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-1-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8"><span class="toc-text">1.1.1 查看容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-2-%E5%88%9B%E5%BB%BA-%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="toc-text">1.1.2 创建/运行容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-3-%E5%90%AF%E5%8A%A8-%E5%81%9C%E6%AD%A2%E5%AE%B9%E5%99%A8"><span class="toc-text">1.1.3 启动/停止容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-4-%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8"><span class="toc-text">1.1.4 删除容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-5-%E8%BF%9B%E5%85%A5%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-text">1.1.5 进入正在运行的容器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#exec%E5%92%8Cattach%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">exec和attach的区别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-6-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E4%BF%A1%E6%81%AF%E4%B8%8E%E7%8A%B6%E6%80%81"><span class="toc-text">1.1.6 查看容器信息与状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-7-%E5%AE%B9%E5%99%A8%E5%A4%AF%E4%BD%8F%E6%89%8D%E8%83%BD%E4%B8%80%E7%9B%B4%E8%BF%90%E8%A1%8C%F0%9F%8C%9F"><span class="toc-text">1.1.7 容器夯住才能一直运行🌟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-8-%E5%AE%B9%E5%99%A8%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6"><span class="toc-text">1.1.8 容器传输文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-9-commit%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8F%F0%9F%8C%9F"><span class="toc-text">1.1.9 commit自定义镜像🌟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-10-%E5%AE%B9%E5%99%A8%E5%AF%BC%E5%87%BA%E5%AF%BC%E5%85%A5"><span class="toc-text">1.1.10 容器导出导入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="toc-text">二、端口映射</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E8%83%8C%E5%90%8E%E5%85%B7%E4%BD%93%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">2.1 背后具体做了什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%E7%9A%84%E6%97%B6%E5%80%99%E7%BB%8F%E5%8E%86%E4%BA%86%E4%BB%80%E4%B9%88"><span class="toc-text">2.2 用户访问的时候经历了什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E7%9A%84%E6%A1%88%E4%BE%8B"><span class="toc-text">2.3 端口映射的案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E4%B8%80%E5%AF%B9%E4%B8%80%E6%98%A0%E5%B0%84"><span class="toc-text">2.3.1 一对一映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E5%A4%9A%E5%AF%B9%E5%A4%9A%E6%98%A0%E5%B0%84"><span class="toc-text">2.3.2 多对多映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-IP%E7%BB%91%E5%AE%9A%E7%AB%AF%E5%8F%A3"><span class="toc-text">2.3.3 IP绑定端口</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%8C%82%E8%BD%BD"><span class="toc-text">三、数据卷挂载</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%8C%82%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="toc-text">3.1 为什么需要挂载数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E9%80%89%E9%A1%B9%E8%A1%A5%E5%85%85"><span class="toc-text">3.2 选项补充</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-docker-run%E9%80%89%E9%A1%B9%E8%A1%A5%E5%85%85"><span class="toc-text">3.2.1 docker run选项补充</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-docker-exec%E9%80%89%E9%A1%B9%E8%A1%A5%E5%85%85"><span class="toc-text">3.2.2 docker exec选项补充</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E6%8C%82%E8%BD%BD%E9%A1%B9%E7%9B%AE"><span class="toc-text">3.3 挂载项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E6%8C%82%E8%BD%BD%E5%8D%95%E4%B8%AA%E7%AB%99%E7%82%B9%E6%96%87%E4%BB%B6"><span class="toc-text">3.3.1 挂载单个站点文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E6%8C%82%E8%BD%BD%E7%AB%99%E7%82%B9%E7%9B%AE%E5%BD%95"><span class="toc-text">3.3.2 挂载站点目录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E6%95%B0%E6%8D%AE%E5%8D%B7%E7%A9%BA%E9%97%B4"><span class="toc-text">3.4 数据卷空间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E9%9A%8F%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%8D%B7%EF%BC%88%E8%BE%83%E5%B0%91%E4%BD%BF%E7%94%A8%EF%BC%89"><span class="toc-text">3.5 随机数据卷（较少使用）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-%E5%AE%B9%E5%99%A8%E6%97%B6%E5%8C%BA%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">3.6 容器时区的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-%E6%95%B0%E6%8D%AE%E5%8D%B7%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84"><span class="toc-text">3.7 数据卷使用与容器架构</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/21/06_%E6%9D%82%E8%AE%B0/ollama%E8%BF%90%E8%A1%8Cdeepseek%E5%A4%A7%E6%A8%A1%E5%9E%8B/" title="8卡A800运行DeepseekR1-671B大模型">8卡A800运行DeepseekR1-671B大模型</a><time datetime="2025-04-21T06:29:52.000Z" title="发表于 2025-04-21 14:29:52">2025-04-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/26/09_%E9%9F%A9%E5%85%88%E8%B6%85K8S/01-Docker%E5%9F%BA%E7%A1%80/06-Docker%E8%B5%84%E6%BA%90%E9%85%8D%E9%A2%9D/" title="06-Docker资源配额">06-Docker资源配额</a><time datetime="2025-03-26T07:12:52.000Z" title="发表于 2025-03-26 15:12:52">2025-03-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/20/09_%E9%9F%A9%E5%85%88%E8%B6%85K8S/01-Docker%E5%9F%BA%E7%A1%80/05-Docker%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/" title="05-Docker容器数据持久化">05-Docker容器数据持久化</a><time datetime="2025-03-20T07:12:52.000Z" title="发表于 2025-03-20 15:12:52">2025-03-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/12/09_%E9%9F%A9%E5%85%88%E8%B6%85K8S/01-Docker%E5%9F%BA%E7%A1%80/04-Dockerfile%E5%AE%9E%E6%88%98%E7%AF%87-%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F/" title="04-Dockerfile实战篇-构建镜像">04-Dockerfile实战篇-构建镜像</a><time datetime="2025-03-12T07:12:52.000Z" title="发表于 2025-03-12 15:12:52">2025-03-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/04/09_%E9%9F%A9%E5%85%88%E8%B6%85K8S/01-Docker%E5%9F%BA%E7%A1%80/03-Dockerfile%E5%9F%BA%E7%A1%80%E7%AF%87-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/" title="03-Dockerfile基础篇-基本语法">03-Dockerfile基础篇-基本语法</a><time datetime="2025-03-04T07:12:52.000Z" title="发表于 2025-03-04 15:12:52">2025-03-04</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">©2019 - 2025 By Haris</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"></div><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>