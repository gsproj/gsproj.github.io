<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>day63-容器架构-Docker（五） | Haris的小站</title><meta name="author" content="Haris"><meta name="copyright" content="Haris"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="容器架构-Docker-05今日内容：  容器编排  一、容器编排工具Compose1.1 容器编排介绍目前存在的问题：docker容器的管理(启动,关闭,重启)，需要手动执行，如何自动管理多个容器？  就像docker镜像可以通过Dockerfile一键创建。 这时，就是能使用容器编排技术。 单机容器编排工具：  docker compose 需要单独安装(epel源中就有),语法yaml格式">
<meta property="og:type" content="article">
<meta property="og:title" content="day63-容器架构-Docker（五）">
<meta property="og:url" content="http://gsproj.github.io/2024/05/29/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day63-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-5/index.html">
<meta property="og:site_name" content="Haris的小站">
<meta property="og:description" content="容器架构-Docker-05今日内容：  容器编排  一、容器编排工具Compose1.1 容器编排介绍目前存在的问题：docker容器的管理(启动,关闭,重启)，需要手动执行，如何自动管理多个容器？  就像docker镜像可以通过Dockerfile一键创建。 这时，就是能使用容器编排技术。 单机容器编排工具：  docker compose 需要单独安装(epel源中就有),语法yaml格式">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://gsproj.github.io/img/%E5%A4%B4%E5%83%8F.png">
<meta property="article:published_time" content="2024-05-29T05:08:52.000Z">
<meta property="article:modified_time" content="2024-08-02T01:48:34.361Z">
<meta property="article:author" content="Haris">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://gsproj.github.io/img/%E5%A4%B4%E5%83%8F.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "day63-容器架构-Docker（五）",
  "url": "http://gsproj.github.io/2024/05/29/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day63-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-5/",
  "image": "http://gsproj.github.io/img/%E5%A4%B4%E5%83%8F.png",
  "datePublished": "2024-05-29T05:08:52.000Z",
  "dateModified": "2024-08-02T01:48:34.361Z",
  "author": [
    {
      "@type": "Person",
      "name": "Haris",
      "url": "http://gsproj.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://gsproj.github.io/2024/05/29/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day63-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-5/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'day63-容器架构-Docker（五）',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/modify.css"><style>#article-container.post-content h1:before, h2:before, h3:before, h4:before, h5:before, h6:before { -webkit-animation: avatar_turn_around 1s linear infinite; -moz-animation: avatar_turn_around 1s linear infinite; -o-animation: avatar_turn_around 1s linear infinite; -ms-animation: avatar_turn_around 1s linear infinite; animation: avatar_turn_around 1s linear infinite; }</style><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/css/loading-bar.css"><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/img/猫.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">213</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/car2.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Haris的小站</span></a><a class="nav-page-title" href="/"><span class="site-name">day63-容器架构-Docker（五）</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">day63-容器架构-Docker（五）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-05-29T05:08:52.000Z" title="发表于 2024-05-29 13:08:52">2024-05-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-02T01:48:34.361Z" title="更新于 2024-08-02 09:48:34">2024-08-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BF%90%E7%BB%B4/%EF%BC%88%E4%BA%8C%EF%BC%89%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/">（二）综合架构</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="top-img" style="background-image: url(/img/car2.png);"></div><article class="container post-content" id="article-container"><h1 id="容器架构-Docker-05"><a href="#容器架构-Docker-05" class="headerlink" title="容器架构-Docker-05"></a>容器架构-Docker-05</h1><p>今日内容：</p>
<ul>
<li>容器编排</li>
</ul>
<h1 id="一、容器编排工具Compose"><a href="#一、容器编排工具Compose" class="headerlink" title="一、容器编排工具Compose"></a>一、容器编排工具Compose</h1><h2 id="1-1-容器编排介绍"><a href="#1-1-容器编排介绍" class="headerlink" title="1.1 容器编排介绍"></a>1.1 容器编排介绍</h2><p>目前存在的问题：docker容器的管理(启动,关闭,重启)，需要手动执行，如何自动管理多个容器？  就像docker镜像可以通过Dockerfile一键创建。</p>
<p>这时，就是能使用容器编排技术。</p>
<p>单机容器编排工具：</p>
<ul>
<li>docker compose</li>
<li>需要单独安装(epel源中就有),语法yaml格式</li>
</ul>
<p>容器集群管理的方法：</p>
<ul>
<li>ansible + docker compose + dockerfile</li>
<li>docker swarm实现集群管理.</li>
<li>mesos</li>
<li>未来我们通过k8s kubernetes实现集群管理</li>
</ul>
<p>了解：docker三剑客</p>
<ul>
<li>docker machine(管理虚拟机)</li>
<li>docker compose(容器编排)</li>
<li>docker swarm(集群)</li>
</ul>
<h2 id="1-2-compose初步上手"><a href="#1-2-compose初步上手" class="headerlink" title="1.2 compose初步上手"></a>1.2 compose初步上手</h2><h3 id="1-2-1-安装"><a href="#1-2-1-安装" class="headerlink" title="1.2.1 安装"></a>1.2.1 安装</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">[root@docker02 /]#yum install -y docker-compose </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">准备工作目录</span></span><br><span class="line">[root@docker02 /]#mkdir -p /server/compose/01-run-nginx</span><br></pre></td></tr></tbody></table></figure>

<h3 id="1-2-1-书写配置文件"><a href="#1-2-1-书写配置文件" class="headerlink" title="1.2.1 书写配置文件"></a>1.2.1 书写配置文件</h3><p>书写格式参考：</p>
<p><img src="/../../../img/image-20240530125740774.png" alt="image-20240530125740774"></p>
<p>编写一个简单的compose，部署nginx容器</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /server/compose/01-run-nginx]#cat docker-compose.yml </span><br><span class="line">version: "3.3"</span><br><span class="line">services:</span><br><span class="line">  nginx_compose:</span><br><span class="line">    image: "nginx:stable-alpine"</span><br><span class="line">    ports:</span><br><span class="line">      - "18848:80"</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>compose文件有一定的命名规则，建议按规范来</p>
</blockquote>
<h3 id="1-2-3-运行"><a href="#1-2-3-运行" class="headerlink" title="1.2.3 运行"></a>1.2.3 运行</h3><p>执行yaml文件</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /server/compose/01-run-nginx]#docker-compose up -d</span><br><span class="line">Creating 01runnginx_nginx_compose_1 ... done</span><br></pre></td></tr></tbody></table></figure>

<p>查看，使用compose的ps</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看</span></span><br><span class="line">[root@docker02 /server/compose/01-run-nginx]#docker-compose  ps</span><br><span class="line">        Name                   Command          State           Ports        </span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">01runnginx_nginx_comp   /docker-entrypoint.sh   Up      0.0.0.0:18848-&gt;80/tcp</span><br><span class="line">ose_1                   ngin ...                        ,:::18848-&gt;80/tcp </span><br></pre></td></tr></tbody></table></figure>

<p>测试</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /server/compose/01-run-nginx]#curl localhost:18848</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>



<h2 id="1-3-docker-compose命令"><a href="#1-3-docker-compose命令" class="headerlink" title="1.3 docker-compose命令"></a>1.3 docker-compose命令</h2><p>docker-compose可以用于创建、运行容器、删除容器、查看容器情况等，包含多种功能。</p>
<p>实际上这个命令包含了docker container和docker image命令</p>
<table>
<thead>
<tr>
<th>命令格式</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>up</td>
<td>up == run，创建并运行容器<br>其中<code>up -d</code>代表后台运行</td>
</tr>
<tr>
<td>down</td>
<td>关闭容器、删除容器以及相关资源<font color="red">（慎用！！）</font></td>
</tr>
<tr>
<td>stop/start/restart</td>
<td>关闭、开启、重启容器</td>
</tr>
<tr>
<td>ps</td>
<td>查看容器运行情况，可选用<code>-q</code>选项</td>
</tr>
<tr>
<td>top</td>
<td>查看容器进程信息</td>
</tr>
<tr>
<td>logs</td>
<td>容器日志</td>
</tr>
<tr>
<td>rm</td>
<td>删除容器（需要容器已经关闭）</td>
</tr>
<tr>
<td>images</td>
<td>查看镜像</td>
</tr>
</tbody></table>
<blockquote>
<p>注意：</p>
<p>docker-compose命令只能看到受compose编排的容器信息</p>
</blockquote>
<h2 id="1-4-修改docker-compose与生效"><a href="#1-4-修改docker-compose与生效" class="headerlink" title="1.4 修改docker-compose与生效"></a>1.4 修改docker-compose与生效</h2><p>如果docker-compose简单修改端口、数据卷</p>
<ul>
<li><code>docker-compose up -d</code>会自动识别，重新创建容器.</li>
</ul>
<p>如果容器的名字也改了，会造成新旧容器的端口冲突，会失败</p>
<ul>
<li>可以<code> docker-compose up -d --remove-orphans</code> 删除之前容器或失效容器</li>
</ul>
<h2 id="1-5-compose文件常用指令"><a href="#1-5-compose文件常用指令" class="headerlink" title="1.5 compose文件常用指令"></a>1.5 compose文件常用指令</h2><p>挂载数据卷、容器之间的依赖、先后顺序。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">depends_on: 依赖,先启动指定的容器然后再启动当前容器.</span><br><span class="line">volumes: 数据卷</span><br><span class="line">links: 容器连接,本质hosts解析</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>建议到官网查找，按需求使用</p>
</blockquote>
<h2 id="1-6-案例-compose部署kodexp"><a href="#1-6-案例-compose部署kodexp" class="headerlink" title="1.6 案例:compose部署kodexp"></a>1.6 案例:compose部署kodexp</h2><p>把容器互联的案例，用compose再实现一遍</p>
<p>文件目录</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /app/docker/kodexp]#ls</span><br><span class="line">code  conf  data  docker-compose.yml</span><br></pre></td></tr></tbody></table></figure>

<p>原来的命令操作</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">php</span></span><br><span class="line">[root@docker02 /app/docker]#docker run -d --name "kodexp_php" \</span><br><span class="line">-v /app/docker/kodexp/conf/www.conf:/usr/local/etc/php-fpm.d/www.conf \</span><br><span class="line">-v /app/docker/kodexp/code:/app/code/kodexp php:7-fpm-alpine </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nginx</span></span><br><span class="line">[root@docker02 /app/docker/kodexp]#docker run -d --name "kodexp_nginx" -p 10086:80 \</span><br><span class="line">--link kodexp_php:php \</span><br><span class="line">-v `pwd`/conf/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v `pwd`/conf/kodexp.conf:/etc/nginx/conf.d/kodexp.conf \</span><br><span class="line">-v `pwd`/code:/app/code/kodexp/ \</span><br><span class="line">nginx:stable-alpine</span><br></pre></td></tr></tbody></table></figure>

<p>改用compose的yml文件：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /app/docker/kodexp]#cat docker-compose.yml </span><br><span class="line">version: "3.3"</span><br><span class="line">services:</span><br><span class="line">  kodexp_ngx:</span><br><span class="line">    image: "nginx:stable-alpine"</span><br><span class="line">    ports:</span><br><span class="line">      - "12580:80"</span><br><span class="line">    links:</span><br><span class="line">      - "kodexp_php:php"</span><br><span class="line">    depends_on:</span><br><span class="line">      - "kodexp_php"</span><br><span class="line">    volumes:</span><br><span class="line">      - "./conf/nginx.conf:/etc/nginx/nginx.conf"</span><br><span class="line">      - "./conf/kodexp.conf:/etc/nginx/conf.d/kodexp.conf"</span><br><span class="line">      - "./code:/app/code/kodexp"</span><br><span class="line">  kodexp_php:</span><br><span class="line">    image: "php:7-fpm-alpine"</span><br><span class="line">    volumes:</span><br><span class="line">      - "./conf/www.conf:/usr/local/etc/php-fpm/www.conf"</span><br><span class="line">      - "./code:/app/code/kodexp"</span><br></pre></td></tr></tbody></table></figure>

<p>执行</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /app/docker/kodexp]#docker-compose up -d </span><br><span class="line">Creating kodexp_kodexp_php_1 ... done</span><br><span class="line">Creating kodexp_kodexp_php_1 ... </span><br><span class="line">Creating kodexp_kodexp_ngx_1 ... done</span><br></pre></td></tr></tbody></table></figure>

<p>测试</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /app/docker/kodexp]#docker-compose  ps</span><br><span class="line">       Name                  Command           State           Ports         </span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">kodexp_kodexp_ngx_1   /docker-entrypoint.sh    Up      0.0.0.0:12580-&gt;80/tcp,</span><br><span class="line">                      ngin ...                         :::12580-&gt;80/tcp      </span><br><span class="line">kodexp_kodexp_php_1   docker-php-entrypoint    Up      9000/tcp    </span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../../../img/image-20240530165306409.png" alt="image-20240530165306409"></p>
<blockquote>
<p>问题记录：</p>
<p>在启动后容器后，nginx容器显示EXIT 1状态，不正常。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">[root@docker02 /app/docker/kodexp]#docker-compose ps</span> </span><br><span class="line">      Name                      Command               State     Ports  </span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">------------------------------------------------------------------------</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">kodexp_kodexp_ngx_1   /docker-entrypoint.sh ngin ...   Exit 1</span>           </span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">kodexp_kodexp_php_1   docker-php-entrypoint php-fpm    Up       9000/tcp</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>查看日志发现问题是由kodexp_php容器的别名引起的：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">nginx: [emerg] host not found <span class="keyword">in</span> upstream <span class="string">"php"</span> <span class="keyword">in</span> /etc/nginx/conf.d/kodexp.conf:10</span></span><br></pre></td></tr></tbody></table></figure>

<p>修改nginx配置文件，不使用别名即可</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">[root@docker02 /app/docker/kodexp]#!<span class="built_in">cat</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">cat</span> conf/kodexp.conf</span> </span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">server {</span></span><br><span class="line"> listen 80;</span><br><span class="line"> server_name kodexp.oldboylinux.cn;</span><br><span class="line"> root /app/code/kodexp;</span><br><span class="line"></span><br><span class="line"> location / {</span><br><span class="line">   index index.php;</span><br><span class="line"> }</span><br><span class="line">   location ~ \.php$ {</span><br><span class="line">     fastcgi_pass kodexp_php:9000;	# 不用别名</span><br><span class="line">     fastcgi_index index.php;</span><br><span class="line">     fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">     include fastcgi_params;</span><br><span class="line"> }</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">}</span></span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<h2 id="1-7-案例：compose和dockerfile结合使用"><a href="#1-7-案例：compose和dockerfile结合使用" class="headerlink" title="1.7 案例：compose和dockerfile结合使用"></a>1.7 案例：compose和dockerfile结合使用</h2><p>通过dockerfile构建镜像，在通过compose启动容器</p>
<p>以tengine的bird案例为基准，重构为：tengine+birds+compose</p>
<p>目录结构</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /server/dockerfile/01_bird]#ls</span><br><span class="line">bird.tar.gz  docker-compose.yml  Dockerfile  tengine-2.3.3.tar.gz</span><br></pre></td></tr></tbody></table></figure>

<p>yml内容</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /server/dockerfile/01_bird]#cat docker-compose.yml </span><br><span class="line">version: "3.3"</span><br><span class="line">services:</span><br><span class="line">  ngx_bird:</span><br><span class="line">    build: .</span><br><span class="line">    image: "web:ngx_bird"</span><br><span class="line">    ports:</span><br><span class="line">      - "80:80"</span><br></pre></td></tr></tbody></table></figure>

<p>Dockerfile内容</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:20.04</span><br><span class="line">LABEL author="Haris Gong" \</span><br><span class="line">	url='gsproj.github.io'</span><br><span class="line"></span><br><span class="line">ADD tengine-2.3.3.tar.gz /tmp/</span><br><span class="line"></span><br><span class="line">ENV Web_User="nginx"</span><br><span class="line">ENV Web_Server="tengine"</span><br><span class="line">ENV Web_Version="2.3.2"</span><br><span class="line">ENV Server_Dir="/app/tools/tengine-2.3.2"</span><br><span class="line">ENV Server_Dir_Soft="/app/tools/tengine"</span><br><span class="line"></span><br><span class="line">RUN sed -ri 's#archive.ubuntu.com|security.ubuntu.com#mirrors.aliyun.com#g' /etc/apt/sources.list \</span><br><span class="line">&amp;&amp; apt update &amp;&amp; apt-get install -y vim curl libssl-dev make gcc pcre2-utils libpcre3-dev zlib1g-dev \</span><br><span class="line">&amp;&amp; cd /tmp/tengine-2.3.3/ \</span><br><span class="line">&amp;&amp; ./configure --prefix=/app/tools/${Web_Server}-${Web_Version}/ \</span><br><span class="line">--user=${Web_User} \</span><br><span class="line">--group=${Web_User} \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_v2_module \</span><br><span class="line">--with-http_realip_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-http_mp4_module \</span><br><span class="line">--with-stream \</span><br><span class="line">--with-stream_ssl_module \</span><br><span class="line">--with-stream_realip_module \</span><br><span class="line">--add-module=modules/ngx_http_upstream_check_module/ \</span><br><span class="line">--add-module=modules/ngx_http_upstream_session_sticky_module \</span><br><span class="line">&amp;&amp; make -j 1 \</span><br><span class="line">&amp;&amp; make install \</span><br><span class="line">&amp;&amp; ln -s ${Server_Dir} ${Server_Dir_Soft} \</span><br><span class="line">&amp;&amp; ln -s ${Server_Dir_Soft}/sbin/nginx /sbin/nginx \</span><br><span class="line">&amp;&amp; groupadd ${Web_User} \</span><br><span class="line">&amp;&amp; useradd -s /sbin/nologin -g ${Web_User} ${Web_User}</span><br><span class="line"></span><br><span class="line">ADD bird.tar.gz ${Server_Dir_Soft}/html/</span><br><span class="line"></span><br><span class="line">RUN rm -fr /tmp/* /var/cache/*</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD [ "nginx","-g","daemon off;" ]</span><br></pre></td></tr></tbody></table></figure>

<p>执行compose，可见compose自动调用Dockerfile开始构建ngx_bird镜像。</p>
<p>但是<strong>构建完之后有警告</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /server/dockerfile/01_bird]#docker-compose up -d</span><br><span class="line">Creating network "01bird_default" with the default driver</span><br><span class="line">Building ngx_bird</span><br><span class="line">Step 1/13 : FROM ubuntu:20.04</span><br><span class="line">20.04: Pulling from library/ubuntu</span><br><span class="line">7b1a6ab2e44d: Already exists</span><br><span class="line">Digest: sha256:626ffe58f6e7566e00254b638eb7e0f3b11d4da9675088f4781a50ae288f3322</span><br><span class="line">...</span><br><span class="line">Successfully built 2642d663c8d5</span><br><span class="line">Successfully tagged web:ngx_bird</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">！警告！</span></span><br><span class="line">WARNING: Image for service ngx_bird was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.</span><br><span class="line">Creating 01bird_ngx_bird_1 ... done</span><br></pre></td></tr></tbody></table></figure>

<p>按照警告的要求执行</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /server/dockerfile/01_bird]#docker-compose up -d --build</span><br><span class="line">Building ngx_bird</span><br><span class="line">..</span><br><span class="line">Successfully built 2642d663c8d5</span><br><span class="line">Successfully tagged web:ngx_bird</span><br><span class="line">01bird_ngx_bird_1 is up-to-date</span><br></pre></td></tr></tbody></table></figure>

<p>已经运行起来了</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /server/dockerfile/01_bird]#docker-compose ps</span><br><span class="line">      Name                Command          State             Ports           </span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">01bird_ngx_bird_1   nginx -g daemon off;   Up      0.0.0.0:80-&gt;80/tcp,:::80-&gt;</span><br><span class="line">                                                   80/tcp            </span><br></pre></td></tr></tbody></table></figure>

<p>测试，访问：<a target="_blank" rel="noopener" href="http://10.0.0.82/">http://10.0.0.82:80</a></p>
<p><img src="/../../../img/image-20240530171048926.png" alt="image-20240530171048926"></p>
<h1 id="二、Docker镜像仓库"><a href="#二、Docker镜像仓库" class="headerlink" title="二、Docker镜像仓库"></a>二、Docker镜像仓库</h1><p>Docker镜像仓库主要分为四种，具有各自的应用场景</p>
<table>
<thead>
<tr>
<th>仓库方案</th>
<th>应用场景</th>
</tr>
</thead>
<tbody><tr>
<td>镜像保存为压缩包</td>
<td>save/load，仅适用于节点极少的情况，很不方便</td>
</tr>
<tr>
<td>registry镜像仓库</td>
<td>适用于小型网站集群（镜像不多，环境不复杂），命令行操作，使用方便</td>
</tr>
<tr>
<td>harbor镜像仓库</td>
<td>企业级镜像仓库（docker、k8s都可用），图形化页面</td>
</tr>
<tr>
<td>公有云的镜像仓库</td>
<td>在公有云上申请（个人、企业）</td>
</tr>
</tbody></table>
<h2 id="2-1-registry仓库"><a href="#2-1-registry仓库" class="headerlink" title="2.1 registry仓库"></a>2.1 registry仓库</h2><h3 id="2-1-1-环境准备"><a href="#2-1-1-环境准备" class="headerlink" title="2.1.1 环境准备"></a>2.1.1 环境准备</h3><table>
<thead>
<tr>
<th>主机名</th>
<th>IP地址</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>docker01</td>
<td>10.0.0.81</td>
<td></td>
</tr>
<tr>
<td>docker02</td>
<td>10.0.0.82</td>
<td>作为仓库</td>
</tr>
</tbody></table>
<p>所有主机对应主机名能够解析  </p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt;/etc/hosts&lt;&lt;EOF</span><br><span class="line">10.0.0.81 docker01</span><br><span class="line">10.0.0.82 docker02</span><br><span class="line">EOF</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-1-2-极速上手"><a href="#2-1-2-极速上手" class="headerlink" title="2.1.2 极速上手"></a>2.1.2 极速上手</h3><h4 id="A-服务端部署"><a href="#A-服务端部署" class="headerlink" title="A.服务端部署"></a>A.服务端部署</h4><p>1、安装镜像仓库服务</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /]#docker pull registry</span><br><span class="line">Using default tag: latest</span><br></pre></td></tr></tbody></table></figure>

<p>2、配置服务端，允许使用http（未来所有使用私有镜像仓库的节点都要配置）</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/docker/daemon.json&lt;&lt;'EOF'</span><br><span class="line">{</span><br><span class="line">  "registry-mirrors":["https://bjjtv7cs.mirror.aliyuncs.com"],</span><br><span class="line">  "insecure-registries": ["docker02:5000"]</span><br><span class="line">}</span><br><span class="line">EOF</span><br></pre></td></tr></tbody></table></figure>

<p>配置完重启docker</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></tbody></table></figure>

<p>3、启动registry容器（未来可以用compose实现）</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建数据卷</span></span><br><span class="line">[root@docker02 /]#docker volume create registry</span><br><span class="line">[root@docker02 /]#docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     oldboydata</span><br><span class="line">local     registry</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">映射端口，并启动</span></span><br><span class="line">docker run -d --name "oldboy_registry"  \</span><br><span class="line">-p 5000:5000 -v registry:/var/lib/registry \</span><br><span class="line">--restart=always registry:latest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--restart表示容器异常退出,会自动重启容器</span></span><br></pre></td></tr></tbody></table></figure>

<p>访问：<a target="_blank" rel="noopener" href="http://docker02:5000/v2/_catalog">http://docker02:5000/v2/_catalog</a></p>
<p>查看私有仓库信息（默认没有什么有用信息）</p>
<p><img src="/../../../img/image-20240530183620025.png" alt="image-20240530183620025"></p>
<h4 id="B-客户端上传镜像"><a href="#B-客户端上传镜像" class="headerlink" title="B.客户端上传镜像"></a>B.客户端上传镜像</h4><p>1、客户端docker02，上传镜像</p>
<p>首先也得设置docker配置文件，并重启docker服务</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/docker/daemon.json&lt;&lt;'EOF'</span><br><span class="line">{</span><br><span class="line">  "registry-mirrors":["https://bjjtv7cs.mirror.aliyuncs.com"],</span><br><span class="line">  "insecure-registries": ["docker02:5000"]</span><br><span class="line">}</span><br><span class="line">EOF</span><br></pre></td></tr></tbody></table></figure>

<p>2、再镜像打标签</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#docker images</span><br><span class="line">REPOSITORY   TAG                        IMAGE ID       CREATED       SIZE</span><br><span class="line">...</span><br><span class="line">nginx        stable-alpine              373f8d4d4c60   2 years ago   23.2MB</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]#docker tag nginx:stable-alpine docker02:5000/myimages/nginx:stable-alpine</span><br><span class="line">[root@docker01 ~]#docker images</span><br><span class="line">REPOSITORY                     TAG                        IMAGE ID       CREATED       SIZE</span><br><span class="line">...</span><br><span class="line">nginx                          stable-alpine              373f8d4d4c60   2 years ago   23.2MB</span><br><span class="line">docker02:5000/myimages/nginx   stable-alpine              373f8d4d4c60   2 years ago   23.2MB</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<p>3、再上传</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#docker push docker02:5000/myimages/nginx:stable-alpine </span><br><span class="line">The push refers to repository [docker02:5000/myimages/nginx]</span><br><span class="line">6f44c5b5d074: Pushed </span><br><span class="line">002fcf848e67: Pushed </span><br><span class="line">e419fa208fe1: Pushed </span><br><span class="line">112ee9c2903a: Pushed </span><br><span class="line">68e5252d0d33: Pushed </span><br><span class="line">1a058d5342cc: Pushed </span><br><span class="line">stable-alpine: digest: sha256:f6609f898bcdad15047629edc4033d17f9f90e2339fb5ccb97da267f16902251 size: 1568</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>如果没有提前进行docker配置，会报错</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">[root@docker01 ~]#docker push docker02:5000/myimages/nginx:stable-alpine</span> </span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">The push refers to repository [docker02:5000/myimages/nginx]</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">Get <span class="string">"https://docker02:5000/v2/"</span>: http: server gave HTTP response to HTTPS client</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">[root@docker01 ~]#vim /etc/docker/daemon.json</span> </span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>再次访问registry网页，可以看到上传到的镜像</p>
<p><img src="/../../../img/image-20240530184607477.png" alt="image-20240530184607477"></p>
<h4 id="C-客户端下载镜像"><a href="#C-客户端下载镜像" class="headerlink" title="C.客户端下载镜像"></a>C.客户端下载镜像</h4><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#docker pull docker02:5000/myimages/nginx:stable-alpine </span><br><span class="line">stable-alpine: Pulling from myimages/nginx</span><br><span class="line">Digest: sha256:f6609f898bcdad15047629edc4033d17f9f90e2339fb5ccb97da267f16902251</span><br><span class="line">Status: Downloaded newer image for docker02:5000/myimages/nginx:stable-alpine</span><br><span class="line">docker02:5000/myimages/nginx:stable-alpine</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-1-3-写成compose"><a href="#2-1-3-写成compose" class="headerlink" title="2.1.3 写成compose"></a>2.1.3 写成compose</h3><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#registry-docker-compose</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">"3.3"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">oldboy_registry:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">"oldboy_reg"</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">"registry:latest"</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"5000:5000"</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"registry:/var/lib/registry"</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">registry:</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="2-2-企业级镜像仓库–harbor"><a href="#2-2-企业级镜像仓库–harbor" class="headerlink" title="2.2 企业级镜像仓库–harbor"></a>2.2 企业级镜像仓库–harbor</h2><h3 id="2-2-1-极速上手"><a href="#2-2-1-极速上手" class="headerlink" title="2.2.1 极速上手"></a>2.2.1 极速上手</h3><h4 id="A-服务端部署-1"><a href="#A-服务端部署-1" class="headerlink" title="A.服务端部署"></a>A.服务端部署</h4><p>1、github下载harbor</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/goharbor/harbor/releases</span><br></pre></td></tr></tbody></table></figure>

<p>2、解压</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /app]#tar -vxf harbor-offline-installer-v2.9.4.tgz </span><br><span class="line">harbor/harbor.v2.9.4.tar.gz</span><br><span class="line">harbor/prepare</span><br><span class="line">harbor/LICENSE</span><br><span class="line">harbor/install.sh	# 每次修改配置，都需要执行下</span><br><span class="line">harbor/common.sh</span><br><span class="line">harbor/harbor.yml.tmpl	# 配置文件模板</span><br></pre></td></tr></tbody></table></figure>

<p>3、hosts文件修改，添加harbor的域名</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt;/etc/hosts&lt;&lt;EOF</span><br><span class="line">10.0.0.81 docker01</span><br><span class="line">10.0.0.82 docker02 harbor.gs.cn</span><br><span class="line">EOF</span><br></pre></td></tr></tbody></table></figure>

<p>4、编辑harbor配置文件</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从模板复制一份</span></span><br><span class="line">[root@docker02 /app/harbor]#cp harbor.yml.tmpl harbor.yml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改主机名</span></span><br><span class="line">hostname: harbor.gs.cn</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁用https功能</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">https:</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">https port <span class="keyword">for</span> harbor, default is 443</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">port: 443</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">The path of cert and key files <span class="keyword">for</span> nginx</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">certificate: /your/certificate/path</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">private_key: /your/private/key/path</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改默认密码</span></span><br><span class="line">harbor_admin_password: redhat123</span><br></pre></td></tr></tbody></table></figure>

<p>5、安装harbor</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 /app/harbor]#./install.sh </span><br><span class="line"></span><br><span class="line">[Step 0]: checking if docker is installed ...</span><br><span class="line"></span><br><span class="line">Note: docker version: 26.1.3</span><br><span class="line">...</span><br><span class="line"> ✔ Container harbor-jobservice  Starte...                               3.1s </span><br><span class="line"> ✔ Container nginx              Started                                 3.1s </span><br><span class="line">✔ ----Harbor has been installed and started successfully.----</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>注意：</p>
<p>​	要检查80端口是否被占用  </p>
</blockquote>
<p>浏览器访问：<a target="_blank" rel="noopener" href="http://harbor.gs.cn/">http://harbor.gs.cn</a></p>
<p><img src="/../../../img/image-20240530191350136.png" alt="image-20240530191350136"></p>
<blockquote>
<p>admin / redhat123</p>
</blockquote>
<h4 id="B-客户端使用"><a href="#B-客户端使用" class="headerlink" title="B. 客户端使用"></a>B. 客户端使用</h4><p>1、配置docker</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#vim /etc/docker/daemon.json</span><br><span class="line">{</span><br><span class="line">        "registry-mirrors":["https://bjjtv7cs.mirror.aliyuncs.com"],</span><br><span class="line">        "insecure-registries": ["harbor.gs.cn"]</span><br><span class="line">}</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启服务</span></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></tbody></table></figure>

<p>2、登录harbor</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#docker login -uadmin -predhat123 harbor.gs.cn</span><br><span class="line">WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></tbody></table></figure>

<p>3、打标签</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#docker images</span><br><span class="line">REPOSITORY                     TAG                        IMAGE ID       CREATED       SIZE</span><br><span class="line">tengine                        birds-v1                   403c22c533aa   2 days ago    427MB</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]#docker tag tengine:birds-v1 harbor.gs.cn/library/tengine:birds-v1</span><br><span class="line">[root@docker01 ~]#docker images</span><br><span class="line">REPOSITORY                     TAG                        IMAGE ID       CREATED       SIZE</span><br><span class="line">tengine                        birds-v1                   403c22c533aa   2 days ago    427MB</span><br><span class="line">harbor.gs.cn/library/tengine   birds-v1                   403c22c533aa   2 days ago    427MB</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>tag的目录要跟harbor中的目录一致！</p>
</blockquote>
<p>4、上传</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#docker push harbor.gs.cn/library/tengine:birds-v1 </span><br><span class="line">The push refers to repository [harbor.gs.cn/library/tengine]</span><br><span class="line">6d3a7f85e089: Pushed </span><br><span class="line">000e70118252: Pushed </span><br><span class="line">910ec3ec43d0: Pushed </span><br><span class="line">ee1e9dcd2d96: Pushed </span><br><span class="line">9f54eef41275: Pushed </span><br><span class="line">birds-v1: digest: sha256:aa0f126752929d60811c709bc5c3042e3dd3e4bb2200e893aee2b8cdede932c6 size: 1369</span><br></pre></td></tr></tbody></table></figure>

<p>查看上传的镜像</p>
<p><img src="/../../../img/image-20240530192036861.png" alt="image-20240530192036861"></p>
<h3 id="2-2-2-harbor高可用-（了解）"><a href="#2-2-2-harbor高可用-（了解）" class="headerlink" title="2.2.2 harbor高可用 （了解）"></a>2.2.2 harbor高可用 （了解）</h3><p>可以通过harbor自带的镜像同步工具实现.(搭建2个harbor服务器)，找出harbor的镜像目录(registry目录),目录备份/同步  </p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/data/registry/docker/registry/v2/repositories</span><br></pre></td></tr></tbody></table></figure>



<h2 id="2-3-Dockerr命令–脑图"><a href="#2-3-Dockerr命令–脑图" class="headerlink" title="2.3 Dockerr命令–脑图"></a>2.3 Dockerr命令–脑图</h2><p><a target="_blank" rel="noopener" href="https://www.processon.com/view/link/6347dbb207912921d8137498">https://www.processon.com/view/link/6347dbb207912921d8137498</a> </p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://gsproj.github.io">Haris</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://gsproj.github.io/2024/05/29/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day63-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-5/">http://gsproj.github.io/2024/05/29/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day63-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://gsproj.github.io" target="_blank">Haris的小站</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/%E5%A4%B4%E5%83%8F.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/05/29/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day62-%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-docker-4/" title="day62-容器架构-Docker（四）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">day62-容器架构-Docker（四）</div></div><div class="info-2"><div class="info-item-1">容器架构-Docker-04今日内容：  容器互联  一、容器互联容器互联使用--link选项 1.1 分离式nginx + phpdocker镜像架构分层次  基础:系统 服务:nginx,php,tomcat,jdk,….. 业务:kodexp   实现： 1.1.1 准备项目代码目录1234567891011[root@docker02 /app/docker/kodexp]#lscode  conf  data# code存放kodexp的代码[root@docker02 /app/docker/kodexp]#ls code/app  Changelog.md  config  data  index.php  plugins  static# 代码权限修改[root@docker02 /app/docker/kodexp]#chmod -R 777 code# conf存放配置文件# data存放数据文件  1.1.2 启动php容器 配置文件挂载：/app/docker/kodexp/conf/www.conf ...</div></div></div></a><a class="pagination-related" href="/2024/05/31/07_85%E6%9C%9F%E8%BF%90%E7%BB%B4/03_%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84/day64-%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84-%E9%98%BF%E9%87%8C%E4%BA%91%E8%BF%9B%E9%98%B6-1/" title="day64-综合架构-阿里云进阶（一）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">day64-综合架构-阿里云进阶（一）</div></div><div class="info-2"><div class="info-item-1">综合架构-阿里云进阶-01今日内容：  公有云架构介绍 ECS弹性服务器使用 RDS数据库服务器使用 NAS文件存储使用 OSS对象存储使用  一、公有云目标要求：  能熟练的说出或识别公有云服务名字 能熟练说出和画出公有云网站架构 能熟练使用公有云的产品，比如：ecs、slb、rds、oss…. 熟悉服务购买、续费操作  二、公有云架构用户角度：  运维角度： 一些专业词汇    专业词汇     ecs 云服务器   vpc 虚拟专用网络 局域网   安全组 防火墙,白名单   实例 阿里云中任何一个产品或一个功能, 每个实例一般有一个独一无二的id.   1c1g 2c4g 云服务器的配置   快照 类似于虚拟机的快照, 快照默认按量收费 (购买存储包 包年包月)   镜像 创建镜像,需要创建快照—-&gt;镜像 , 镜像可以用来实现克隆的功能. 网站迁移功能   云盘 云服务器的磁盘 系统盘 数据盘   eip 弹性公网ip, 主要可以给slb,ecs….   按量负载(后付费)    包年包月(预付费)    三、ECS弹性服务器3.1...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info-name">Haris</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">213</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%9E%B6%E6%9E%84-Docker-05"><span class="toc-text">容器架构-Docker-05</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E5%B7%A5%E5%85%B7Compose"><span class="toc-text">一、容器编排工具Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E4%BB%8B%E7%BB%8D"><span class="toc-text">1.1 容器编排介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-compose%E5%88%9D%E6%AD%A5%E4%B8%8A%E6%89%8B"><span class="toc-text">1.2 compose初步上手</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E5%AE%89%E8%A3%85"><span class="toc-text">1.2.1 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E4%B9%A6%E5%86%99%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">1.2.1 书写配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-%E8%BF%90%E8%A1%8C"><span class="toc-text">1.2.3 运行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-docker-compose%E5%91%BD%E4%BB%A4"><span class="toc-text">1.3 docker-compose命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E4%BF%AE%E6%94%B9docker-compose%E4%B8%8E%E7%94%9F%E6%95%88"><span class="toc-text">1.4 修改docker-compose与生效</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-compose%E6%96%87%E4%BB%B6%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-text">1.5 compose文件常用指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-%E6%A1%88%E4%BE%8B-compose%E9%83%A8%E7%BD%B2kodexp"><span class="toc-text">1.6 案例:compose部署kodexp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-%E6%A1%88%E4%BE%8B%EF%BC%9Acompose%E5%92%8Cdockerfile%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-text">1.7 案例：compose和dockerfile结合使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Docker%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="toc-text">二、Docker镜像仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-registry%E4%BB%93%E5%BA%93"><span class="toc-text">2.1 registry仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">2.1.1 环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-%E6%9E%81%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="toc-text">2.1.2 极速上手</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#A-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%83%A8%E7%BD%B2"><span class="toc-text">A.服务端部署</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8A%E4%BC%A0%E9%95%9C%E5%83%8F"><span class="toc-text">B.客户端上传镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#C-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F"><span class="toc-text">C.客户端下载镜像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-%E5%86%99%E6%88%90compose"><span class="toc-text">2.1.3 写成compose</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E4%BC%81%E4%B8%9A%E7%BA%A7%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E2%80%93harbor"><span class="toc-text">2.2 企业级镜像仓库–harbor</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E6%9E%81%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="toc-text">2.2.1 极速上手</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#A-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%83%A8%E7%BD%B2-1"><span class="toc-text">A.服务端部署</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BD%BF%E7%94%A8"><span class="toc-text">B. 客户端使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-harbor%E9%AB%98%E5%8F%AF%E7%94%A8-%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="toc-text">2.2.2 harbor高可用 （了解）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Dockerr%E5%91%BD%E4%BB%A4%E2%80%93%E8%84%91%E5%9B%BE"><span class="toc-text">2.3 Dockerr命令–脑图</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/30/06_%E6%9D%82%E8%AE%B0/vllm%E9%83%A8%E7%BD%B2Qwen3%E5%A4%A7%E6%A8%A1%E5%9E%8B/" title="VLLM部署Qwen3大模型">VLLM部署Qwen3大模型</a><time datetime="2025-04-30T07:15:52.000Z" title="发表于 2025-04-30 15:15:52">2025-04-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/21/06_%E6%9D%82%E8%AE%B0/%E5%8D%8E%E4%B8%BA%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%85%8D%E7%BD%AEmux-vlan/" title="华为交换机配置mux-vlan">华为交换机配置mux-vlan</a><time datetime="2025-04-21T08:29:52.000Z" title="发表于 2025-04-21 16:29:52">2025-04-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/21/06_%E6%9D%82%E8%AE%B0/ollama%E9%83%A8%E7%BD%B2deepseek%E5%A4%A7%E6%A8%A1%E5%9E%8B/" title="8卡A800运行DeepseekR1-671B大模型">8卡A800运行DeepseekR1-671B大模型</a><time datetime="2025-04-21T06:29:52.000Z" title="发表于 2025-04-21 14:29:52">2025-04-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/26/09_%E9%9F%A9%E5%85%88%E8%B6%85K8S/01-Docker%E5%9F%BA%E7%A1%80/06-Docker%E8%B5%84%E6%BA%90%E9%85%8D%E9%A2%9D/" title="06-Docker资源配额">06-Docker资源配额</a><time datetime="2025-03-26T07:12:52.000Z" title="发表于 2025-03-26 15:12:52">2025-03-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/20/09_%E9%9F%A9%E5%85%88%E8%B6%85K8S/01-Docker%E5%9F%BA%E7%A1%80/05-Docker%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/" title="05-Docker容器数据持久化">05-Docker容器数据持久化</a><time datetime="2025-03-20T07:12:52.000Z" title="发表于 2025-03-20 15:12:52">2025-03-20</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">©2019 - 2025 By Haris</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"></div><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>